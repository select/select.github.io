import{m as g,Y as l,af as p}from"./BXIT8Ghv.js";let d=null;function v(){const a=g(null),u=g(!1),i=new Map;return{init:async n=>{if(a.value)return;const r=await p(()=>import("./DO5bXbcd.js"),[],import.meta.url);a.value=new r.default,a.value.onmessage=t=>{const{id:e,error:o}=t.data,c=i.get(e);c&&(o?c.reject(new Error(o)):c.resolve(t.data),i.delete(e))};const s=Math.random().toString(36).substring(7);return new Promise((t,e)=>{i.set(s,{resolve:t,reject:e}),a.value.postMessage({type:"init",id:s,url:n})}).then(()=>{u.value=!0})},query:async(n,r=[])=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((t,e)=>{i.set(s,{resolve:o=>t(o.result??[]),reject:e}),a.value.postMessage({type:"exec",id:s,sql:n,params:l(r)})})},extendedQuery:async n=>{if(!u.value)throw new Error("Database not initialized");const r=Math.random().toString(36).substring(7);return new Promise((s,t)=>{i.set(r,{resolve:o=>s({result:o.result??[],totalCount:o.totalCount}),reject:t});const e={...n};e.params&&(e.params=l(e.params)),a.value.postMessage({type:"query",id:r,...e})})},lightweightQuery:async n=>{if(!u.value)throw new Error("Database not initialized");const r=Math.random().toString(36).substring(7);return new Promise((s,t)=>{i.set(r,{resolve:o=>s({result:o.result??[],totalCount:o.totalCount}),reject:t});const e={...n};e.params&&(e.params=l(e.params)),a.value.postMessage({type:"query-lightweight",id:r,...e})})},queryByIds:async n=>{if(!u.value)throw new Error("Database not initialized");const r=Math.random().toString(36).substring(7);return new Promise((s,t)=>{i.set(r,{resolve:e=>s(e.result??[]),reject:t}),a.value.postMessage({type:"query-by-ids",id:r,imdbIds:l(n)})})},getRelatedMovies:async(n,r=8)=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((t,e)=>{i.set(s,{resolve:o=>t(o.result??[]),reject:e}),a.value.postMessage({type:"query-related",id:s,imdbId:n,limit:r})})},getCollectionsForMovie:async n=>{if(!u.value)throw new Error("Database not initialized");const r=Math.random().toString(36).substring(7);return new Promise((s,t)=>{i.set(r,{resolve:e=>s(e.result??[]),reject:t}),a.value.postMessage({type:"query-collections-for-movie",id:r,movieId:n})})},getFilterOptions:async()=>{if(!u.value)throw new Error("Database not initialized");const n=Math.random().toString(36).substring(7);return new Promise((r,s)=>{i.set(n,{resolve:t=>r({genres:t.genres??[],countries:t.countries??[],channels:t.channels??[]}),reject:s}),a.value.postMessage({type:"get-filter-options",id:n})})},isReady:u}}function P(){return d||(d=v()),d}export{P as u};
