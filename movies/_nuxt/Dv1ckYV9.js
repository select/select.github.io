import{_ as ne}from"./D-1NZnAu.js";import{E as B,N as z,e as P,r as k,B as re,H as te,c as o,a as e,J as y,t as d,z as s,d as g,K as R,L as F,P as J,Z as N,$ as U,a6 as q,a0 as se,o as l,O as Q,a2 as oe,S as ae,n as X,b as j,a1 as de,am as ce,an as ue,u as me,w as ee}from"./Ck9VlGs8.js";import{u as O}from"./PQilDTwg.js";import{g as le}from"./Bz8FWWbC.js";import{f as ie}from"./DMOTkeJ5.js";import{u as K}from"./CrqnEE15.js";import{i as fe}from"./BH85bPq3.js";const be={class:"space-y-4"},xe={class:"flex items-center justify-between"},pe={class:"flex items-center gap-3"},ve={class:"px-2 py-0.5 text-sm font-mono text-theme-text"},ge={class:"flex flex-wrap gap-2"},he=["onClick"],ye={key:0,class:"i-mdi-eye-off text-xs opacity-70"},_e={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},we={class:"bg-theme-surface rounded-2xl w-full max-w-lg shadow-2xl border border-theme-border overflow-hidden"},ke={class:"p-6 border-b border-theme-border flex items-center justify-between"},$e={class:"text-xl font-bold"},Se=["disabled"],Ce={class:"flex flex-wrap gap-2 p-3 bg-theme-background border border-theme-border rounded-lg min-h-[50px]"},Ie=["onClick"],Ve={class:"relative flex-1 min-w-[120px]"},Ae=["onKeydown"],Me={key:0,class:"absolute z-10 left-0 right-0 mt-2 bg-theme-surface border border-theme-border rounded-lg shadow-xl max-h-48 overflow-y-auto"},Te=["onMousedown"],Ye={class:"pt-4 flex gap-3"},Re=["disabled"],Fe={key:0,class:"i-mdi-loading animate-spin mx-auto"},Ee={key:1},Le=B({__name:"AdminCollectionSelector",emits:["select"],setup(A,{expose:V,emit:_}){const w=O(),{collections:$}=z(w),v=P(()=>Array.from($.value.values())),n=P(()=>v.value.filter(m=>m.enabled!==!1).length),S=k(""),b=_,I=m=>{S.value=m,b("select",m)},c=k(!1),r=k(null),t=k(!1),i=re({id:"",name:"",description:"",tags:[]}),h=k(""),C=k(!1),Y=P(()=>{const m=new Set;return $.value.forEach(u=>{u.tags&&u.tags.forEach(p=>m.add(p))}),Array.from(m).sort()}),E=P(()=>{const m=h.value.toLowerCase().trim();return Y.value.filter(u=>u.toLowerCase().includes(m)&&!i.tags.includes(u))}),M=()=>{const m=h.value.trim();m&&!i.tags.includes(m)&&(i.tags.push(m),h.value="")},D=m=>{i.tags=i.tags.filter(u=>u!==m)},H=()=>{h.value===""&&i.tags.length>0&&i.tags.pop()},L=m=>{i.tags.includes(m)||i.tags.push(m),h.value="",C.value=!1},W=()=>{setTimeout(()=>{C.value=!1},200)},G=m=>{r.value=m,i.id=m.id,i.name=m.name,i.description=m.description,i.tags=[...m.tags||[]]},x=()=>{c.value=!1,r.value=null,i.id="",i.name="",i.description="",i.tags=[],h.value="",C.value=!1},a=async()=>{t.value=!0;try{r.value?(await $fetch("/api/admin/collections/update-collection",{method:"POST",body:{collectionId:i.id,updates:{name:i.name,description:i.description,tags:{action:"set",values:i.tags}}}})).success&&(await w.loadCollections(),x()):(await $fetch("/api/admin/collections/create",{method:"POST",body:i})).success&&(await w.loadCollections(),x())}catch{}finally{t.value=!1}},T=async m=>{if(confirm(`Are you sure you want to delete the collection "${m.name}"? This cannot be undone.`))try{(await $fetch("/api/admin/collections/delete",{method:"POST",body:{id:m.id}})).success&&(S.value===m.id&&(S.value="",b("select","")),await w.loadCollections())}catch{}},f=async m=>{const u=m.enabled===!1;try{(await $fetch("/api/admin/collections/update-collection",{method:"POST",body:{collectionId:m.id,updates:{enabled:u}}})).success&&await w.loadCollections()}catch{}};return te(async()=>{w.isLoaded||await w.loadCollections()}),V({editCollection:G,toggleEnabled:f,confirmDelete:T,openCreateModal:()=>c.value=!0}),(m,u)=>(l(),o("div",be,[e("div",xe,[e("div",pe,[u[6]||(u[6]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Select Collection ",-1)),e("span",ve,d(s(n))+"/"+d(s(v).length),1)]),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:u[0]||(u[0]=p=>c.value=!0)},[...u[7]||(u[7]=[e("div",{class:"i-mdi-plus"},null,-1),g(" Create New ",-1)])])]),e("div",ge,[(l(!0),o(R,null,F(s(v),p=>(l(),o("button",{key:p.id,class:Q(["px-4 py-2 rounded-xl border transition-all text-sm font-bold flex items-center gap-2",[s(S)===p.id?"bg-blue-600 text-white border-blue-600 shadow-lg shadow-blue-600/20":"bg-theme-surface border-theme-border hover:border-theme-textmuted text-theme-text",p.enabled===!1?"opacity-60":""]]),onClick:Z=>I(p.id)},[g(d(p.name)+" ",1),p.enabled===!1?(l(),o("div",ye)):y("",!0)],10,he))),128))]),s(c)||s(r)?(l(),o("div",_e,[e("div",we,[e("div",ke,[e("h3",$e,d(s(r)?"Edit Collection":"Create New Collection"),1),e("button",{class:"p-2 hover:bg-theme-selection rounded-full transition-colors",onClick:x},[...u[8]||(u[8]=[e("div",{class:"i-mdi-close text-xl"},null,-1)])])]),e("form",{class:"p-6 space-y-4",onSubmit:J(a,["prevent"])},[e("div",null,[u[9]||(u[9]=e("label",{class:"block text-sm font-bold mb-1"},"ID (URL Slug)",-1)),N(e("input",{"onUpdate:modelValue":u[1]||(u[1]=p=>s(i).id=p),type:"text",placeholder:"e.g. charlie-chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm font-mono",disabled:!!s(r),required:""},null,8,Se),[[U,s(i).id]])]),e("div",null,[u[10]||(u[10]=e("label",{class:"block text-sm font-bold mb-1"},"Name",-1)),N(e("input",{"onUpdate:modelValue":u[2]||(u[2]=p=>s(i).name=p),type:"text",placeholder:"e.g. Charlie Chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm",required:""},null,512),[[U,s(i).name]])]),e("div",null,[u[11]||(u[11]=e("label",{class:"block text-sm font-bold mb-1"},"Description",-1)),N(e("textarea",{"onUpdate:modelValue":u[3]||(u[3]=p=>s(i).description=p),rows:"3",placeholder:"Describe this collection...",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm"},null,512),[[U,s(i).description]])]),e("div",null,[u[13]||(u[13]=e("label",{class:"block text-sm font-bold mb-1"},"Tags",-1)),e("div",Ce,[(l(!0),o(R,null,F(s(i).tags,p=>(l(),o("div",{key:p,class:"flex items-center gap-1.5 px-3 py-1 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded-full text-sm font-medium group"},[g(d(p)+" ",1),e("button",{type:"button",class:"p-0.5 hover:bg-blue-600/20 rounded-full transition-colors",onClick:Z=>D(p)},[...u[12]||(u[12]=[e("div",{class:"i-mdi-close text-xs"},null,-1)])],8,Ie)]))),128)),e("div",Ve,[N(e("input",{"onUpdate:modelValue":u[4]||(u[4]=p=>se(h)?h.value=p:null),type:"text",placeholder:"Add tag...",class:"w-full bg-transparent border-none focus:ring-0 text-sm py-1",onKeydown:[q(J(M,["prevent"]),["enter"]),q(H,["backspace"])],onFocus:u[5]||(u[5]=p=>C.value=!0),onBlur:W},null,40,Ae),[[U,s(h)]]),s(C)&&s(E).length>0?(l(),o("div",Me,[(l(!0),o(R,null,F(s(E),p=>(l(),o("button",{key:p,type:"button",class:"w-full text-left px-4 py-2 text-sm hover:bg-theme-selection transition-colors",onMousedown:J(Z=>L(p),["prevent"])},d(p),41,Te))),128))])):y("",!0)])])]),e("div",Ye,[e("button",{type:"button",class:"flex-1 px-4 py-2 border border-theme-border rounded-lg font-bold hover:bg-theme-selection transition-colors",onClick:x}," Cancel "),e("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-500 transition-colors disabled:opacity-50",disabled:s(t)},[s(t)?(l(),o("div",Fe)):(l(),o("span",Ee,d(s(r)?"Update":"Create"),1))],8,Re)])],32)])])):y("",!0)]))}}),je=Object.assign(Le,{__name:"AdminCollectionSelector"}),Qe={class:"space-y-4"},De={class:"flex items-center gap-4"},Pe={class:"relative flex-1"},Ne={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},Ue={key:0,class:"bg-blue-600 text-white px-1.5 py-0.5 rounded-full text-[10px]"},Be={key:0,class:"flex flex-wrap items-center gap-2"},Oe={key:0,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},ze={key:1,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},Ke={key:2,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},He={key:1,class:"bg-theme-surface border border-theme-border rounded-2xl overflow-hidden"},We={class:"p-4 border-b border-theme-border flex items-center justify-between bg-theme-bg/30"},Ge={class:"text-sm text-theme-textmuted"},Je={class:"font-semibold text-theme-text"},Xe={key:0,class:"text-xs"},Ze=["disabled"],qe={key:0,class:"i-mdi-loading animate-spin"},et={key:1,class:"i-mdi-plus-box-multiple"},tt={class:"divide-y divide-theme-border"},st={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},ot=["src","alt"],lt={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},it={class:"flex-1 min-w-0"},nt={class:"flex items-center gap-2"},rt={class:"font-bold truncate"},at={class:"text-xs text-theme-textmuted font-mono"},dt={class:"text-xs text-theme-textmuted truncate"},ct={class:"flex items-center gap-2 text-[10px] text-theme-textmuted mt-0.5"},ut={class:"font-mono"},mt={key:0,class:"flex items-center gap-1"},ft={class:"font-bold text-theme-text"},bt={key:0,class:"opacity-70"},xt=["disabled","onClick"],pt={key:0,class:"i-mdi-loading animate-spin"},vt={key:2,class:"p-8 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},gt=B({__name:"AdminMovieSearch",props:{collectionId:{}},emits:["add"],setup(A,{emit:V}){const _=A,w=V,$=O(),v=K(),{filters:n,activeFiltersCount:S,hasActiveFilters:b}=z(v),{resetFilters:I}=v,c=oe(),r=k(null),t=k(""),i=k([]),h=k(!1),C=k(""),Y=k(!1),E=k(!1);ae("/",x=>{const a=window.document.activeElement,T=a?.tagName==="INPUT"||a?.tagName==="TEXTAREA";x.preventDefault(),T||r.value?.focus()}),X(()=>n.value.searchQuery,x=>{x!==t.value&&(t.value=x,x.length>=3||b.value?D():i.value=[])}),X(()=>[n.value.minRating,n.value.minYear,n.value.maxYear,n.value.minVotes,n.value.maxVotes,n.value.genres,n.value.countries,n.value.sources],()=>{(t.value.length>=3||b.value)&&D()},{deep:!0});const D=de(async()=>{const x=t.value.length>=3,a=b.value;if(!x&&!a){i.value=[];return}h.value=!0;try{const T=await $fetch("/api/admin/movies/search",{query:{q:t.value,minRating:n.value.minRating||void 0,minYear:n.value.minYear||void 0,maxYear:n.value.maxYear||void 0,minVotes:n.value.minVotes||void 0,maxVotes:n.value.maxVotes||void 0,genres:n.value.genres.join(",")||void 0,countries:n.value.countries.join(",")||void 0,sources:n.value.sources.join(",")||void 0}});i.value=T.slice(0,300)}catch{c.showToast("Search failed","error")}finally{h.value=!1}},300),H=()=>{D()},L=x=>$.isMovieInCollection(x,_.collectionId),W=async x=>{C.value=x;try{await $.addMovieToCollection(_.collectionId,x)?(c.showToast("Movie added to collection"),w("add")):c.showToast("Failed to add movie","error")}catch{c.showToast("Error adding movie","error")}finally{C.value=""}},G=async()=>{Y.value=!0;let x=0,a=0;try{const T=i.value.filter(f=>!L(f.imdbId));if(T.length===0){c.showToast("All movies are already in the collection","info");return}for(const f of T)try{await $.addMovieToCollection(_.collectionId,f.imdbId)?x++:a++}catch{a++}x>0&&(c.showToast(`Added ${x} movie${x>1?"s":""} to collection`),w("add")),a>0&&c.showToast(`Failed to add ${a} movie${a>1?"s":""}`,"error")}finally{Y.value=!1}};return(x,a)=>{const T=ce("FilterMenu");return l(),o("div",Qe,[e("div",De,[e("div",Pe,[a[6]||(a[6]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-theme-textmuted"},[e("div",{class:"i-mdi-magnify text-xl"})],-1)),N(e("input",{ref_key:"searchInput",ref:r,"onUpdate:modelValue":a[0]||(a[0]=f=>se(t)?t.value=f:null),type:"text",placeholder:"Search by title, director, writer, plot or IMDb ID... (or use filters below)",class:"block w-full pl-10 pr-3 py-3 border border-theme-border rounded-xl bg-theme-surface focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none",onInput:H},null,544),[[U,s(t)]]),s(h)?(l(),o("div",Ne,[...a[5]||(a[5]=[e("div",{class:"i-mdi-loading animate-spin text-blue-600"},null,-1)])])):y("",!0)]),e("button",{class:"px-4 py-3 bg-theme-surface border border-theme-border rounded-xl text-sm font-bold hover:bg-theme-selection transition-colors flex items-center gap-2",onClick:a[1]||(a[1]=f=>E.value=!0)},[a[7]||(a[7]=e("div",{class:"i-mdi-filter-variant"},null,-1)),a[8]||(a[8]=g(" Filters ",-1)),s(S)>0?(l(),o("span",Ue,d(s(S)),1)):y("",!0)])]),s(b)?(l(),o("div",Be,[s(n).minRating>0?(l(),o("div",Oe,[a[9]||(a[9]=e("div",{class:"i-mdi-star"},null,-1)),g(" "+d(s(n).minRating)+"+ ",1)])):y("",!0),s(n).minYear>0||s(n).maxYear?(l(),o("div",ze,[a[10]||(a[10]=e("div",{class:"i-mdi-calendar"},null,-1)),g(" "+d(s(n).minYear||1910)+" - "+d(s(n).maxYear||2025),1)])):y("",!0),s(n).minVotes>0||s(n).maxVotes?(l(),o("div",Ke,[a[11]||(a[11]=e("div",{class:"i-mdi-account-group"},null,-1)),g(" "+d(s(n).minVotes.toLocaleString())+" - "+d(s(n).maxVotes?s(n).maxVotes.toLocaleString():"Any"),1)])):y("",!0),(l(!0),o(R,null,F(s(n).genres,f=>(l(),o("div",{key:f,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[a[12]||(a[12]=e("div",{class:"i-mdi-movie-filter"},null,-1)),g(" "+d(f),1)]))),128)),(l(!0),o(R,null,F(s(n).sources,f=>(l(),o("div",{key:f,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[a[13]||(a[13]=e("div",{class:"i-mdi-source-branch"},null,-1)),g(" "+d(f),1)]))),128)),e("button",{class:"text-xs text-theme-primary hover:underline ml-2",onClick:a[2]||(a[2]=(...f)=>s(I)&&s(I)(...f))}," Clear All ")])):y("",!0),s(i).length>0?(l(),o("div",He,[e("div",We,[e("div",Ge,[e("span",Je,d(s(i).length),1),a[14]||(a[14]=g(" results ",-1)),s(i).length===300?(l(),o("span",Xe,"(limited to 300)")):y("",!0)]),e("button",{class:Q(["px-4 py-2 rounded-lg text-sm font-bold transition-all flex items-center gap-2 disabled:opacity-50",s(Y)?"bg-theme-selection text-theme-textmuted cursor-wait":"bg-blue-600 hover:bg-blue-500 text-white"]),disabled:s(Y)||s(C)!=="",onClick:G},[s(Y)?(l(),o("div",qe)):(l(),o("div",et)),a[15]||(a[15]=g(" Add All to Collection ",-1))],10,Ze)]),e("div",tt,[(l(!0),o(R,null,F(s(i),f=>(l(),o("div",{key:f.imdbId,class:"p-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",st,[f.imdbId?.startsWith("tt")?(l(),o("img",{key:0,src:("getPosterPath"in x?x.getPosterPath:s(le))(f.imdbId),alt:f.title,class:"w-full h-full object-cover",onError:a[3]||(a[3]=m=>m.target.style.display="none")},null,40,ot)):(l(),o("div",lt,[...a[16]||(a[16]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",it,[e("div",nt,[e("h4",rt,d(f.title),1),e("span",at,d(f.year),1)]),e("p",dt,d(f.metadata?.Director||"Unknown Director"),1),e("div",ct,[e("span",ut,d(f.imdbId),1),f.metadata?.imdbRating?(l(),o("span",mt,[a[17]||(a[17]=e("span",{class:"opacity-50"},"•",-1)),a[18]||(a[18]=e("div",{class:"i-mdi-star text-theme-accent text-xs"},null,-1)),e("span",ft,d(f.metadata.imdbRating),1),f.metadata?.imdbVotes?(l(),o("span",bt," ("+d(("formatVotes"in x?x.formatVotes:s(ie))(f.metadata.imdbVotes))+") ",1)):y("",!0)])):y("",!0)])]),e("button",{class:Q(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1.5 disabled:opacity-50",L(f.imdbId)?"bg-theme-selection text-theme-textmuted cursor-default":"bg-blue-600 hover:bg-blue-500 text-white"]),disabled:L(f.imdbId)||s(C)===f.imdbId,onClick:m=>W(f.imdbId)},[s(C)===f.imdbId?(l(),o("div",pt)):(l(),o("div",{key:1,class:Q(L(f.imdbId)?"i-mdi-check":"i-mdi-plus")},null,2)),g(" "+d(L(f.imdbId)?"Added":"Add"),1)],10,xt)]))),128))])])):(s(t).length>=3||s(b))&&!s(h)?(l(),o("div",vt," No movies found"+d(s(t)?` for "${s(t)}"`:"")+d(s(b)?" with current filters":""),1)):y("",!0),j(T,{"is-open":s(E),onClose:a[4]||(a[4]=f=>E.value=!1)},null,8,["is-open"])])}}}),ht=Object.assign(gt,{__name:"AdminMovieSearch"}),yt={class:"space-y-4"},_t={key:0,class:"text-sm text-theme-textmuted italic p-4 bg-theme-surface border border-theme-border border-dashed rounded-xl text-center"},wt={key:1,class:"space-y-3"},kt={class:"flex items-start justify-between gap-4"},$t={class:"flex-1 space-y-2"},St={class:"flex items-center gap-2"},Ct={class:"font-bold text-sm"},It={class:"flex flex-wrap gap-2"},Vt={key:0,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},At={key:1,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Mt={key:2,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Tt={key:3,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Yt={key:4,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Rt={key:5,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Ft={class:"flex items-center gap-1"},Et=["onClick"],Lt=["onClick"],jt=B({__name:"AdminSavedQueryManager",props:{collectionId:{},queries:{}},emits:["filtersApplied"],setup(A,{emit:V}){const _=A,w=V,$=O(),v=K(),{filters:n}=z(v),S=async()=>{const c={field:"year",direction:"desc"},r=n.value.sort.field===c.field&&n.value.sort.direction===c.direction,t={searchQuery:n.value.searchQuery,currentPage:1,lastScrollY:0};r||(t.sort={...n.value.sort}),n.value.sources.length>0&&(t.sources=[...n.value.sources]),n.value.minRating>0&&(t.minRating=n.value.minRating),n.value.minYear>0&&(t.minYear=n.value.minYear),n.value.maxYear&&n.value.maxYear>0&&(t.maxYear=n.value.maxYear),n.value.minVotes>0&&(t.minVotes=n.value.minVotes),n.value.maxVotes&&n.value.maxVotes>0&&(t.maxVotes=n.value.maxVotes),n.value.genres.length>0&&(t.genres=[...n.value.genres]),n.value.countries.length>0&&(t.countries=[...n.value.countries]);const i={searchQuery:n.value.searchQuery,filterState:t};await $.addQueryToCollection(_.collectionId,i)},b=async c=>{confirm("Are you sure you want to remove this saved query?")&&await $.removeQueryFromCollection(_.collectionId,c)},I=c=>{v.resetFilters(),c.searchQuery&&v.setSearchQuery(c.searchQuery),c.filterState.sort&&v.setSort(c.filterState.sort),c.filterState.minRating&&v.setMinRating(c.filterState.minRating),c.filterState.minYear&&v.setMinYear(c.filterState.minYear),c.filterState.maxYear&&v.setMaxYear(c.filterState.maxYear),c.filterState.minVotes&&v.setMinVotes(c.filterState.minVotes),c.filterState.maxVotes&&v.setMaxVotes(c.filterState.maxVotes),c.filterState.genres?.forEach(r=>v.toggleGenre(r)),c.filterState.countries?.forEach(r=>v.toggleCountry(r)),c.filterState.sources?.forEach(r=>v.toggleSource(r)),w("filtersApplied")};return(c,r)=>(l(),o("div",yt,[e("div",{class:"flex items-center justify-between"},[r[1]||(r[1]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Saved Queries ",-1)),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:S},[...r[0]||(r[0]=[e("div",{class:"i-mdi-plus"},null,-1),g(" Save Current Search ",-1)])])]),!A.queries||A.queries.length===0?(l(),o("div",_t," No saved queries for this collection. ")):(l(),o("div",wt,[(l(!0),o(R,null,F(A.queries,(t,i)=>(l(),o("div",{key:i,class:"p-4 bg-theme-surface border border-theme-border rounded-xl group hover:border-theme-textmuted transition-all"},[e("div",kt,[e("div",$t,[e("div",St,[r[2]||(r[2]=e("div",{class:"i-mdi-magnify text-theme-textmuted"},null,-1)),e("span",Ct,d(t.searchQuery||"All Movies"),1)]),e("div",It,[t.filterState.sort?(l(),o("div",Vt,[r[3]||(r[3]=e("div",{class:"i-mdi-sort"},null,-1)),g(" "+d(t.filterState.sort.field)+" ("+d(t.filterState.sort.direction)+") ",1)])):y("",!0),t.filterState.minYear&&t.filterState.minYear>0||t.filterState.maxYear?(l(),o("div",At,[r[4]||(r[4]=e("div",{class:"i-mdi-calendar"},null,-1)),g(" "+d(t.filterState.minYear||1910)+" - "+d(t.filterState.maxYear||2025),1)])):y("",!0),t.filterState.minRating&&t.filterState.minRating>0?(l(),o("div",Mt,[r[5]||(r[5]=e("div",{class:"i-mdi-star"},null,-1)),g(" "+d(t.filterState.minRating)+"+ ",1)])):y("",!0),t.filterState.minVotes&&t.filterState.minVotes>0||t.filterState.maxVotes?(l(),o("div",Tt,[r[6]||(r[6]=e("div",{class:"i-mdi-account-group"},null,-1)),g(" "+d((t.filterState.minVotes||0).toLocaleString())+" - "+d(t.filterState.maxVotes?t.filterState.maxVotes.toLocaleString():"Any"),1)])):y("",!0),t.filterState.genres?.length?(l(),o("div",Yt,[r[7]||(r[7]=e("div",{class:"i-mdi-movie-filter"},null,-1)),g(" "+d(t.filterState.genres.join(", ")),1)])):y("",!0),t.filterState.sources?.length?(l(),o("div",Rt,[r[8]||(r[8]=e("div",{class:"i-mdi-source-branch"},null,-1)),g(" "+d(t.filterState.sources.join(", ")),1)])):y("",!0)])]),e("div",Ft,[e("button",{class:"p-2 hover:bg-blue-600/10 text-blue-600 rounded-lg transition-colors",title:"Apply Filters",onClick:h=>I(t)},[...r[9]||(r[9]=[e("div",{class:"i-mdi-filter-variant"},null,-1)])],8,Et),e("button",{class:"p-2 hover:bg-red-600/10 text-red-600 rounded-lg transition-colors",title:"Remove Query",onClick:h=>b(i)},[...r[10]||(r[10]=[e("div",{class:"i-mdi-delete"},null,-1)])],8,Lt)])])]))),128))]))]))}}),Qt=Object.assign(jt,{__name:"AdminSavedQueryManager"}),Dt={class:"space-y-4"},Pt={key:0,class:"p-12 flex justify-center"},Nt={key:1,class:"overflow-hidden divide-y divide-theme-border"},Ut={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},Bt=["src","alt"],Ot={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},zt={class:"flex-1 min-w-0"},Kt={class:"flex items-center gap-2"},Ht={class:"font-bold truncate"},Wt={class:"text-xs text-theme-textmuted font-mono"},Gt={class:"text-xs text-theme-textmuted truncate"},Jt={class:"flex items-center gap-2 text-[10px] text-theme-textmuted mt-0.5"},Xt={class:"font-mono"},Zt={key:0,class:"flex items-center gap-1"},qt={class:"font-bold text-theme-text"},es={key:0,class:"opacity-70"},ts=["disabled","onClick"],ss={key:0,class:"i-mdi-loading animate-spin text-xl"},os={key:1,class:"i-mdi-trash-can-outline text-xl"},ls={key:2,class:"p-12 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},is=B({__name:"AdminCollectionMoviesList",props:{collectionId:{}},setup(A,{expose:V}){const _=A,w=O(),$=K(),v=oe(),n=k([]),S=k(!1),b=k(""),I=async()=>{if(_.collectionId){S.value=!0;try{const r=await w.getCollectionById(_.collectionId);if(!r||!r.movieIds||!r.movieIds.length){n.value=[];return}!$.allMovies.size&&!$.isLoading.movies&&await $.loadFromFile();const t=ue(r.movieIds),i=await $.fetchMoviesByIds(t);n.value=t.map(h=>i.find(C=>C.imdbId===h)).filter(h=>!!h)}catch(r){window.console.error("Failed to load collection movies:",r),v.showToast("Failed to load collection movies","error")}finally{S.value=!1}}},c=async r=>{if(confirm(`Remove "${r.title}" from this collection?`)){b.value=r.imdbId;try{await w.removeMovieFromCollection(_.collectionId,r.imdbId)?(v.showToast("Movie removed from collection"),await I()):v.showToast("Failed to remove movie","error")}catch{v.showToast("Error removing movie","error")}finally{b.value=""}}};return V({refresh:I}),X(()=>_.collectionId,()=>{I()},{immediate:!0}),(r,t)=>(l(),o("div",Dt,[s(S)?(l(),o("div",Pt,[...t[1]||(t[1]=[e("div",{class:"i-mdi-loading animate-spin text-4xl text-blue-600"},null,-1)])])):s(n).length>0?(l(),o("div",Nt,[(l(!0),o(R,null,F(s(n),i=>(l(),o("div",{key:i.imdbId,class:"py-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",Ut,[i.imdbId?.startsWith("tt")?(l(),o("img",{key:0,src:("getPosterPath"in r?r.getPosterPath:s(le))(i.imdbId),alt:i.title,class:"w-full h-full object-cover",onError:t[0]||(t[0]=h=>h.target.style.display="none")},null,40,Bt)):(l(),o("div",Ot,[...t[2]||(t[2]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",zt,[e("div",Kt,[e("h4",Ht,d(i.title),1),e("span",Wt,d(i.year),1)]),e("p",Gt,d(i.metadata?.Director||"Unknown Director"),1),e("div",Jt,[e("span",Xt,d(i.imdbId),1),i.metadata?.imdbRating?(l(),o("span",Zt,[t[3]||(t[3]=e("span",{class:"opacity-50"},"•",-1)),t[4]||(t[4]=e("div",{class:"i-mdi-star text-theme-accent text-xs"},null,-1)),e("span",qt,d(i.metadata.imdbRating),1),i.metadata?.imdbVotes?(l(),o("span",es," ("+d(("formatVotes"in r?r.formatVotes:s(ie))(i.metadata.imdbVotes))+") ",1)):y("",!0)])):y("",!0)])]),e("button",{class:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Remove from collection",disabled:s(b)===i.imdbId,onClick:h=>c(i)},[s(b)===i.imdbId?(l(),o("div",ss)):(l(),o("div",os))],8,ts)]))),128))])):(l(),o("div",ls,[...t[5]||(t[5]=[e("div",{class:"i-mdi-movie-off-outline text-4xl mx-auto mb-2 opacity-20"},null,-1),e("p",null,"No movies in this collection yet.",-1)])]))]))}}),ns=Object.assign(is,{__name:"AdminCollectionMoviesList"}),rs={class:"min-h-screen bg-theme-background text-theme-text p-4 md:ml-16 transition-colors duration-300"},as={class:"max-w-7xl mx-auto space-y-8"},ds={key:0,class:"flex flex-col items-center justify-center h-[60vh] text-center"},cs={key:1,class:"flex flex-col gap-8"},us={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},ms={class:"bg-theme-surface border border-theme-border rounded-2xl p-6"},fs={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},bs={class:"space-y-8"},xs={key:0,class:"bg-theme-surface border border-theme-border rounded-2xl p-6 space-y-4"},ps={class:"flex items-start justify-between gap-4"},vs={class:"space-y-2"},gs={class:"flex items-center gap-3"},hs={class:"text-2xl font-bold"},ys={key:0,class:"px-2 py-0.5 bg-yellow-600/10 text-yellow-600 dark:text-yellow-400 border border-yellow-600/20 rounded text-xs font-bold uppercase"},_s={key:0,class:"flex flex-wrap gap-2"},ws={class:"text-theme-textmuted max-w-3xl"},ks={class:"flex items-center gap-2 text-sm font-mono text-theme-textmuted"},$s={class:"text-theme-text"},Ss={class:"flex items-center gap-2"},Cs={class:"space-y-6"},Is={class:"space-y-6"},Vs={class:"bg-theme-surface border border-theme-border rounded-2xl p-6 space-y-6"},Ls=B({__name:"index",setup(A){me({title:"Collection Editor - Movies Deluxe Admin",meta:[{name:"robots",content:"noindex, nofollow"}]});const V=k(!1),_=k(""),w=k(null),$=k(null),v=K(),n=O(),{collections:S}=z(n),b=P(()=>_.value&&S.value.get(_.value)||null);te(async()=>{V.value=fe(),V.value&&await v.loadFromFile()});const I=()=>{$.value&&$.value.refresh()},c=()=>{};return(r,t)=>{const i=ne,h=je,C=ht,Y=Qt,E=ns;return l(),o("div",rs,[e("main",as,[s(V)?(l(),o("div",cs,[e("header",us,[t[9]||(t[9]=e("div",null,[e("h1",{class:"text-3xl font-bold flex items-center gap-3"},[e("div",{class:"i-mdi-movie-edit text-blue-600"}),g(" Collection Editor ")]),e("p",{class:"text-theme-textmuted mt-1"},"Add and remove movies from collections")],-1)),j(i,{to:"/admin",class:"px-4 py-2 text-sm bg-theme-surface border border-theme-border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"},{default:ee(()=>[...t[8]||(t[8]=[e("div",{class:"i-mdi-arrow-left"},null,-1),g(" Back to Dashboard ",-1)])]),_:1})]),e("section",ms,[j(h,{ref_key:"collectionSelector",ref:w,onSelect:t[0]||(t[0]=M=>_.value=M)},null,512)]),s(_)?(l(),o("section",fs,[e("div",bs,[s(b)?(l(),o("div",xs,[e("div",ps,[e("div",vs,[e("div",gs,[e("h2",hs,d(s(b).name),1),s(b).enabled===!1?(l(),o("span",ys," Hidden ")):y("",!0)]),s(b).tags?.length?(l(),o("div",_s,[(l(!0),o(R,null,F(s(b).tags,M=>(l(),o("span",{key:M,class:"px-2 py-1 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded-lg text-xs font-medium"},d(M),1))),128))])):y("",!0),e("p",ws,d(s(b).description||"No description provided."),1),e("div",ks,[t[10]||(t[10]=e("div",{class:"i-mdi-movie text-theme-text"},null,-1)),e("span",$s,d(s(b).movieIds.length),1),t[11]||(t[11]=g(" movies in collection ",-1))])]),e("div",Ss,[e("button",{class:Q(["p-2 rounded-xl border border-theme-border hover:bg-theme-background transition-colors",s(b).enabled===!1?"text-green-600":"text-yellow-600"]),title:"Toggle Visibility",onClick:t[1]||(t[1]=M=>s(w)?.toggleEnabled(s(b)))},[e("div",{class:Q([s(b).enabled===!1?"i-mdi-eye":"i-mdi-eye-off","text-xl"])},null,2)],2),e("button",{class:"p-2 rounded-xl border border-theme-border hover:bg-theme-background text-blue-600 transition-colors",title:"Edit Collection",onClick:t[2]||(t[2]=M=>s(w)?.editCollection(s(b)))},[...t[12]||(t[12]=[e("div",{class:"i-mdi-pencil text-xl"},null,-1)])]),e("button",{class:"p-2 rounded-xl border border-theme-border hover:bg-theme-background text-red-600 transition-colors",title:"Delete Collection",onClick:t[3]||(t[3]=M=>s(w)?.confirmDelete(s(b)))},[...t[13]||(t[13]=[e("div",{class:"i-mdi-delete text-xl"},null,-1)])])])])])):y("",!0),e("div",Cs,[t[14]||(t[14]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-magnify text-blue-600"}),g(" Search Library ")],-1)),j(C,{"collection-id":s(_),onAdd:I},null,8,["collection-id"])])]),e("div",Is,[e("div",Vs,[t[15]||(t[15]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-database-clock text-blue-600"}),g(" Dynamic Queries ")],-1)),j(Y,{"collection-id":s(_),queries:s(b)?.savedQueries,onFiltersApplied:c},null,8,["collection-id","queries"])]),t[16]||(t[16]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-playlist-play text-blue-600"}),g(" Collection Movies ")],-1)),j(E,{ref_key:"moviesList",ref:$,"collection-id":s(_)},null,8,["collection-id"])])])):y("",!0)])):(l(),o("div",ds,[t[5]||(t[5]=e("div",{class:"i-mdi-lock text-64px text-gray-300 dark:text-gray-700 mb-4"},null,-1)),t[6]||(t[6]=e("h1",{class:"text-2xl font-bold mb-2"},"Access Denied",-1)),t[7]||(t[7]=e("p",{class:"text-theme-textmuted"},"The admin interface is only available on localhost.",-1)),j(i,{to:"/",class:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors"},{default:ee(()=>[...t[4]||(t[4]=[g(" Back to Home ",-1)])]),_:1})]))])])}}});export{Ls as default};
