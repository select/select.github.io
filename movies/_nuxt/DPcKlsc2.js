import{_ as q}from"./B0slBrpQ.js";import{e as j,s as O,f as z,m as h,A as P,h as E,c as s,a as e,k as M,d as $,F as L,r as F,l as o,t as f,J as D,v as A,z as T,o as l,q as S,D as V,y as W,p as H,Y as J,b as I,w as B}from"./BXIT8Ghv.js";import{u as N}from"./BUnP8HaI.js";import{u as R}from"./DknEVg6-.js";import{i as Q}from"./BH85bPq3.js";import"./X_-A6GI7.js";const Y={class:"space-y-4"},G={class:"flex items-center justify-between"},K={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},X=["onClick"],Z={class:"flex items-center justify-between mb-2 pr-12"},ee={key:0,class:"i-mdi-check-circle text-blue-600 text-xl flex-shrink-0"},te={class:"text-xs text-theme-textmuted line-clamp-1 mb-2"},oe={class:"flex items-center gap-2 text-xs font-mono bg-theme-bg/50 px-2 py-1 rounded w-fit"},se=["onClick"],le=["onClick"],ie={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},ne={class:"bg-theme-surface rounded-2xl w-full max-w-lg shadow-2xl border border-theme-border overflow-hidden"},de={class:"p-6 border-b border-theme-border flex items-center justify-between"},re={class:"text-xl font-bold"},ae=["disabled"],ce={class:"pt-4 flex gap-3"},me=["disabled"],ue={key:0,class:"i-mdi-loading animate-spin mx-auto"},be={key:1},xe=j({__name:"AdminCollectionSelector",emits:["select"],setup(C,{emit:w}){const m=N(),{collections:y}=O(m),v=z(()=>Array.from(y.value.values())),c=h(""),x=w,i=d=>{c.value=d,x("select",d)},p=h(!1),u=h(null),g=h(!1),n=P({id:"",name:"",description:""}),b=d=>{u.value=d,n.id=d.id,n.name=d.name,n.description=d.description},r=()=>{p.value=!1,u.value=null,n.id="",n.name="",n.description=""},k=async()=>{g.value=!0;try{const d=u.value?"/api/admin/collections/update":"/api/admin/collections/create";(await $fetch(d,{method:"POST",body:n})).success&&(await m.loadCollections(),r())}catch{}finally{g.value=!1}},_=async d=>{if(confirm(`Are you sure you want to delete the collection "${d.name}"? This cannot be undone.`))try{(await $fetch("/api/admin/collections/delete",{method:"POST",body:{id:d.id}})).success&&(c.value===d.id&&(c.value="",x("select","")),await m.loadCollections())}catch{}};return E(async()=>{m.isLoaded||await m.loadCollections()}),(d,t)=>(l(),s("div",Y,[e("div",G,[t[5]||(t[5]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Select Collection ",-1)),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:t[0]||(t[0]=a=>p.value=!0)},[...t[4]||(t[4]=[e("div",{class:"i-mdi-plus"},null,-1),$(" Create New ",-1)])])]),e("div",K,[(l(!0),s(L,null,F(o(v),a=>(l(),s("div",{key:a.id,class:"relative group"},[e("button",{class:S(["w-full text-left p-4 rounded-xl border transition-all h-full",[o(c)===a.id?"bg-blue-600/10 border-blue-600 ring-2 ring-blue-600/20":"bg-theme-surface border-theme-border hover:border-theme-textmuted"]]),onClick:U=>i(a.id)},[e("div",Z,[e("span",{class:S(["font-bold text-lg truncate",o(c)===a.id?"text-blue-600 dark:text-blue-400":""])},f(a.name),3),o(c)===a.id?(l(),s("div",ee)):M("",!0)]),e("p",te,f(a.description||"No description"),1),e("div",oe,[t[6]||(t[6]=e("div",{class:"i-mdi-movie"},null,-1)),$(" "+f(a.movieIds.length)+" movies ",1)])],10,X),e("div",{class:S(["absolute top-3 right-3 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",{"opacity-100":o(c)===a.id}])},[e("button",{class:"p-1.5 hover:bg-theme-selection rounded-lg text-blue-500 transition-colors",title:"Edit Collection",onClick:D(U=>b(a),["stop"])},[...t[7]||(t[7]=[e("div",{class:"i-mdi-pencil text-lg"},null,-1)])],8,se),e("button",{class:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg text-red-500 transition-colors",title:"Delete Collection",onClick:D(U=>_(a),["stop"])},[...t[8]||(t[8]=[e("div",{class:"i-mdi-delete text-lg"},null,-1)])],8,le)],2)]))),128))]),o(p)||o(u)?(l(),s("div",ie,[e("div",ne,[e("div",de,[e("h3",re,f(o(u)?"Edit Collection":"Create New Collection"),1),e("button",{class:"p-2 hover:bg-theme-selection rounded-full transition-colors",onClick:r},[...t[9]||(t[9]=[e("div",{class:"i-mdi-close text-xl"},null,-1)])])]),e("form",{class:"p-6 space-y-4",onSubmit:D(k,["prevent"])},[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-bold mb-1"},"ID (URL Slug)",-1)),A(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>o(n).id=a),type:"text",placeholder:"e.g. charlie-chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm font-mono",disabled:!!o(u),required:""},null,8,ae),[[T,o(n).id]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-bold mb-1"},"Name",-1)),A(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>o(n).name=a),type:"text",placeholder:"e.g. Charlie Chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm",required:""},null,512),[[T,o(n).name]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-bold mb-1"},"Description",-1)),A(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=a=>o(n).description=a),rows:"3",placeholder:"Describe this collection...",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm"},null,512),[[T,o(n).description]])]),e("div",ce,[e("button",{type:"button",class:"flex-1 px-4 py-2 border border-theme-border rounded-lg font-bold hover:bg-theme-selection transition-colors",onClick:r}," Cancel "),e("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-500 transition-colors disabled:opacity-50",disabled:o(g)},[o(g)?(l(),s("div",ue)):(l(),s("span",be,f(o(u)?"Update":"Create"),1))],8,me)])],32)])])):M("",!0)]))}}),pe=Object.assign(xe,{__name:"AdminCollectionSelector"}),fe={class:"space-y-4"},he={class:"relative"},ve={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},ge={key:0,class:"bg-theme-surface border border-theme-border rounded-2xl overflow-hidden divide-y divide-theme-border"},_e={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},ye=["src","alt"],we={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},ke={class:"flex-1 min-w-0"},$e={class:"flex items-center gap-2"},Ce={class:"font-bold truncate"},Ie={class:"text-xs text-theme-textmuted font-mono"},Se={class:"text-xs text-theme-textmuted truncate"},Me={class:"text-[10px] text-theme-textmuted font-mono mt-0.5"},Ae=["disabled","onClick"],Te={key:0,class:"i-mdi-loading animate-spin"},je={key:1,class:"p-8 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},De=j({__name:"AdminMovieSearch",props:{collectionId:{}},emits:["add"],setup(C,{emit:w}){const m=C,y=w,v=N(),c=V(),x=h(""),i=h([]),p=h(!1),u=h("");let g;const n=()=>{if(clearTimeout(g),x.value.length<3){i.value=[];return}g=setTimeout(b,300)},b=async()=>{p.value=!0;try{const _=await $fetch("/api/admin/movies/search",{query:{q:x.value}});i.value=_}catch{c.showToast("Search failed","error")}finally{p.value=!1}},r=_=>v.isMovieInCollection(_,m.collectionId),k=async _=>{u.value=_;try{await v.addMovieToCollection(m.collectionId,_)?(c.showToast("Movie added to collection"),y("add")):c.showToast("Failed to add movie","error")}catch{c.showToast("Error adding movie","error")}finally{u.value=""}};return(_,d)=>(l(),s("div",fe,[e("div",he,[d[3]||(d[3]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-theme-textmuted"},[e("div",{class:"i-mdi-magnify text-xl"})],-1)),A(e("input",{"onUpdate:modelValue":d[0]||(d[0]=t=>W(x)?x.value=t:null),type:"text",placeholder:"Search by title, director, writer, plot or IMDb ID...",class:"block w-full pl-10 pr-3 py-3 border border-theme-border rounded-xl bg-theme-surface focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none",onInput:n},null,544),[[T,o(x)]]),o(p)?(l(),s("div",ve,[...d[2]||(d[2]=[e("div",{class:"i-mdi-loading animate-spin text-blue-600"},null,-1)])])):M("",!0)]),o(i).length>0?(l(),s("div",ge,[(l(!0),s(L,null,F(o(i),t=>(l(),s("div",{key:t.imdbId,class:"p-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",_e,[t.imdbId?.startsWith("tt")?(l(),s("img",{key:0,src:`/posters/${t.imdbId}.jpg`,alt:t.title,class:"w-full h-full object-cover",onError:d[1]||(d[1]=a=>a.target.style.display="none")},null,40,ye)):(l(),s("div",we,[...d[4]||(d[4]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",ke,[e("div",$e,[e("h4",Ce,f(t.title),1),e("span",Ie,f(t.year),1)]),e("p",Se,f(t.metadata?.Director||"Unknown Director"),1),e("p",Me,f(t.imdbId),1)]),e("button",{class:S(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1.5 disabled:opacity-50",r(t.imdbId)?"bg-theme-selection text-theme-textmuted cursor-default":"bg-blue-600 hover:bg-blue-500 text-white"]),disabled:r(t.imdbId)||o(u)===t.imdbId,onClick:a=>k(t.imdbId)},[o(u)===t.imdbId?(l(),s("div",Te)):(l(),s("div",{key:1,class:S(r(t.imdbId)?"i-mdi-check":"i-mdi-plus")},null,2)),$(" "+f(r(t.imdbId)?"Added":"Add"),1)],10,Ae)]))),128))])):o(x).length>=3&&!o(p)?(l(),s("div",je,' No movies found for "'+f(o(x))+'" ',1)):M("",!0)]))}}),Le=Object.assign(De,{__name:"AdminMovieSearch"}),Fe={class:"space-y-4"},Ne={key:0,class:"p-12 flex justify-center"},Ue={key:1,class:"bg-theme-surface border border-theme-border rounded-2xl overflow-hidden divide-y divide-theme-border"},Be={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},Ee=["src","alt"],Ve={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},Re={class:"flex-1 min-w-0"},qe={class:"flex items-center gap-2"},Oe={class:"font-bold truncate"},ze={class:"text-xs text-theme-textmuted font-mono"},Pe={class:"text-xs text-theme-textmuted truncate"},We={class:"text-[10px] text-theme-textmuted font-mono mt-0.5"},He=["disabled","onClick"],Je={key:0,class:"i-mdi-loading animate-spin text-xl"},Qe={key:1,class:"i-mdi-trash-can-outline text-xl"},Ye={key:2,class:"p-12 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},Ge=j({__name:"AdminCollectionMoviesList",props:{collectionId:{}},setup(C,{expose:w}){const m=C,y=N(),v=R(),c=V(),x=h([]),i=h(!1),p=h(""),u=async()=>{if(m.collectionId){i.value=!0;try{const n=await y.getCollectionById(m.collectionId);if(!n||!n.movieIds||!n.movieIds.length){x.value=[];return}!v.allMovies.size&&!v.isLoading.movies&&await v.loadFromFile();const b=J(n.movieIds),r=await v.fetchMoviesByIds(b);x.value=b.map(k=>r.find(_=>_.imdbId===k)).filter(Boolean)}catch(n){console.error("Failed to load collection movies:",n),c.showToast("Failed to load collection movies","error")}finally{i.value=!1}}},g=async n=>{if(confirm(`Remove "${n.title}" from this collection?`)){p.value=n.imdbId;try{await y.removeMovieFromCollection(m.collectionId,n.imdbId)?(c.showToast("Movie removed from collection"),await u()):c.showToast("Failed to remove movie","error")}catch{c.showToast("Error removing movie","error")}finally{p.value=""}}};return w({refresh:u}),H(()=>m.collectionId,()=>{u()},{immediate:!0}),(n,b)=>(l(),s("div",Fe,[o(i)?(l(),s("div",Ne,[...b[1]||(b[1]=[e("div",{class:"i-mdi-loading animate-spin text-4xl text-blue-600"},null,-1)])])):o(x).length>0?(l(),s("div",Ue,[(l(!0),s(L,null,F(o(x),r=>(l(),s("div",{key:r.imdbId,class:"p-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",Be,[r.imdbId?.startsWith("tt")?(l(),s("img",{key:0,src:`/posters/${r.imdbId}.jpg`,alt:r.title,class:"w-full h-full object-cover",onError:b[0]||(b[0]=k=>k.target.style.display="none")},null,40,Ee)):(l(),s("div",Ve,[...b[2]||(b[2]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",Re,[e("div",qe,[e("h4",Oe,f(r.title),1),e("span",ze,f(r.year),1)]),e("p",Pe,f(r.metadata?.Director||"Unknown Director"),1),e("p",We,f(r.imdbId),1)]),e("button",{class:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Remove from collection",disabled:o(p)===r.imdbId,onClick:k=>g(r)},[o(p)===r.imdbId?(l(),s("div",Je)):(l(),s("div",Qe))],8,He)]))),128))])):(l(),s("div",Ye,[...b[3]||(b[3]=[e("div",{class:"i-mdi-movie-off-outline text-4xl mx-auto mb-2 opacity-20"},null,-1),e("p",null,"No movies in this collection yet.",-1)])]))]))}}),Ke=Object.assign(Ge,{__name:"AdminCollectionMoviesList"}),Xe={class:"min-h-screen bg-theme-background text-theme-text p-4 md:ml-16 transition-colors duration-300"},Ze={class:"max-w-7xl mx-auto space-y-8"},et={key:0,class:"flex flex-col items-center justify-center h-[60vh] text-center"},tt={key:1},ot={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},st={class:"bg-theme-surface border border-theme-border rounded-2xl p-6"},lt={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},it={class:"space-y-6"},nt={class:"space-y-6"},bt=j({__name:"index",setup(C){const w=h(!1),m=h(""),y=h(null),v=R();E(async()=>{w.value=Q(),w.value&&await v.loadFromFile()});const c=()=>{y.value&&y.value.refresh()};return(x,i)=>{const p=q,u=pe,g=Le,n=Ke;return l(),s("div",Xe,[e("main",Ze,[o(w)?(l(),s("div",tt,[e("header",ot,[i[6]||(i[6]=e("div",null,[e("h1",{class:"text-3xl font-bold flex items-center gap-3"},[e("div",{class:"i-mdi-movie-edit text-blue-600"}),$(" Collection Editor ")]),e("p",{class:"text-theme-textmuted mt-1"}," Add and remove movies from collections ")],-1)),I(p,{to:"/admin",class:"px-4 py-2 text-sm bg-theme-surface border border-theme-border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"},{default:B(()=>[...i[5]||(i[5]=[e("div",{class:"i-mdi-arrow-left"},null,-1),$(" Back to Dashboard ",-1)])]),_:1})]),e("section",st,[I(u,{onSelect:i[0]||(i[0]=b=>m.value=b)})]),o(m)?(l(),s("section",lt,[e("div",it,[i[7]||(i[7]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-database-search text-blue-600"}),$(" Search Library ")],-1)),I(g,{"collection-id":o(m),onAdd:c},null,8,["collection-id"])]),e("div",nt,[i[8]||(i[8]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-playlist-play text-blue-600"}),$(" Collection Movies ")],-1)),I(n,{ref_key:"moviesList",ref:y,"collection-id":o(m)},null,8,["collection-id"])])])):M("",!0)])):(l(),s("div",et,[i[2]||(i[2]=e("div",{class:"i-mdi-lock text-64px text-gray-300 dark:text-gray-700 mb-4"},null,-1)),i[3]||(i[3]=e("h1",{class:"text-2xl font-bold mb-2"}," Access Denied ",-1)),i[4]||(i[4]=e("p",{class:"text-theme-textmuted"}," The admin interface is only available on localhost. ",-1)),I(p,{to:"/",class:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors"},{default:B(()=>[...i[1]||(i[1]=[$(" Back to Home ",-1)])]),_:1})]))])])}}});export{bt as default};
