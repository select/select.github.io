import{_ as se}from"./Dnhevfps.js";import{e as N,s as B,f as U,m as y,A as oe,h as Z,c as i,a as e,k as w,d as v,F as T,r as A,l as o,t as c,J as D,v as j,z as E,B as J,y as q,o as n,q as L,D as ee,Y as le,p as G,b as F,Z as ie,$ as ne,w as X}from"./DYx0OpAO.js";import{u as P}from"./BL-m2N7M.js";import{_ as re}from"./CsE9ErEd.js";import{g as te}from"./D_u2jzxj.js";import{u as O}from"./ByVybQxj.js";import{i as ae}from"./BH85bPq3.js";const de={class:"space-y-4"},ce={class:"flex items-center justify-between"},ue={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},me=["onClick"],fe={class:"flex items-center justify-between mb-2 pr-12"},be={key:0,class:"flex flex-wrap gap-1 mb-2"},xe={class:"text-xs text-theme-textmuted line-clamp-1 mb-2"},pe={class:"flex items-center gap-2 text-xs font-mono bg-theme-bg/50 px-2 py-1 rounded w-fit"},ve=["onClick"],ge=["onClick"],he={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},ye={class:"bg-theme-surface rounded-2xl w-full max-w-lg shadow-2xl border border-theme-border overflow-hidden"},_e={class:"p-6 border-b border-theme-border flex items-center justify-between"},ke={class:"text-xl font-bold"},we=["disabled"],Se={class:"flex flex-wrap gap-2 p-3 bg-theme-background border border-theme-border rounded-lg min-h-[50px]"},$e=["onClick"],Ce={class:"relative flex-1 min-w-[120px]"},Ie=["onKeydown"],Me={key:0,class:"absolute z-10 left-0 right-0 mt-2 bg-theme-surface border border-theme-border rounded-lg shadow-xl max-h-48 overflow-y-auto"},Te=["onMousedown"],Ae={class:"pt-4 flex gap-3"},Ve=["disabled"],Qe={key:0,class:"i-mdi-loading animate-spin mx-auto"},Fe={key:1},Ye=N({__name:"AdminCollectionSelector",emits:["select"],setup(I,{emit:$}){const b=P(),{collections:p}=B(b),u=U(()=>Array.from(p.value.values())),g=y(""),x=$,C=r=>{g.value=r,x("select",r)},S=y(!1),_=y(null),l=y(!1),t=oe({id:"",name:"",description:"",tags:[]}),s=y(""),f=y(!1),k=U(()=>{const r=new Set;return p.value.forEach(a=>{a.tags&&a.tags.forEach(m=>r.add(m))}),Array.from(r).sort()}),M=U(()=>{const r=s.value.toLowerCase().trim();return k.value.filter(a=>a.toLowerCase().includes(r)&&!t.tags.includes(a))}),V=()=>{const r=s.value.trim();r&&!t.tags.includes(r)&&(t.tags.push(r),s.value="")},H=r=>{t.tags=t.tags.filter(a=>a!==r)},z=()=>{s.value===""&&t.tags.length>0&&t.tags.pop()},K=r=>{t.tags.includes(r)||t.tags.push(r),s.value="",f.value=!1},Y=()=>{setTimeout(()=>{f.value=!1},200)},W=r=>{_.value=r,t.id=r.id,t.name=r.name,t.description=r.description,t.tags=[...r.tags||[]]},h=()=>{S.value=!1,_.value=null,t.id="",t.name="",t.description="",t.tags=[],s.value="",f.value=!1},d=async()=>{l.value=!0;try{_.value?(await $fetch("/api/admin/collections/update-collection",{method:"POST",body:{collectionId:t.id,updates:{name:t.name,description:t.description,tags:{action:"set",values:t.tags}}}})).success&&(await b.loadCollections(),h()):(await $fetch("/api/admin/collections/create",{method:"POST",body:t})).success&&(await b.loadCollections(),h())}catch{}finally{l.value=!1}},R=async r=>{if(confirm(`Are you sure you want to delete the collection "${r.name}"? This cannot be undone.`))try{(await $fetch("/api/admin/collections/delete",{method:"POST",body:{id:r.id}})).success&&(g.value===r.id&&(g.value="",x("select","")),await b.loadCollections())}catch{}};return Z(async()=>{b.isLoaded||await b.loadCollections()}),(r,a)=>(n(),i("div",de,[e("div",ce,[a[7]||(a[7]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Select Collection ",-1)),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:a[0]||(a[0]=m=>S.value=!0)},[...a[6]||(a[6]=[e("div",{class:"i-mdi-plus"},null,-1),v(" Create New ",-1)])])]),e("div",ue,[(n(!0),i(T,null,A(o(u),m=>(n(),i("div",{key:m.id,class:"relative group"},[e("button",{class:L(["w-full text-left p-4 rounded-xl border transition-all h-full",[o(g)===m.id?"bg-blue-600/10 border-blue-600 ring-2 ring-blue-600/20":"bg-theme-surface border-theme-border hover:border-theme-textmuted"]]),onClick:Q=>C(m.id)},[e("div",fe,[e("span",{class:L(["font-bold text-lg truncate",o(g)===m.id?"text-blue-600 dark:text-blue-400":""])},c(m.name),3)]),m.tags?.length?(n(),i("div",be,[(n(!0),i(T,null,A(m.tags,Q=>(n(),i("span",{key:Q,class:"px-1.5 py-0.5 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded text-[10px] font-medium"},c(Q),1))),128))])):w("",!0),e("p",xe,c(m.description||"No description"),1),e("div",pe,[a[8]||(a[8]=e("div",{class:"i-mdi-movie"},null,-1)),v(" "+c(m.movieIds.length)+" movies ",1)])],10,me),e("div",{class:L(["absolute top-3 right-3 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",{"opacity-100":o(g)===m.id}])},[e("button",{class:"p-1.5 hover:bg-theme-selection rounded-lg text-blue-500 transition-colors",title:"Edit Collection",onClick:D(Q=>W(m),["stop"])},[...a[9]||(a[9]=[e("div",{class:"i-mdi-pencil text-lg"},null,-1)])],8,ve),e("button",{class:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg text-red-500 transition-colors",title:"Delete Collection",onClick:D(Q=>R(m),["stop"])},[...a[10]||(a[10]=[e("div",{class:"i-mdi-delete text-lg"},null,-1)])],8,ge)],2)]))),128))]),o(S)||o(_)?(n(),i("div",he,[e("div",ye,[e("div",_e,[e("h3",ke,c(o(_)?"Edit Collection":"Create New Collection"),1),e("button",{class:"p-2 hover:bg-theme-selection rounded-full transition-colors",onClick:h},[...a[11]||(a[11]=[e("div",{class:"i-mdi-close text-xl"},null,-1)])])]),e("form",{class:"p-6 space-y-4",onSubmit:D(d,["prevent"])},[e("div",null,[a[12]||(a[12]=e("label",{class:"block text-sm font-bold mb-1"},"ID (URL Slug)",-1)),j(e("input",{"onUpdate:modelValue":a[1]||(a[1]=m=>o(t).id=m),type:"text",placeholder:"e.g. charlie-chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm font-mono",disabled:!!o(_),required:""},null,8,we),[[E,o(t).id]])]),e("div",null,[a[13]||(a[13]=e("label",{class:"block text-sm font-bold mb-1"},"Name",-1)),j(e("input",{"onUpdate:modelValue":a[2]||(a[2]=m=>o(t).name=m),type:"text",placeholder:"e.g. Charlie Chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm",required:""},null,512),[[E,o(t).name]])]),e("div",null,[a[14]||(a[14]=e("label",{class:"block text-sm font-bold mb-1"},"Description",-1)),j(e("textarea",{"onUpdate:modelValue":a[3]||(a[3]=m=>o(t).description=m),rows:"3",placeholder:"Describe this collection...",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm"},null,512),[[E,o(t).description]])]),e("div",null,[a[16]||(a[16]=e("label",{class:"block text-sm font-bold mb-1"},"Tags",-1)),e("div",Se,[(n(!0),i(T,null,A(o(t).tags,m=>(n(),i("div",{key:m,class:"flex items-center gap-1.5 px-3 py-1 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded-full text-sm font-medium group"},[v(c(m)+" ",1),e("button",{type:"button",class:"p-0.5 hover:bg-blue-600/20 rounded-full transition-colors",onClick:Q=>H(m)},[...a[15]||(a[15]=[e("div",{class:"i-mdi-close text-xs"},null,-1)])],8,$e)]))),128)),e("div",Ce,[j(e("input",{"onUpdate:modelValue":a[4]||(a[4]=m=>q(s)?s.value=m:null),type:"text",placeholder:"Add tag...",class:"w-full bg-transparent border-none focus:ring-0 text-sm py-1",onKeydown:[J(D(V,["prevent"]),["enter"]),J(z,["backspace"])],onFocus:a[5]||(a[5]=m=>f.value=!0),onBlur:Y},null,40,Ie),[[E,o(s)]]),o(f)&&o(M).length>0?(n(),i("div",Me,[(n(!0),i(T,null,A(o(M),m=>(n(),i("button",{key:m,type:"button",class:"w-full text-left px-4 py-2 text-sm hover:bg-theme-selection transition-colors",onMousedown:D(Q=>K(m),["prevent"])},c(m),41,Te))),128))])):w("",!0)])])]),e("div",Ae,[e("button",{type:"button",class:"flex-1 px-4 py-2 border border-theme-border rounded-lg font-bold hover:bg-theme-selection transition-colors",onClick:h}," Cancel "),e("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-500 transition-colors disabled:opacity-50",disabled:o(l)},[o(l)?(n(),i("div",Qe)):(n(),i("span",Fe,c(o(_)?"Update":"Create"),1))],8,Ve)])],32)])])):w("",!0)]))}}),Le=Object.assign(Ye,{__name:"AdminCollectionSelector"}),Re={class:"space-y-4"},De={class:"flex items-center gap-4"},je={class:"relative flex-1"},Ee={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},Ne={key:0,class:"bg-blue-600 text-white px-1.5 py-0.5 rounded-full text-[10px]"},Pe={key:0,class:"flex flex-wrap items-center gap-2"},Ue={key:0,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},Be={key:1,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},Oe={key:2,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},ze={key:1,class:"bg-theme-surface border border-theme-border rounded-2xl overflow-hidden divide-y divide-theme-border"},Ke={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},We=["src","alt"],Ge={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},He={class:"flex-1 min-w-0"},Je={class:"flex items-center gap-2"},Xe={class:"font-bold truncate"},Ze={class:"text-xs text-theme-textmuted font-mono"},qe={class:"text-xs text-theme-textmuted truncate"},et={class:"text-[10px] text-theme-textmuted font-mono mt-0.5"},tt=["disabled","onClick"],st={key:0,class:"i-mdi-loading animate-spin"},ot={key:2,class:"p-8 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},lt=N({__name:"AdminMovieSearch",props:{collectionId:{}},emits:["add"],setup(I,{emit:$}){const b=I,p=$,u=P(),g=O(),{filters:x,activeFiltersCount:C,hasActiveFilters:S}=B(g),{resetFilters:_}=g,l=ee(),t=y(null),s=y(""),f=y([]),k=y(!1),M=y(""),V=y(!1);le("/",h=>{const d=window.document.activeElement,R=d?.tagName==="INPUT"||d?.tagName==="TEXTAREA";h.preventDefault(),R||t.value?.focus()}),G(s,h=>{g.setSearchQuery(h)}),G(()=>x.value.searchQuery,h=>{h!==s.value&&(s.value=h)});const z=ie(async()=>{if(s.value.length<3){f.value=[];return}k.value=!0;try{const h=await $fetch("/api/admin/movies/search",{query:{q:s.value}});f.value=h}catch{l.showToast("Search failed","error")}finally{k.value=!1}},300),K=()=>{z()},Y=h=>u.isMovieInCollection(h,b.collectionId),W=async h=>{M.value=h;try{await u.addMovieToCollection(b.collectionId,h)?(l.showToast("Movie added to collection"),p("add")):l.showToast("Failed to add movie","error")}catch{l.showToast("Error adding movie","error")}finally{M.value=""}};return(h,d)=>{const R=re;return n(),i("div",Re,[e("div",De,[e("div",je,[d[6]||(d[6]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-theme-textmuted"},[e("div",{class:"i-mdi-magnify text-xl"})],-1)),j(e("input",{ref_key:"searchInput",ref:t,"onUpdate:modelValue":d[0]||(d[0]=r=>q(s)?s.value=r:null),type:"text",placeholder:"Search by title, director, writer, plot or IMDb ID...",class:"block w-full pl-10 pr-3 py-3 border border-theme-border rounded-xl bg-theme-surface focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none",onInput:K},null,544),[[E,o(s)]]),o(k)?(n(),i("div",Ee,[...d[5]||(d[5]=[e("div",{class:"i-mdi-loading animate-spin text-blue-600"},null,-1)])])):w("",!0)]),e("button",{class:"px-4 py-3 bg-theme-surface border border-theme-border rounded-xl text-sm font-bold hover:bg-theme-selection transition-colors flex items-center gap-2",onClick:d[1]||(d[1]=r=>V.value=!0)},[d[7]||(d[7]=e("div",{class:"i-mdi-filter-variant"},null,-1)),d[8]||(d[8]=v(" Filters ",-1)),o(C)>0?(n(),i("span",Ne,c(o(C)),1)):w("",!0)])]),o(S)?(n(),i("div",Pe,[o(x).minRating>0?(n(),i("div",Ue,[d[9]||(d[9]=e("div",{class:"i-mdi-star"},null,-1)),v(" "+c(o(x).minRating)+"+ ",1)])):w("",!0),o(x).minYear>0||o(x).maxYear?(n(),i("div",Be,[d[10]||(d[10]=e("div",{class:"i-mdi-calendar"},null,-1)),v(" "+c(o(x).minYear||1910)+" - "+c(o(x).maxYear||2025),1)])):w("",!0),o(x).minVotes>0||o(x).maxVotes?(n(),i("div",Oe,[d[11]||(d[11]=e("div",{class:"i-mdi-account-group"},null,-1)),v(" "+c(o(x).minVotes.toLocaleString())+" - "+c(o(x).maxVotes?o(x).maxVotes.toLocaleString():"Any"),1)])):w("",!0),(n(!0),i(T,null,A(o(x).genres,r=>(n(),i("div",{key:r,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[d[12]||(d[12]=e("div",{class:"i-mdi-movie-filter"},null,-1)),v(" "+c(r),1)]))),128)),(n(!0),i(T,null,A(o(x).sources,r=>(n(),i("div",{key:r,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[d[13]||(d[13]=e("div",{class:"i-mdi-source-branch"},null,-1)),v(" "+c(r),1)]))),128)),e("button",{class:"text-xs text-theme-primary hover:underline ml-2",onClick:d[2]||(d[2]=(...r)=>o(_)&&o(_)(...r))}," Clear All ")])):w("",!0),o(f).length>0?(n(),i("div",ze,[(n(!0),i(T,null,A(o(f),r=>(n(),i("div",{key:r.imdbId,class:"p-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",Ke,[r.imdbId?.startsWith("tt")?(n(),i("img",{key:0,src:("getPosterPath"in h?h.getPosterPath:o(te))(r.imdbId),alt:r.title,class:"w-full h-full object-cover",onError:d[3]||(d[3]=a=>a.target.style.display="none")},null,40,We)):(n(),i("div",Ge,[...d[14]||(d[14]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",He,[e("div",Je,[e("h4",Xe,c(r.title),1),e("span",Ze,c(r.year),1)]),e("p",qe,c(r.metadata?.Director||"Unknown Director"),1),e("p",et,c(r.imdbId),1)]),e("button",{class:L(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1.5 disabled:opacity-50",Y(r.imdbId)?"bg-theme-selection text-theme-textmuted cursor-default":"bg-blue-600 hover:bg-blue-500 text-white"]),disabled:Y(r.imdbId)||o(M)===r.imdbId,onClick:a=>W(r.imdbId)},[o(M)===r.imdbId?(n(),i("div",st)):(n(),i("div",{key:1,class:L(Y(r.imdbId)?"i-mdi-check":"i-mdi-plus")},null,2)),v(" "+c(Y(r.imdbId)?"Added":"Add"),1)],10,tt)]))),128))])):o(s).length>=3&&!o(k)?(n(),i("div",ot,' No movies found for "'+c(o(s))+'" ',1)):w("",!0),F(R,{"is-open":o(V),onClose:d[4]||(d[4]=r=>V.value=!1)},null,8,["is-open"])])}}}),it=Object.assign(lt,{__name:"AdminMovieSearch"}),nt={class:"space-y-4"},rt={key:0,class:"text-sm text-theme-textmuted italic p-4 bg-theme-surface border border-theme-border border-dashed rounded-xl text-center"},at={key:1,class:"space-y-3"},dt={class:"flex items-start justify-between gap-4"},ct={class:"flex-1 space-y-2"},ut={class:"flex items-center gap-2"},mt={class:"font-bold text-sm"},ft={class:"flex flex-wrap gap-2"},bt={key:0,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},xt={key:1,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},pt={key:2,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},vt={key:3,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},gt={key:4,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},ht={key:5,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},yt={class:"flex items-center gap-1"},_t=["onClick"],kt=["onClick"],wt={class:"flex justify-end pt-2"},St=["disabled"],$t=N({__name:"AdminSavedQueryManager",props:{collectionId:{},queries:{}},setup(I){const $=I,b=P(),p=O(),{filters:u}=B(p),g=y(!1),x=async()=>{const l={field:"year",direction:"desc"},t=u.value.sort.field===l.field&&u.value.sort.direction===l.direction,s={searchQuery:u.value.searchQuery,currentPage:1,lastScrollY:0};t||(s.sort={...u.value.sort}),u.value.sources.length>0&&(s.sources=[...u.value.sources]),u.value.minRating>0&&(s.minRating=u.value.minRating),u.value.minYear>0&&(s.minYear=u.value.minYear),u.value.maxYear&&u.value.maxYear>0&&(s.maxYear=u.value.maxYear),u.value.minVotes>0&&(s.minVotes=u.value.minVotes),u.value.maxVotes&&u.value.maxVotes>0&&(s.maxVotes=u.value.maxVotes),u.value.genres.length>0&&(s.genres=[...u.value.genres]),u.value.countries.length>0&&(s.countries=[...u.value.countries]);const f={searchQuery:u.value.searchQuery,filterState:s};await b.addQueryToCollection($.collectionId,f)},C=async l=>{confirm("Are you sure you want to remove this saved query?")&&await b.removeQueryFromCollection($.collectionId,l)},S=l=>{p.resetFilters(),l.searchQuery&&p.setSearchQuery(l.searchQuery),l.filterState.sort&&p.setSort(l.filterState.sort),l.filterState.minRating&&p.setMinRating(l.filterState.minRating),l.filterState.minYear&&p.setMinYear(l.filterState.minYear),l.filterState.maxYear&&p.setMaxYear(l.filterState.maxYear),l.filterState.minVotes&&p.setMinVotes(l.filterState.minVotes),l.filterState.maxVotes&&p.setMaxVotes(l.filterState.maxVotes),l.filterState.genres?.forEach(t=>p.toggleGenre(t)),l.filterState.countries?.forEach(t=>p.toggleCountry(t)),l.filterState.sources?.forEach(t=>p.toggleSource(t))},_=async()=>{g.value=!0;try{const l=await b.refreshCollectionFromQuery($.collectionId);l.success&&alert(`Collection refreshed! Now contains ${l.movieCount} movies.`)}finally{g.value=!1}};return(l,t)=>(n(),i("div",nt,[e("div",{class:"flex items-center justify-between"},[t[1]||(t[1]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Saved Queries ",-1)),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:x},[...t[0]||(t[0]=[e("div",{class:"i-mdi-plus"},null,-1),v(" Save Current Search ",-1)])])]),!I.queries||I.queries.length===0?(n(),i("div",rt," No saved queries for this collection. ")):(n(),i("div",at,[(n(!0),i(T,null,A(I.queries,(s,f)=>(n(),i("div",{key:f,class:"p-4 bg-theme-surface border border-theme-border rounded-xl group hover:border-theme-textmuted transition-all"},[e("div",dt,[e("div",ct,[e("div",ut,[t[2]||(t[2]=e("div",{class:"i-mdi-magnify text-theme-textmuted"},null,-1)),e("span",mt,c(s.searchQuery||"All Movies"),1)]),e("div",ft,[s.filterState.sort?(n(),i("div",bt,[t[3]||(t[3]=e("div",{class:"i-mdi-sort"},null,-1)),v(" "+c(s.filterState.sort.field)+" ("+c(s.filterState.sort.direction)+") ",1)])):w("",!0),s.filterState.minYear&&s.filterState.minYear>0||s.filterState.maxYear?(n(),i("div",xt,[t[4]||(t[4]=e("div",{class:"i-mdi-calendar"},null,-1)),v(" "+c(s.filterState.minYear||1910)+" - "+c(s.filterState.maxYear||2025),1)])):w("",!0),s.filterState.minRating&&s.filterState.minRating>0?(n(),i("div",pt,[t[5]||(t[5]=e("div",{class:"i-mdi-star"},null,-1)),v(" "+c(s.filterState.minRating)+"+ ",1)])):w("",!0),s.filterState.minVotes&&s.filterState.minVotes>0||s.filterState.maxVotes?(n(),i("div",vt,[t[6]||(t[6]=e("div",{class:"i-mdi-account-group"},null,-1)),v(" "+c((s.filterState.minVotes||0).toLocaleString())+" - "+c(s.filterState.maxVotes?s.filterState.maxVotes.toLocaleString():"Any"),1)])):w("",!0),s.filterState.genres?.length?(n(),i("div",gt,[t[7]||(t[7]=e("div",{class:"i-mdi-movie-filter"},null,-1)),v(" "+c(s.filterState.genres.join(", ")),1)])):w("",!0),s.filterState.sources?.length?(n(),i("div",ht,[t[8]||(t[8]=e("div",{class:"i-mdi-source-branch"},null,-1)),v(" "+c(s.filterState.sources.join(", ")),1)])):w("",!0)])]),e("div",yt,[e("button",{class:"p-2 hover:bg-blue-600/10 text-blue-600 rounded-lg transition-colors",title:"Apply Filters",onClick:k=>S(s)},[...t[9]||(t[9]=[e("div",{class:"i-mdi-filter-variant"},null,-1)])],8,_t),e("button",{class:"p-2 hover:bg-red-600/10 text-red-600 rounded-lg transition-colors",title:"Remove Query",onClick:k=>C(f)},[...t[10]||(t[10]=[e("div",{class:"i-mdi-delete"},null,-1)])],8,kt)])])]))),128))])),e("div",wt,[e("button",{class:"px-4 py-2 bg-theme-primary text-white rounded-lg text-sm font-bold transition-colors flex items-center gap-2 disabled:opacity-50",disabled:o(g)||!I.queries?.length,onClick:_},[e("div",{class:L([o(g)?"i-mdi-loading animate-spin":"i-mdi-refresh"])},null,2),t[11]||(t[11]=v(" Refresh Collection from Queries ",-1))],8,St)])]))}}),Ct=Object.assign($t,{__name:"AdminSavedQueryManager"}),It={class:"space-y-4"},Mt={key:0,class:"p-12 flex justify-center"},Tt={key:1,class:"overflow-hidden divide-y divide-theme-border"},At={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},Vt=["src","alt"],Qt={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},Ft={class:"flex-1 min-w-0"},Yt={class:"flex items-center gap-2"},Lt={class:"font-bold truncate"},Rt={class:"text-xs text-theme-textmuted font-mono"},Dt={class:"text-xs text-theme-textmuted truncate"},jt={class:"text-[10px] text-theme-textmuted font-mono mt-0.5"},Et=["disabled","onClick"],Nt={key:0,class:"i-mdi-loading animate-spin text-xl"},Pt={key:1,class:"i-mdi-trash-can-outline text-xl"},Ut={key:2,class:"p-12 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},Bt=N({__name:"AdminCollectionMoviesList",props:{collectionId:{}},setup(I,{expose:$}){const b=I,p=P(),u=O(),g=ee(),x=y([]),C=y(!1),S=y(""),_=async()=>{if(b.collectionId){C.value=!0;try{const t=await p.getCollectionById(b.collectionId);if(!t||!t.movieIds||!t.movieIds.length){x.value=[];return}!u.allMovies.size&&!u.isLoading.movies&&await u.loadFromFile();const s=ne(t.movieIds),f=await u.fetchMoviesByIds(s);x.value=s.map(k=>f.find(M=>M.imdbId===k)).filter(k=>!!k)}catch(t){console.error("Failed to load collection movies:",t),g.showToast("Failed to load collection movies","error")}finally{C.value=!1}}},l=async t=>{if(confirm(`Remove "${t.title}" from this collection?`)){S.value=t.imdbId;try{await p.removeMovieFromCollection(b.collectionId,t.imdbId)?(g.showToast("Movie removed from collection"),await _()):g.showToast("Failed to remove movie","error")}catch{g.showToast("Error removing movie","error")}finally{S.value=""}}};return $({refresh:_}),G(()=>b.collectionId,()=>{_()},{immediate:!0}),(t,s)=>(n(),i("div",It,[o(C)?(n(),i("div",Mt,[...s[1]||(s[1]=[e("div",{class:"i-mdi-loading animate-spin text-4xl text-blue-600"},null,-1)])])):o(x).length>0?(n(),i("div",Tt,[(n(!0),i(T,null,A(o(x),f=>(n(),i("div",{key:f.imdbId,class:"py-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",At,[f.imdbId?.startsWith("tt")?(n(),i("img",{key:0,src:("getPosterPath"in t?t.getPosterPath:o(te))(f.imdbId),alt:f.title,class:"w-full h-full object-cover",onError:s[0]||(s[0]=k=>k.target.style.display="none")},null,40,Vt)):(n(),i("div",Qt,[...s[2]||(s[2]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",Ft,[e("div",Yt,[e("h4",Lt,c(f.title),1),e("span",Rt,c(f.year),1)]),e("p",Dt,c(f.metadata?.Director||"Unknown Director"),1),e("p",jt,c(f.imdbId),1)]),e("button",{class:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Remove from collection",disabled:o(S)===f.imdbId,onClick:k=>l(f)},[o(S)===f.imdbId?(n(),i("div",Nt)):(n(),i("div",Pt))],8,Et)]))),128))])):(n(),i("div",Ut,[...s[3]||(s[3]=[e("div",{class:"i-mdi-movie-off-outline text-4xl mx-auto mb-2 opacity-20"},null,-1),e("p",null,"No movies in this collection yet.",-1)])]))]))}}),Ot=Object.assign(Bt,{__name:"AdminCollectionMoviesList"}),zt={class:"min-h-screen bg-theme-background text-theme-text p-4 md:ml-16 transition-colors duration-300"},Kt={class:"max-w-7xl mx-auto space-y-8"},Wt={key:0,class:"flex flex-col items-center justify-center h-[60vh] text-center"},Gt={key:1,class:"flex flex-col gap-8"},Ht={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},Jt={class:"bg-theme-surface border border-theme-border rounded-2xl p-6"},Xt={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},Zt={class:"space-y-8"},qt={class:"space-y-6"},es={class:"space-y-6"},ts={class:"bg-theme-surface border border-theme-border rounded-2xl p-6 space-y-6"},ds=N({__name:"index",setup(I){const $=y(!1),b=y(""),p=y(null),u=O(),g=P(),{collections:x}=B(g),C=U(()=>b.value&&x.value.get(b.value)||null);Z(async()=>{$.value=ae(),$.value&&await u.loadFromFile()});const S=()=>{p.value&&p.value.refresh()};return(_,l)=>{const t=se,s=Le,f=it,k=Ct,M=Ot;return n(),i("div",zt,[e("main",Kt,[o($)?(n(),i("div",Gt,[e("header",Ht,[l[6]||(l[6]=e("div",null,[e("h1",{class:"text-3xl font-bold flex items-center gap-3"},[e("div",{class:"i-mdi-movie-edit text-blue-600"}),v(" Collection Editor ")]),e("p",{class:"text-theme-textmuted mt-1"}," Add and remove movies from collections ")],-1)),F(t,{to:"/admin",class:"px-4 py-2 text-sm bg-theme-surface border border-theme-border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"},{default:X(()=>[...l[5]||(l[5]=[e("div",{class:"i-mdi-arrow-left"},null,-1),v(" Back to Dashboard ",-1)])]),_:1})]),e("section",Jt,[F(s,{onSelect:l[0]||(l[0]=V=>b.value=V)})]),o(b)?(n(),i("section",Xt,[e("div",Zt,[e("div",qt,[l[7]||(l[7]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-magnify text-blue-600"}),v(" Search Library ")],-1)),F(f,{"collection-id":o(b),onAdd:S},null,8,["collection-id"])])]),e("div",es,[e("div",ts,[l[8]||(l[8]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-database-clock text-blue-600"}),v(" Dynamic Queries ")],-1)),F(k,{"collection-id":o(b),queries:o(C)?.savedQueries},null,8,["collection-id","queries"])]),l[9]||(l[9]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-playlist-play text-blue-600"}),v(" Collection Movies ")],-1)),F(M,{ref_key:"moviesList",ref:p,"collection-id":o(b)},null,8,["collection-id"])])])):w("",!0)])):(n(),i("div",Wt,[l[2]||(l[2]=e("div",{class:"i-mdi-lock text-64px text-gray-300 dark:text-gray-700 mb-4"},null,-1)),l[3]||(l[3]=e("h1",{class:"text-2xl font-bold mb-2"}," Access Denied ",-1)),l[4]||(l[4]=e("p",{class:"text-theme-textmuted"}," The admin interface is only available on localhost. ",-1)),F(t,{to:"/",class:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors"},{default:X(()=>[...l[1]||(l[1]=[v(" Back to Home ",-1)])]),_:1})]))])])}}});export{ds as default};
