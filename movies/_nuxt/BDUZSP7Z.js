import{au as y,r as p,am as l,av as w}from"./C1DehbHX.js";function _(a){return`${y().app.baseURL}posters/${a}.jpg`}let d=null;function f(){const a=p(null),u=p(!1),i=new Map,c=p(null);return{init:async n=>(c.value||(c.value=(async()=>{const s=await w(()=>import("./DYNJ4MaO.js"),[],import.meta.url);a.value=new s.default,a.value.onmessage=t=>{const{id:e,error:o,type:m}=t.data;if(m==="init-success"){u.value=!0;const v=i.get(e);v&&(v.resolve(t.data),i.delete(e));return}const g=i.get(e);g&&(o?g.reject(new Error(o)):g.resolve(t.data),i.delete(e))};const r=Math.random().toString(36).substring(7);return new Promise((t,e)=>{i.set(r,{resolve:o=>t(),reject:e}),a.value.postMessage({type:"init",id:r,url:n})})})()),c.value),query:async(n,s=[])=>{if(!u.value)throw new Error("Database not initialized");const r=Math.random().toString(36).substring(7);return new Promise((t,e)=>{i.set(r,{resolve:o=>t(o.result??[]),reject:e}),a.value.postMessage({type:"exec",id:r,sql:n,params:l(s)})})},extendedQuery:async n=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{i.set(s,{resolve:o=>r({result:o.result??[],totalCount:o.totalCount}),reject:t});const e={...n};e.params&&(e.params=l(e.params)),a.value.postMessage({type:"query",id:s,...e})})},lightweightQuery:async n=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{i.set(s,{resolve:o=>r({result:o.result??[],totalCount:o.totalCount}),reject:t});const e={...n};e.params&&(e.params=l(e.params)),a.value.postMessage({type:"query-lightweight",id:s,...e})})},queryByIds:async n=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{i.set(s,{resolve:e=>r(e.result??[]),reject:t}),a.value.postMessage({type:"query-by-ids",id:s,imdbIds:l(n)})})},getCollectionsForMovie:async n=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{i.set(s,{resolve:e=>r(e.result??[]),reject:t}),a.value.postMessage({type:"query-collections-for-movie",id:s,movieId:n})})},getFilterOptions:async()=>{if(!u.value)throw new Error("Database not initialized");const n=Math.random().toString(36).substring(7);return new Promise((s,r)=>{i.set(n,{resolve:t=>s({genres:t.genres??[],countries:t.countries??[],channels:t.channels??[]}),reject:r}),a.value.postMessage({type:"get-filter-options",id:n})})},getMovieCount:async(n={})=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{i.set(s,{resolve:o=>r(o.count??0),reject:t});const e={...n};e.params&&(e.params=l(e.params)),a.value.postMessage({type:"get-movie-count",id:s,...e})})},isReady:u}}function z(){return d||(d=f()),d}export{_ as g,z as u};
