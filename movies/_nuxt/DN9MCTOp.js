import{O as u,m as c}from"./D4tGLWfR.js";import{u as d}from"./DoLz3WoX.js";const p=u("collections",()=>{const s=c(new Map),n=c(!1),l=c(!1),i=c(null),a=async()=>{if(l.value){console.log("[CollectionsStore] Already loaded, skipping");return}n.value=!0,i.value=null;try{const o=await $fetch("/data/collections.json");s.value.clear(),Object.entries(o).filter(([e])=>!e.startsWith("_")).map(([e,r])=>r).forEach(e=>{s.value.set(e.id,e)}),l.value=!0}catch(o){i.value=o.message||"Failed to load collections"}finally{n.value=!1}};return{collections:s,isLoading:n,isLoaded:l,error:i,loadCollections:a,getCollectionById:async o=>(l.value||await a(),s.value.get(o)||null),addMovieToCollection:async(o,t)=>{try{const e=await $fetch("/api/admin/collections/add-movie",{method:"POST",body:{collectionId:o,movieId:t}});return e.success&&(l.value=!1,await a()),e.success}catch{return!1}},removeMovieFromCollection:async(o,t)=>{try{const e=await $fetch("/api/admin/collections/remove-movie",{method:"POST",body:{collectionId:o,movieId:t}});return e.success&&(l.value=!1,await a()),e.success}catch{return!1}},isMovieInCollection:(o,t)=>{const e=s.value.get(t);return e?e.movieIds.includes(o):!1},getCollectionsForMovie:async o=>{try{const t=d();return t.isReady.value?await t.getCollectionsForMovie(o):(l.value||await a(),Array.from(s.value.values()).filter(e=>e.movieIds.includes(o)))}catch(t){return console.error("Failed to get collections for movie:",t),[]}}}});export{p as u};
