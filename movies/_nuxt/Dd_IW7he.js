import{_ as ee}from"./Cz7KpdLU.js";import{e as E,s as B,f as R,m as _,A as te,h as H,c as o,a as e,k as C,d as v,F as V,r as Q,l as t,t as c,J as Y,v as N,z as P,o as l,q as L,D as J,Y as se,p as U,b as F,y as X,Z as oe,B as W,$ as le,w as G}from"./C5QIVIht.js";import{u as D}from"./C_tg1R71.js";import{_ as ie}from"./C-lI_k8f.js";import{g as Z}from"./DLyjB8Jq.js";import{u as O}from"./D_UeB1-2.js";import{i as ne}from"./BH85bPq3.js";const re={class:"space-y-4"},de={class:"flex items-center justify-between"},ae={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},ce=["onClick"],ue={class:"flex items-center justify-between mb-2 pr-12"},me={key:0,class:"i-mdi-check-circle text-blue-600 text-xl flex-shrink-0"},be={key:0,class:"flex flex-wrap gap-1 mb-2"},xe={class:"text-xs text-theme-textmuted line-clamp-1 mb-2"},fe={class:"flex items-center gap-2 text-xs font-mono bg-theme-bg/50 px-2 py-1 rounded w-fit"},pe=["onClick"],ve=["onClick"],ge={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},he={class:"bg-theme-surface rounded-2xl w-full max-w-lg shadow-2xl border border-theme-border overflow-hidden"},ye={class:"p-6 border-b border-theme-border flex items-center justify-between"},_e={class:"text-xl font-bold"},ke=["disabled"],we={class:"pt-4 flex gap-3"},$e=["disabled"],Se={key:0,class:"i-mdi-loading animate-spin mx-auto"},Ce={key:1},Ie=E({__name:"AdminCollectionSelector",emits:["select"],setup(T,{emit:$}){const x=D(),{collections:g}=B(x),a=R(()=>Array.from(g.value.values())),m=_(""),b=$,S=h=>{m.value=h,b("select",h)},I=_(!1),k=_(null),i=_(!1),s=te({id:"",name:"",description:""}),r=h=>{k.value=h,s.id=h.id,s.name=h.name,s.description=h.description},f=()=>{I.value=!1,k.value=null,s.id="",s.name="",s.description=""},w=async()=>{i.value=!0;try{const h=k.value?"/api/admin/collections/update":"/api/admin/collections/create";(await $fetch(h,{method:"POST",body:s})).success&&(await x.loadCollections(),f())}catch{}finally{i.value=!1}},A=async h=>{if(confirm(`Are you sure you want to delete the collection "${h.name}"? This cannot be undone.`))try{(await $fetch("/api/admin/collections/delete",{method:"POST",body:{id:h.id}})).success&&(m.value===h.id&&(m.value="",b("select","")),await x.loadCollections())}catch{}};return H(async()=>{x.isLoaded||await x.loadCollections()}),(h,n)=>(l(),o("div",re,[e("div",de,[n[5]||(n[5]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Select Collection ",-1)),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:n[0]||(n[0]=d=>I.value=!0)},[...n[4]||(n[4]=[e("div",{class:"i-mdi-plus"},null,-1),v(" Create New ",-1)])])]),e("div",ae,[(l(!0),o(V,null,Q(t(a),d=>(l(),o("div",{key:d.id,class:"relative group"},[e("button",{class:L(["w-full text-left p-4 rounded-xl border transition-all h-full",[t(m)===d.id?"bg-blue-600/10 border-blue-600 ring-2 ring-blue-600/20":"bg-theme-surface border-theme-border hover:border-theme-textmuted"]]),onClick:y=>S(d.id)},[e("div",ue,[e("span",{class:L(["font-bold text-lg truncate",t(m)===d.id?"text-blue-600 dark:text-blue-400":""])},c(d.name),3),t(m)===d.id?(l(),o("div",me)):C("",!0)]),d.tags?.length?(l(),o("div",be,[(l(!0),o(V,null,Q(d.tags,y=>(l(),o("span",{key:y,class:"px-1.5 py-0.5 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded text-[10px] font-medium"},c(y),1))),128))])):C("",!0),e("p",xe,c(d.description||"No description"),1),e("div",fe,[n[6]||(n[6]=e("div",{class:"i-mdi-movie"},null,-1)),v(" "+c(d.movieIds.length)+" movies ",1)])],10,ce),e("div",{class:L(["absolute top-3 right-3 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",{"opacity-100":t(m)===d.id}])},[e("button",{class:"p-1.5 hover:bg-theme-selection rounded-lg text-blue-500 transition-colors",title:"Edit Collection",onClick:Y(y=>r(d),["stop"])},[...n[7]||(n[7]=[e("div",{class:"i-mdi-pencil text-lg"},null,-1)])],8,pe),e("button",{class:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg text-red-500 transition-colors",title:"Delete Collection",onClick:Y(y=>A(d),["stop"])},[...n[8]||(n[8]=[e("div",{class:"i-mdi-delete text-lg"},null,-1)])],8,ve)],2)]))),128))]),t(I)||t(k)?(l(),o("div",ge,[e("div",he,[e("div",ye,[e("h3",_e,c(t(k)?"Edit Collection":"Create New Collection"),1),e("button",{class:"p-2 hover:bg-theme-selection rounded-full transition-colors",onClick:f},[...n[9]||(n[9]=[e("div",{class:"i-mdi-close text-xl"},null,-1)])])]),e("form",{class:"p-6 space-y-4",onSubmit:Y(w,["prevent"])},[e("div",null,[n[10]||(n[10]=e("label",{class:"block text-sm font-bold mb-1"},"ID (URL Slug)",-1)),N(e("input",{"onUpdate:modelValue":n[1]||(n[1]=d=>t(s).id=d),type:"text",placeholder:"e.g. charlie-chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm font-mono",disabled:!!t(k),required:""},null,8,ke),[[P,t(s).id]])]),e("div",null,[n[11]||(n[11]=e("label",{class:"block text-sm font-bold mb-1"},"Name",-1)),N(e("input",{"onUpdate:modelValue":n[2]||(n[2]=d=>t(s).name=d),type:"text",placeholder:"e.g. Charlie Chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm",required:""},null,512),[[P,t(s).name]])]),e("div",null,[n[12]||(n[12]=e("label",{class:"block text-sm font-bold mb-1"},"Description",-1)),N(e("textarea",{"onUpdate:modelValue":n[3]||(n[3]=d=>t(s).description=d),rows:"3",placeholder:"Describe this collection...",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm"},null,512),[[P,t(s).description]])]),e("div",we,[e("button",{type:"button",class:"flex-1 px-4 py-2 border border-theme-border rounded-lg font-bold hover:bg-theme-selection transition-colors",onClick:f}," Cancel "),e("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-500 transition-colors disabled:opacity-50",disabled:t(i)},[t(i)?(l(),o("div",Se)):(l(),o("span",Ce,c(t(k)?"Update":"Create"),1))],8,$e)])],32)])])):C("",!0)]))}}),Me=Object.assign(Ie,{__name:"AdminCollectionSelector"}),Te={class:"space-y-4"},Ae={class:"flex items-center gap-4"},Ve={class:"relative flex-1"},Qe={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},Fe={key:0,class:"bg-blue-600 text-white px-1.5 py-0.5 rounded-full text-[10px]"},je={key:0,class:"flex flex-wrap items-center gap-2"},Le={key:0,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},Ee={key:1,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},De={key:2,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},Re={key:1,class:"bg-theme-surface border border-theme-border rounded-2xl overflow-hidden divide-y divide-theme-border"},Ye={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},Ne=["src","alt"],Pe={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},Be={class:"flex-1 min-w-0"},Ue={class:"flex items-center gap-2"},Oe={class:"font-bold truncate"},ze={class:"text-xs text-theme-textmuted font-mono"},Ke={class:"text-xs text-theme-textmuted truncate"},We={class:"text-[10px] text-theme-textmuted font-mono mt-0.5"},Ge=["disabled","onClick"],He={key:0,class:"i-mdi-loading animate-spin"},Je={key:2,class:"p-8 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},Xe=E({__name:"AdminMovieSearch",props:{collectionId:{}},emits:["add"],setup(T,{emit:$}){const x=T,g=$,a=D(),m=O(),{filters:b,activeFiltersCount:S,hasActiveFilters:I}=B(m),{resetFilters:k}=m,i=J(),s=_(null),r=_(""),f=_([]),w=_(!1),A=_(""),h=_(!1);se("/",M=>{const u=window.document.activeElement,z=u?.tagName==="INPUT"||u?.tagName==="TEXTAREA";M.preventDefault(),z||s.value?.focus()}),U(r,M=>{m.setSearchQuery(M)}),U(()=>b.value.searchQuery,M=>{M!==r.value&&(r.value=M)});const d=oe(async()=>{if(r.value.length<3){f.value=[];return}w.value=!0;try{const M=await $fetch("/api/admin/movies/search",{query:{q:r.value}});f.value=M}catch{i.showToast("Search failed","error")}finally{w.value=!1}},300),y=()=>{d()},j=M=>a.isMovieInCollection(M,x.collectionId),q=async M=>{A.value=M;try{await a.addMovieToCollection(x.collectionId,M)?(i.showToast("Movie added to collection"),g("add")):i.showToast("Failed to add movie","error")}catch{i.showToast("Error adding movie","error")}finally{A.value=""}};return(M,u)=>{const z=ie;return l(),o("div",Te,[e("div",Ae,[e("div",Ve,[u[6]||(u[6]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-theme-textmuted"},[e("div",{class:"i-mdi-magnify text-xl"})],-1)),N(e("input",{ref_key:"searchInput",ref:s,"onUpdate:modelValue":u[0]||(u[0]=p=>X(r)?r.value=p:null),type:"text",placeholder:"Search by title, director, writer, plot or IMDb ID...",class:"block w-full pl-10 pr-3 py-3 border border-theme-border rounded-xl bg-theme-surface focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none",onInput:y},null,544),[[P,t(r)]]),t(w)?(l(),o("div",Qe,[...u[5]||(u[5]=[e("div",{class:"i-mdi-loading animate-spin text-blue-600"},null,-1)])])):C("",!0)]),e("button",{class:"px-4 py-3 bg-theme-surface border border-theme-border rounded-xl text-sm font-bold hover:bg-theme-selection transition-colors flex items-center gap-2",onClick:u[1]||(u[1]=p=>h.value=!0)},[u[7]||(u[7]=e("div",{class:"i-mdi-filter-variant"},null,-1)),u[8]||(u[8]=v(" Filters ",-1)),t(S)>0?(l(),o("span",Fe,c(t(S)),1)):C("",!0)])]),t(I)?(l(),o("div",je,[t(b).minRating>0?(l(),o("div",Le,[u[9]||(u[9]=e("div",{class:"i-mdi-star"},null,-1)),v(" "+c(t(b).minRating)+"+ ",1)])):C("",!0),t(b).minYear>0||t(b).maxYear?(l(),o("div",Ee,[u[10]||(u[10]=e("div",{class:"i-mdi-calendar"},null,-1)),v(" "+c(t(b).minYear||1910)+" - "+c(t(b).maxYear||2025),1)])):C("",!0),t(b).minVotes>0||t(b).maxVotes?(l(),o("div",De,[u[11]||(u[11]=e("div",{class:"i-mdi-account-group"},null,-1)),v(" "+c(t(b).minVotes.toLocaleString())+" - "+c(t(b).maxVotes?t(b).maxVotes.toLocaleString():"Any"),1)])):C("",!0),(l(!0),o(V,null,Q(t(b).genres,p=>(l(),o("div",{key:p,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[u[12]||(u[12]=e("div",{class:"i-mdi-movie-filter"},null,-1)),v(" "+c(p),1)]))),128)),(l(!0),o(V,null,Q(t(b).sources,p=>(l(),o("div",{key:p,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[u[13]||(u[13]=e("div",{class:"i-mdi-source-branch"},null,-1)),v(" "+c(p),1)]))),128)),e("button",{class:"text-xs text-theme-primary hover:underline ml-2",onClick:u[2]||(u[2]=(...p)=>t(k)&&t(k)(...p))}," Clear All ")])):C("",!0),t(f).length>0?(l(),o("div",Re,[(l(!0),o(V,null,Q(t(f),p=>(l(),o("div",{key:p.imdbId,class:"p-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",Ye,[p.imdbId?.startsWith("tt")?(l(),o("img",{key:0,src:("getPosterPath"in M?M.getPosterPath:t(Z))(p.imdbId),alt:p.title,class:"w-full h-full object-cover",onError:u[3]||(u[3]=K=>K.target.style.display="none")},null,40,Ne)):(l(),o("div",Pe,[...u[14]||(u[14]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",Be,[e("div",Ue,[e("h4",Oe,c(p.title),1),e("span",ze,c(p.year),1)]),e("p",Ke,c(p.metadata?.Director||"Unknown Director"),1),e("p",We,c(p.imdbId),1)]),e("button",{class:L(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1.5 disabled:opacity-50",j(p.imdbId)?"bg-theme-selection text-theme-textmuted cursor-default":"bg-blue-600 hover:bg-blue-500 text-white"]),disabled:j(p.imdbId)||t(A)===p.imdbId,onClick:K=>q(p.imdbId)},[t(A)===p.imdbId?(l(),o("div",He)):(l(),o("div",{key:1,class:L(j(p.imdbId)?"i-mdi-check":"i-mdi-plus")},null,2)),v(" "+c(j(p.imdbId)?"Added":"Add"),1)],10,Ge)]))),128))])):t(r).length>=3&&!t(w)?(l(),o("div",Je,' No movies found for "'+c(t(r))+'" ',1)):C("",!0),F(z,{"is-open":t(h),onClose:u[4]||(u[4]=p=>h.value=!1)},null,8,["is-open"])])}}}),Ze=Object.assign(Xe,{__name:"AdminMovieSearch"}),qe={class:"space-y-4"},et={class:"flex flex-wrap gap-2 p-3 bg-theme-surface border border-theme-border rounded-xl min-h-[50px]"},tt=["onClick"],st={class:"relative flex-1 min-w-[120px]"},ot=["onKeydown"],lt={key:0,class:"absolute z-10 left-0 right-0 mt-2 bg-theme-surface border border-theme-border rounded-lg shadow-xl max-h-48 overflow-y-auto"},it=["onMousedown"],nt={class:"flex justify-end"},rt=["disabled"],dt={key:0,class:"i-mdi-loading animate-spin"},at={key:1,class:"i-mdi-content-save"},ct=E({__name:"AdminCollectionTagsEditor",props:{collectionId:{},initialTags:{}},setup(T){const $=T,x=D(),{collections:g}=B(x),a=_([...$.initialTags||[]]),m=_(""),b=_(!1),S=_(!1),I=R(()=>{const n=$.initialTags||[];return a.value.length!==n.length?!0:a.value.some((d,y)=>d!==n[y])}),k=R(()=>{const n=new Set;return g.value.forEach(d=>{d.tags&&d.tags.forEach(y=>n.add(y))}),Array.from(n).sort()}),i=R(()=>{const n=m.value.toLowerCase().trim();return k.value.filter(d=>d.toLowerCase().includes(n)&&!a.value.includes(d))}),s=()=>{const n=m.value.trim();n&&!a.value.includes(n)&&(a.value.push(n),m.value="")},r=n=>{a.value=a.value.filter(d=>d!==n)},f=()=>{m.value===""&&a.value.length>0&&a.value.pop()},w=n=>{a.value.includes(n)||a.value.push(n),m.value="",S.value=!1},A=()=>{setTimeout(()=>{S.value=!1},200)},h=async()=>{b.value=!0;try{const n=await x.updateCollectionTags($.collectionId,a.value)}finally{b.value=!1}};return U(()=>$.initialTags,n=>{a.value=[...n||[]]},{deep:!0}),(n,d)=>(l(),o("div",qe,[d[4]||(d[4]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Collection Tags ",-1)),e("div",et,[(l(!0),o(V,null,Q(t(a),y=>(l(),o("div",{key:y,class:"flex items-center gap-1.5 px-3 py-1 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded-full text-sm font-medium group"},[v(c(y)+" ",1),e("button",{class:"p-0.5 hover:bg-blue-600/20 rounded-full transition-colors",onClick:j=>r(y)},[...d[2]||(d[2]=[e("div",{class:"i-mdi-close text-xs"},null,-1)])],8,tt)]))),128)),e("div",st,[N(e("input",{"onUpdate:modelValue":d[0]||(d[0]=y=>X(m)?m.value=y:null),type:"text",placeholder:"Add tag...",class:"w-full bg-transparent border-none focus:ring-0 text-sm py-1",onKeydown:[W(Y(s,["prevent"]),["enter"]),W(f,["backspace"])],onFocus:d[1]||(d[1]=y=>S.value=!0),onBlur:A},null,40,ot),[[P,t(m)]]),t(S)&&t(i).length>0?(l(),o("div",lt,[(l(!0),o(V,null,Q(t(i),y=>(l(),o("button",{key:y,class:"w-full text-left px-4 py-2 text-sm hover:bg-theme-selection transition-colors",onMousedown:Y(j=>w(y),["prevent"])},c(y),41,it))),128))])):C("",!0)])]),e("div",nt,[e("button",{class:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm font-bold transition-colors flex items-center gap-2 disabled:opacity-50",disabled:!t(I)||t(b),onClick:h},[t(b)?(l(),o("div",dt)):(l(),o("div",at)),d[3]||(d[3]=v(" Save Tags ",-1))],8,rt)])]))}}),ut=Object.assign(ct,{__name:"AdminCollectionTagsEditor"}),mt={class:"space-y-4"},bt={key:0,class:"text-sm text-theme-textmuted italic p-4 bg-theme-surface border border-theme-border border-dashed rounded-xl text-center"},xt={key:1,class:"space-y-3"},ft={class:"flex items-start justify-between gap-4"},pt={class:"flex-1 space-y-2"},vt={class:"flex items-center gap-2"},gt={class:"font-bold text-sm"},ht={class:"flex flex-wrap gap-2"},yt={class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},_t={key:0,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},kt={key:1,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},wt={key:2,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},$t={key:3,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},St={key:4,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Ct={class:"flex items-center gap-1"},It=["onClick"],Mt=["onClick"],Tt={class:"flex justify-end pt-2"},At=["disabled"],Vt=E({__name:"AdminSavedQueryManager",props:{collectionId:{},queries:{}},setup(T){const $=T,x=D(),g=O(),{filters:a}=B(g),m=_(!1),b=async()=>{const i={sort:{...a.value.sort},sources:[...a.value.sources],minRating:a.value.minRating,minYear:a.value.minYear,maxYear:a.value.maxYear,minVotes:a.value.minVotes,maxVotes:a.value.maxVotes,genres:[...a.value.genres],countries:[...a.value.countries],searchQuery:a.value.searchQuery,currentPage:1,lastScrollY:0},s={searchQuery:a.value.searchQuery,filterState:i};await x.addQueryToCollection($.collectionId,s)},S=async i=>{confirm("Are you sure you want to remove this saved query?")&&await x.removeQueryFromCollection($.collectionId,i)},I=i=>{g.resetFilters(),g.setSearchQuery(i.searchQuery),g.setSort(i.filterState.sort),g.setMinRating(i.filterState.minRating),g.setMinYear(i.filterState.minYear),i.filterState.maxYear&&g.setMaxYear(i.filterState.maxYear),g.setMinVotes(i.filterState.minVotes),i.filterState.maxVotes&&g.setMaxVotes(i.filterState.maxVotes),i.filterState.genres.forEach(s=>g.toggleGenre(s)),i.filterState.countries.forEach(s=>g.toggleCountry(s)),i.filterState.sources.forEach(s=>g.toggleSource(s))},k=async()=>{m.value=!0;try{const i=await x.refreshCollectionFromQuery($.collectionId);i.success&&alert(`Collection refreshed! Now contains ${i.movieCount} movies.`)}finally{m.value=!1}};return(i,s)=>(l(),o("div",mt,[e("div",{class:"flex items-center justify-between"},[s[1]||(s[1]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Saved Queries ",-1)),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:b},[...s[0]||(s[0]=[e("div",{class:"i-mdi-plus"},null,-1),v(" Save Current Search ",-1)])])]),!T.queries||T.queries.length===0?(l(),o("div",bt," No saved queries for this collection. ")):(l(),o("div",xt,[(l(!0),o(V,null,Q(T.queries,(r,f)=>(l(),o("div",{key:f,class:"p-4 bg-theme-surface border border-theme-border rounded-xl group hover:border-theme-textmuted transition-all"},[e("div",ft,[e("div",pt,[e("div",vt,[s[2]||(s[2]=e("div",{class:"i-mdi-magnify text-theme-textmuted"},null,-1)),e("span",gt,c(r.searchQuery||"All Movies"),1)]),e("div",ht,[e("div",yt,[s[3]||(s[3]=e("div",{class:"i-mdi-sort"},null,-1)),v(" "+c(r.filterState.sort.field)+" ("+c(r.filterState.sort.direction)+") ",1)]),r.filterState.minYear>0||r.filterState.maxYear?(l(),o("div",_t,[s[4]||(s[4]=e("div",{class:"i-mdi-calendar"},null,-1)),v(" "+c(r.filterState.minYear||1910)+" - "+c(r.filterState.maxYear||2025),1)])):C("",!0),r.filterState.minRating>0?(l(),o("div",kt,[s[5]||(s[5]=e("div",{class:"i-mdi-star"},null,-1)),v(" "+c(r.filterState.minRating)+"+ ",1)])):C("",!0),r.filterState.minVotes>0||r.filterState.maxVotes?(l(),o("div",wt,[s[6]||(s[6]=e("div",{class:"i-mdi-account-group"},null,-1)),v(" "+c(r.filterState.minVotes.toLocaleString())+" - "+c(r.filterState.maxVotes?r.filterState.maxVotes.toLocaleString():"Any"),1)])):C("",!0),r.filterState.genres?.length?(l(),o("div",$t,[s[7]||(s[7]=e("div",{class:"i-mdi-movie-filter"},null,-1)),v(" "+c(r.filterState.genres.join(", ")),1)])):C("",!0),r.filterState.sources?.length?(l(),o("div",St,[s[8]||(s[8]=e("div",{class:"i-mdi-source-branch"},null,-1)),v(" "+c(r.filterState.sources.join(", ")),1)])):C("",!0)])]),e("div",Ct,[e("button",{class:"p-2 hover:bg-blue-600/10 text-blue-600 rounded-lg transition-colors",title:"Apply Filters",onClick:w=>I(r)},[...s[9]||(s[9]=[e("div",{class:"i-mdi-filter-variant"},null,-1)])],8,It),e("button",{class:"p-2 hover:bg-red-600/10 text-red-600 rounded-lg transition-colors",title:"Remove Query",onClick:w=>S(f)},[...s[10]||(s[10]=[e("div",{class:"i-mdi-delete"},null,-1)])],8,Mt)])])]))),128))])),e("div",Tt,[e("button",{class:"px-4 py-2 bg-theme-primary text-white rounded-lg text-sm font-bold transition-colors flex items-center gap-2 disabled:opacity-50",disabled:t(m)||!T.queries?.length,onClick:k},[e("div",{class:L([t(m)?"i-mdi-loading animate-spin":"i-mdi-refresh"])},null,2),s[11]||(s[11]=v(" Refresh Collection from Queries ",-1))],8,At)])]))}}),Qt=Object.assign(Vt,{__name:"AdminSavedQueryManager"}),Ft={class:"space-y-4"},jt={key:0,class:"p-12 flex justify-center"},Lt={key:1,class:"overflow-hidden divide-y divide-theme-border"},Et={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},Dt=["src","alt"],Rt={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},Yt={class:"flex-1 min-w-0"},Nt={class:"flex items-center gap-2"},Pt={class:"font-bold truncate"},Bt={class:"text-xs text-theme-textmuted font-mono"},Ut={class:"text-xs text-theme-textmuted truncate"},Ot={class:"text-[10px] text-theme-textmuted font-mono mt-0.5"},zt=["disabled","onClick"],Kt={key:0,class:"i-mdi-loading animate-spin text-xl"},Wt={key:1,class:"i-mdi-trash-can-outline text-xl"},Gt={key:2,class:"p-12 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},Ht=E({__name:"AdminCollectionMoviesList",props:{collectionId:{}},setup(T,{expose:$}){const x=T,g=D(),a=O(),m=J(),b=_([]),S=_(!1),I=_(""),k=async()=>{if(x.collectionId){S.value=!0;try{const s=await g.getCollectionById(x.collectionId);if(!s||!s.movieIds||!s.movieIds.length){b.value=[];return}!a.allMovies.size&&!a.isLoading.movies&&await a.loadFromFile();const r=le(s.movieIds),f=await a.fetchMoviesByIds(r);b.value=r.map(w=>f.find(A=>A.imdbId===w)).filter(w=>!!w)}catch(s){console.error("Failed to load collection movies:",s),m.showToast("Failed to load collection movies","error")}finally{S.value=!1}}},i=async s=>{if(confirm(`Remove "${s.title}" from this collection?`)){I.value=s.imdbId;try{await g.removeMovieFromCollection(x.collectionId,s.imdbId)?(m.showToast("Movie removed from collection"),await k()):m.showToast("Failed to remove movie","error")}catch{m.showToast("Error removing movie","error")}finally{I.value=""}}};return $({refresh:k}),U(()=>x.collectionId,()=>{k()},{immediate:!0}),(s,r)=>(l(),o("div",Ft,[t(S)?(l(),o("div",jt,[...r[1]||(r[1]=[e("div",{class:"i-mdi-loading animate-spin text-4xl text-blue-600"},null,-1)])])):t(b).length>0?(l(),o("div",Lt,[(l(!0),o(V,null,Q(t(b),f=>(l(),o("div",{key:f.imdbId,class:"py-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",Et,[f.imdbId?.startsWith("tt")?(l(),o("img",{key:0,src:("getPosterPath"in s?s.getPosterPath:t(Z))(f.imdbId),alt:f.title,class:"w-full h-full object-cover",onError:r[0]||(r[0]=w=>w.target.style.display="none")},null,40,Dt)):(l(),o("div",Rt,[...r[2]||(r[2]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",Yt,[e("div",Nt,[e("h4",Pt,c(f.title),1),e("span",Bt,c(f.year),1)]),e("p",Ut,c(f.metadata?.Director||"Unknown Director"),1),e("p",Ot,c(f.imdbId),1)]),e("button",{class:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Remove from collection",disabled:t(I)===f.imdbId,onClick:w=>i(f)},[t(I)===f.imdbId?(l(),o("div",Kt)):(l(),o("div",Wt))],8,zt)]))),128))])):(l(),o("div",Gt,[...r[3]||(r[3]=[e("div",{class:"i-mdi-movie-off-outline text-4xl mx-auto mb-2 opacity-20"},null,-1),e("p",null,"No movies in this collection yet.",-1)])]))]))}}),Jt=Object.assign(Ht,{__name:"AdminCollectionMoviesList"}),Xt={class:"min-h-screen bg-theme-background text-theme-text p-4 md:ml-16 transition-colors duration-300"},Zt={class:"max-w-7xl mx-auto space-y-8"},qt={key:0,class:"flex flex-col items-center justify-center h-[60vh] text-center"},es={key:1,class:"flex flex-col gap-8"},ts={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},ss={class:"bg-theme-surface border border-theme-border rounded-2xl p-6"},os={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},ls={class:"space-y-8"},is={class:"space-y-6"},ns={class:"bg-theme-surface border border-theme-border rounded-2xl p-6 space-y-6"},rs={class:"bg-theme-surface border border-theme-border rounded-2xl p-6 space-y-6"},ds={class:"space-y-6"},ps=E({__name:"index",setup(T){const $=_(!1),x=_(""),g=_(null),a=O(),m=D(),{collections:b}=B(m),S=R(()=>x.value&&b.value.get(x.value)||null);H(async()=>{$.value=ne(),$.value&&await a.loadFromFile()});const I=()=>{g.value&&g.value.refresh()};return(k,i)=>{const s=ee,r=Me,f=Ze,w=ut,A=Qt,h=Jt;return l(),o("div",Xt,[e("main",Zt,[t($)?(l(),o("div",es,[e("header",ts,[i[6]||(i[6]=e("div",null,[e("h1",{class:"text-3xl font-bold flex items-center gap-3"},[e("div",{class:"i-mdi-movie-edit text-blue-600"}),v(" Collection Editor ")]),e("p",{class:"text-theme-textmuted mt-1"}," Add and remove movies from collections ")],-1)),F(s,{to:"/admin",class:"px-4 py-2 text-sm bg-theme-surface border border-theme-border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"},{default:G(()=>[...i[5]||(i[5]=[e("div",{class:"i-mdi-arrow-left"},null,-1),v(" Back to Dashboard ",-1)])]),_:1})]),e("section",ss,[F(r,{onSelect:i[0]||(i[0]=n=>x.value=n)})]),t(x)?(l(),o("section",os,[e("div",ls,[e("div",is,[i[7]||(i[7]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-magnify text-blue-600"}),v(" Search Library ")],-1)),F(f,{"collection-id":t(x),onAdd:I},null,8,["collection-id"])]),e("div",ns,[i[8]||(i[8]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-tag-multiple text-blue-600"}),v(" Collection Metadata ")],-1)),F(w,{"collection-id":t(x),"initial-tags":t(S)?.tags},null,8,["collection-id","initial-tags"])]),e("div",rs,[i[9]||(i[9]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-database-clock text-blue-600"}),v(" Dynamic Queries ")],-1)),F(A,{"collection-id":t(x),queries:t(S)?.savedQueries},null,8,["collection-id","queries"])])]),e("div",ds,[i[10]||(i[10]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-playlist-play text-blue-600"}),v(" Collection Movies ")],-1)),F(h,{ref_key:"moviesList",ref:g,"collection-id":t(x)},null,8,["collection-id"])])])):C("",!0)])):(l(),o("div",qt,[i[2]||(i[2]=e("div",{class:"i-mdi-lock text-64px text-gray-300 dark:text-gray-700 mb-4"},null,-1)),i[3]||(i[3]=e("h1",{class:"text-2xl font-bold mb-2"}," Access Denied ",-1)),i[4]||(i[4]=e("p",{class:"text-theme-textmuted"}," The admin interface is only available on localhost. ",-1)),F(s,{to:"/",class:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors"},{default:G(()=>[...i[1]||(i[1]=[v(" Back to Home ",-1)])]),_:1})]))])])}}});export{ps as default};
