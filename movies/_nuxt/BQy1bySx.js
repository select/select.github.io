import{O as u,m as l}from"./CgEeLIgt.js";import{u as d}from"./BgE6LmUp.js";const M=u("collections",()=>{const c=l(new Map),n=l(!1),s=l(!1),i=l(null),a=async()=>{if(!s.value){n.value=!0,i.value=null;try{const o=await $fetch("/data/collections.json");c.value.clear(),Object.entries(o).filter(([e])=>!e.startsWith("_")).map(([e,r])=>r).forEach(e=>{c.value.set(e.id,e)}),s.value=!0}catch(o){i.value=o.message||"Failed to load collections"}finally{n.value=!1}}};return{collections:c,isLoading:n,isLoaded:s,error:i,loadCollections:a,getCollectionById:async o=>(s.value||await a(),c.value.get(o)||null),addMovieToCollection:async(o,t)=>{try{const e=await $fetch("/api/admin/collections/add-movie",{method:"POST",body:{collectionId:o,movieId:t}});return e.success&&(s.value=!1,await a()),e.success}catch{return!1}},removeMovieFromCollection:async(o,t)=>{try{const e=await $fetch("/api/admin/collections/remove-movie",{method:"POST",body:{collectionId:o,movieId:t}});return e.success&&(s.value=!1,await a()),e.success}catch{return!1}},isMovieInCollection:(o,t)=>{const e=c.value.get(t);return e?e.movieIds.includes(o):!1},getCollectionsForMovie:async o=>{try{const t=d();return t.isReady.value?await t.getCollectionsForMovie(o):(s.value||await a(),Array.from(c.value.values()).filter(e=>e.movieIds.includes(o)))}catch{return[]}},addQueryToCollection:async(o,t)=>{try{const e=await $fetch("/api/admin/collections/update-collection",{method:"POST",body:{collectionId:o,updates:{queries:{action:"add",query:t}}}});return e.success&&(s.value=!1,await a()),e.success}catch{return!1}},removeQueryFromCollection:async(o,t)=>{try{const e=await $fetch("/api/admin/collections/update-collection",{method:"POST",body:{collectionId:o,updates:{queries:{action:"remove",index:t}}}});return e.success&&(s.value=!1,await a()),e.success}catch{return!1}},updateCollectionTags:async(o,t)=>{try{const e=await $fetch("/api/admin/collections/update-collection",{method:"POST",body:{collectionId:o,updates:{tags:{action:"set",values:t}}}});return e.success&&(s.value=!1,await a()),e.success}catch{return!1}},refreshCollectionFromQuery:async o=>{try{const t=await $fetch("/api/admin/collections/refresh-from-query",{method:"POST",body:{collectionId:o}});return t.success&&(s.value=!1,await a()),t}catch{return{success:!1,movieCount:0}}}}});export{M as u};
