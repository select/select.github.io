import{_ as re}from"./DLv0zqK_.js";import{E as B,N as K,e as N,r as S,B as ae,H as se,c as l,a as e,J as y,t as d,z as s,d as h,K as F,L as j,P as X,Z as P,$ as U,a6 as ee,a0 as oe,o as i,O as D,a2 as Q,S as de,n as Z,b as L,a1 as ce,al as ue,am as le,u as me,w as te}from"./C1DehbHX.js";import{u as O}from"./BmM4d4Y4.js";import{g as ie}from"./BDUZSP7Z.js";import{f as ne}from"./DMOTkeJ5.js";import{u as H}from"./BPf94GNk.js";import{i as fe}from"./BH85bPq3.js";const be={class:"space-y-4"},xe={class:"flex items-center justify-between"},ve={class:"flex items-center gap-3"},pe={class:"px-2 py-0.5 text-sm font-mono text-theme-text"},ge={class:"flex flex-wrap gap-2"},he=["onClick"],ye={key:0,class:"i-mdi-eye-off text-xs opacity-70"},_e={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},we={class:"bg-theme-surface rounded-2xl w-full max-w-lg shadow-2xl border border-theme-border overflow-hidden"},ke={class:"p-6 border-b border-theme-border flex items-center justify-between"},$e={class:"text-xl font-bold"},Se=["disabled"],Ce={class:"flex flex-wrap gap-2 p-3 bg-theme-background border border-theme-border rounded-lg min-h-[50px]"},Ie=["onClick"],Te={class:"relative flex-1 min-w-[120px]"},Ve=["onKeydown"],Me={key:0,class:"absolute z-10 left-0 right-0 mt-2 bg-theme-surface border border-theme-border rounded-lg shadow-xl max-h-48 overflow-y-auto"},Ae=["onMousedown"],Re={class:"pt-4 flex gap-3"},Ye=["disabled"],Fe={key:0,class:"i-mdi-loading animate-spin mx-auto"},je={key:1},Ee=B({__name:"AdminCollectionSelector",emits:["select"],setup(R,{expose:A,emit:_}){const w=O(),{collections:k}=K(w),x=N(()=>Array.from(k.value.values())),n=N(()=>x.value.filter(m=>m.enabled!==!1).length),C=S(""),b=_,T=m=>{C.value=m,b("select",m)},c=S(!1),r=S(null),o=S(!1),t=ae({id:"",name:"",description:"",tags:[]}),v=S(""),$=S(!1),V=N(()=>{const m=new Set;return k.value.forEach(u=>{u.tags&&u.tags.forEach(g=>m.add(g))}),Array.from(m).sort()}),M=N(()=>{const m=v.value.toLowerCase().trim();return V.value.filter(u=>u.toLowerCase().includes(m)&&!t.tags.includes(u))}),z=()=>{const m=v.value.trim();m&&!t.tags.includes(m)&&(t.tags.push(m),v.value="")},I=m=>{t.tags=t.tags.filter(u=>u!==m)},G=()=>{v.value===""&&t.tags.length>0&&t.tags.pop()},E=m=>{t.tags.includes(m)||t.tags.push(m),v.value="",$.value=!1},W=()=>{setTimeout(()=>{$.value=!1},200)},J=m=>{r.value=m,t.id=m.id,t.name=m.name,t.description=m.description,t.tags=[...m.tags||[]]},p=()=>{c.value=!1,r.value=null,t.id="",t.name="",t.description="",t.tags=[],v.value="",$.value=!1},a=async()=>{o.value=!0;try{r.value?(await $fetch("/api/admin/collections/update-collection",{method:"POST",body:{collectionId:t.id,updates:{name:t.name,description:t.description,tags:{action:"set",values:t.tags}}}})).success&&(await w.loadCollections(),p()):(await $fetch("/api/admin/collections/create",{method:"POST",body:t})).success&&(await w.loadCollections(),p())}catch{}finally{o.value=!1}},Y=async m=>{if(confirm(`Are you sure you want to delete the collection "${m.name}"? This cannot be undone.`))try{(await $fetch("/api/admin/collections/delete",{method:"POST",body:{id:m.id}})).success&&(C.value===m.id&&(C.value="",b("select","")),await w.loadCollections())}catch{}},f=async m=>{const u=m.enabled===!1;try{(await $fetch("/api/admin/collections/update-collection",{method:"POST",body:{collectionId:m.id,updates:{enabled:u}}})).success&&await w.loadCollections()}catch{}};return se(async()=>{w.isLoaded||await w.loadCollections()}),A({editCollection:J,toggleEnabled:f,confirmDelete:Y,openCreateModal:()=>c.value=!0}),(m,u)=>(i(),l("div",be,[e("div",xe,[e("div",ve,[u[6]||(u[6]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Select Collection ",-1)),e("span",pe,d(s(n))+"/"+d(s(x).length),1)]),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:u[0]||(u[0]=g=>c.value=!0)},[...u[7]||(u[7]=[e("div",{class:"i-mdi-plus"},null,-1),h(" Create New ",-1)])])]),e("div",ge,[(i(!0),l(F,null,j(s(x),g=>(i(),l("button",{key:g.id,class:D(["px-4 py-2 rounded-xl border transition-all text-sm font-bold flex items-center gap-2",[s(C)===g.id?"bg-blue-600 text-white border-blue-600 shadow-lg shadow-blue-600/20":"bg-theme-surface border-theme-border hover:border-theme-textmuted text-theme-text",g.enabled===!1?"opacity-60":""]]),onClick:q=>T(g.id)},[h(d(g.name)+" ",1),g.enabled===!1?(i(),l("div",ye)):y("",!0)],10,he))),128))]),s(c)||s(r)?(i(),l("div",_e,[e("div",we,[e("div",ke,[e("h3",$e,d(s(r)?"Edit Collection":"Create New Collection"),1),e("button",{class:"p-2 hover:bg-theme-selection rounded-full transition-colors",onClick:p},[...u[8]||(u[8]=[e("div",{class:"i-mdi-close text-xl"},null,-1)])])]),e("form",{class:"p-6 space-y-4",onSubmit:X(a,["prevent"])},[e("div",null,[u[9]||(u[9]=e("label",{class:"block text-sm font-bold mb-1"},"ID (URL Slug)",-1)),P(e("input",{"onUpdate:modelValue":u[1]||(u[1]=g=>s(t).id=g),type:"text",placeholder:"e.g. charlie-chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm font-mono",disabled:!!s(r),required:""},null,8,Se),[[U,s(t).id]])]),e("div",null,[u[10]||(u[10]=e("label",{class:"block text-sm font-bold mb-1"},"Name",-1)),P(e("input",{"onUpdate:modelValue":u[2]||(u[2]=g=>s(t).name=g),type:"text",placeholder:"e.g. Charlie Chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm",required:""},null,512),[[U,s(t).name]])]),e("div",null,[u[11]||(u[11]=e("label",{class:"block text-sm font-bold mb-1"},"Description",-1)),P(e("textarea",{"onUpdate:modelValue":u[3]||(u[3]=g=>s(t).description=g),rows:"3",placeholder:"Describe this collection...",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm"},null,512),[[U,s(t).description]])]),e("div",null,[u[13]||(u[13]=e("label",{class:"block text-sm font-bold mb-1"},"Tags",-1)),e("div",Ce,[(i(!0),l(F,null,j(s(t).tags,g=>(i(),l("div",{key:g,class:"flex items-center gap-1.5 px-3 py-1 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded-full text-sm font-medium group"},[h(d(g)+" ",1),e("button",{type:"button",class:"p-0.5 hover:bg-blue-600/20 rounded-full transition-colors",onClick:q=>I(g)},[...u[12]||(u[12]=[e("div",{class:"i-mdi-close text-xs"},null,-1)])],8,Ie)]))),128)),e("div",Te,[P(e("input",{"onUpdate:modelValue":u[4]||(u[4]=g=>oe(v)?v.value=g:null),type:"text",placeholder:"Add tag...",class:"w-full bg-transparent border-none focus:ring-0 text-sm py-1",onKeydown:[ee(X(z,["prevent"]),["enter"]),ee(G,["backspace"])],onFocus:u[5]||(u[5]=g=>$.value=!0),onBlur:W},null,40,Ve),[[U,s(v)]]),s($)&&s(M).length>0?(i(),l("div",Me,[(i(!0),l(F,null,j(s(M),g=>(i(),l("button",{key:g,type:"button",class:"w-full text-left px-4 py-2 text-sm hover:bg-theme-selection transition-colors",onMousedown:X(q=>E(g),["prevent"])},d(g),41,Ae))),128))])):y("",!0)])])]),e("div",Re,[e("button",{type:"button",class:"flex-1 px-4 py-2 border border-theme-border rounded-lg font-bold hover:bg-theme-selection transition-colors",onClick:p}," Cancel "),e("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-500 transition-colors disabled:opacity-50",disabled:s(o)},[s(o)?(i(),l("div",Fe)):(i(),l("span",je,d(s(r)?"Update":"Create"),1))],8,Ye)])],32)])])):y("",!0)]))}}),Le=Object.assign(Ee,{__name:"AdminCollectionSelector"}),Qe={class:"space-y-4"},De={class:"flex items-center gap-4"},Ne={class:"relative flex-1"},Pe={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},Ue={key:0,class:"bg-blue-600 text-white px-1.5 py-0.5 rounded-full text-[10px]"},Be={key:0,class:"flex flex-wrap items-center gap-2"},Oe={key:0,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},ze={key:1,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},Ke={key:2,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},He={key:1,class:"bg-theme-surface border border-theme-border rounded-2xl overflow-hidden"},Ge={class:"p-4 border-b border-theme-border flex items-center justify-between bg-theme-bg/30"},We={class:"text-sm text-theme-textmuted"},Je={class:"font-semibold text-theme-text"},Xe={key:0,class:"text-xs"},Ze=["disabled"],qe={key:0,class:"i-mdi-loading animate-spin"},et={key:1,class:"i-mdi-plus-box-multiple"},tt={class:"divide-y divide-theme-border"},st={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},ot=["src","alt"],lt={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},it={class:"flex-1 min-w-0"},nt={class:"flex items-center gap-2"},rt={class:"font-bold truncate"},at={class:"text-xs text-theme-textmuted font-mono"},dt={class:"text-xs text-theme-textmuted truncate"},ct={class:"flex items-center gap-2 text-[10px] text-theme-textmuted mt-0.5"},ut={class:"font-mono"},mt={key:0,class:"flex items-center gap-1"},ft={class:"font-bold text-theme-text"},bt={key:0,class:"opacity-70"},xt=["disabled","onClick"],vt={key:0,class:"i-mdi-loading animate-spin"},pt={key:2,class:"p-8 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},gt=B({__name:"AdminMovieSearch",props:{collectionId:{}},emits:["add"],setup(R,{emit:A}){const _=R,w=A,k=O(),x=H(),{filters:n,activeFiltersCount:C,hasActiveFilters:b}=K(x),{resetFilters:T}=x,c=Q(),r=S(null),o=S(""),t=S([]),v=S(!1),$=S(""),V=S(!1),M=S(!1);de("/",p=>{const a=window.document.activeElement,Y=a?.tagName==="INPUT"||a?.tagName==="TEXTAREA";p.preventDefault(),Y||r.value?.focus()}),Z(()=>n.value.searchQuery,p=>{p!==o.value&&(o.value=p,p.length>=3||b.value?I():t.value=[])}),Z(()=>[n.value.minRating,n.value.minYear,n.value.maxYear,n.value.minVotes,n.value.maxVotes,n.value.genres,n.value.countries,n.value.sources],()=>{(o.value.length>=3||b.value)&&I()},{deep:!0});const I=ce(async()=>{const p=o.value.length>=3,a=b.value;if(!p&&!a){t.value=[];return}v.value=!0;try{const Y=await $fetch("/api/admin/movies/search",{query:{q:o.value,minRating:n.value.minRating||void 0,minYear:n.value.minYear||void 0,maxYear:n.value.maxYear||void 0,minVotes:n.value.minVotes||void 0,maxVotes:n.value.maxVotes||void 0,genres:n.value.genres.join(",")||void 0,countries:n.value.countries.join(",")||void 0,sources:n.value.sources.join(",")||void 0}});t.value=Y.slice(0,300).map(x.mapMovieToLightweight)}catch{c.showToast("Search failed","error")}finally{v.value=!1}},300),G=()=>{I()},E=p=>k.isMovieInCollection(p,_.collectionId),W=async p=>{$.value=p;try{await k.addMovieToCollection(_.collectionId,p)?(c.showToast("Movie added to collection"),w("add")):c.showToast("Failed to add movie","error")}catch{c.showToast("Error adding movie","error")}finally{$.value=""}},J=async()=>{V.value=!0;let p=0,a=0;try{const Y=t.value.filter(f=>!E(f.imdbId));if(Y.length===0){c.showToast("All movies are already in the collection","info");return}for(const f of Y)try{await k.addMovieToCollection(_.collectionId,f.imdbId)?p++:a++}catch{a++}p>0&&(c.showToast(`Added ${p} movie${p>1?"s":""} to collection`),w("add")),a>0&&c.showToast(`Failed to add ${a} movie${a>1?"s":""}`,"error")}finally{V.value=!1}};return(p,a)=>{const Y=ue("FilterMenu");return i(),l("div",Qe,[e("div",De,[e("div",Ne,[a[6]||(a[6]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-theme-textmuted"},[e("div",{class:"i-mdi-magnify text-xl"})],-1)),P(e("input",{ref_key:"searchInput",ref:r,"onUpdate:modelValue":a[0]||(a[0]=f=>oe(o)?o.value=f:null),type:"text",placeholder:"Search by title, director, writer, plot or IMDb ID... (or use filters below)",class:"block w-full pl-10 pr-3 py-3 border border-theme-border rounded-xl bg-theme-surface focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none",onInput:G},null,544),[[U,s(o)]]),s(v)?(i(),l("div",Pe,[...a[5]||(a[5]=[e("div",{class:"i-mdi-loading animate-spin text-blue-600"},null,-1)])])):y("",!0)]),e("button",{class:"px-4 py-3 bg-theme-surface border border-theme-border rounded-xl text-sm font-bold hover:bg-theme-selection transition-colors flex items-center gap-2",onClick:a[1]||(a[1]=f=>M.value=!0)},[a[7]||(a[7]=e("div",{class:"i-mdi-filter-variant"},null,-1)),a[8]||(a[8]=h(" Filters ",-1)),s(C)>0?(i(),l("span",Ue,d(s(C)),1)):y("",!0)])]),s(b)?(i(),l("div",Be,[s(n).minRating>0?(i(),l("div",Oe,[a[9]||(a[9]=e("div",{class:"i-mdi-star"},null,-1)),h(" "+d(s(n).minRating)+"+ ",1)])):y("",!0),s(n).minYear>0||s(n).maxYear?(i(),l("div",ze,[a[10]||(a[10]=e("div",{class:"i-mdi-calendar"},null,-1)),h(" "+d(s(n).minYear||1910)+" - "+d(s(n).maxYear||2025),1)])):y("",!0),s(n).minVotes>0||s(n).maxVotes?(i(),l("div",Ke,[a[11]||(a[11]=e("div",{class:"i-mdi-account-group"},null,-1)),h(" "+d(s(n).minVotes.toLocaleString())+" - "+d(s(n).maxVotes?s(n).maxVotes.toLocaleString():"Any"),1)])):y("",!0),(i(!0),l(F,null,j(s(n).genres,f=>(i(),l("div",{key:f,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[a[12]||(a[12]=e("div",{class:"i-mdi-movie-filter"},null,-1)),h(" "+d(f),1)]))),128)),(i(!0),l(F,null,j(s(n).sources,f=>(i(),l("div",{key:f,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[a[13]||(a[13]=e("div",{class:"i-mdi-source-branch"},null,-1)),h(" "+d(f),1)]))),128)),e("button",{class:"text-xs text-theme-primary hover:underline ml-2",onClick:a[2]||(a[2]=(...f)=>s(T)&&s(T)(...f))}," Clear All ")])):y("",!0),s(t).length>0?(i(),l("div",He,[e("div",Ge,[e("div",We,[e("span",Je,d(s(t).length),1),a[14]||(a[14]=h(" results ",-1)),s(t).length===300?(i(),l("span",Xe,"(limited to 300)")):y("",!0)]),e("button",{class:D(["px-4 py-2 rounded-lg text-sm font-bold transition-all flex items-center gap-2 disabled:opacity-50",s(V)?"bg-theme-selection text-theme-textmuted cursor-wait":"bg-blue-600 hover:bg-blue-500 text-white"]),disabled:s(V)||s($)!=="",onClick:J},[s(V)?(i(),l("div",qe)):(i(),l("div",et)),a[15]||(a[15]=h(" Add All to Collection ",-1))],10,Ze)]),e("div",tt,[(i(!0),l(F,null,j(s(t),f=>(i(),l("div",{key:f.imdbId,class:"p-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",st,[f.imdbId?.startsWith("tt")?(i(),l("img",{key:0,src:("getPosterPath"in p?p.getPosterPath:s(ie))(f.imdbId),alt:f.title,class:"w-full h-full object-cover",onError:a[3]||(a[3]=m=>m.target.style.display="none")},null,40,ot)):(i(),l("div",lt,[...a[16]||(a[16]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",it,[e("div",nt,[e("h4",rt,d(f.title),1),e("span",at,d(f.year),1)]),e("p",dt,d(f.genre||"Unknown Genre"),1),e("div",ct,[e("span",ut,d(f.imdbId),1),f.imdbRating?(i(),l("span",mt,[a[17]||(a[17]=e("span",{class:"opacity-50"},"•",-1)),a[18]||(a[18]=e("div",{class:"i-mdi-star text-theme-accent text-xs"},null,-1)),e("span",ft,d(f.imdbRating),1),f.imdbVotes?(i(),l("span",bt," ("+d(("formatVotes"in p?p.formatVotes:s(ne))(f.imdbVotes))+") ",1)):y("",!0)])):y("",!0)])]),e("button",{class:D(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1.5 disabled:opacity-50",E(f.imdbId)?"bg-theme-selection text-theme-textmuted cursor-default":"bg-blue-600 hover:bg-blue-500 text-white"]),disabled:E(f.imdbId)||s($)===f.imdbId,onClick:m=>W(f.imdbId)},[s($)===f.imdbId?(i(),l("div",vt)):(i(),l("div",{key:1,class:D(E(f.imdbId)?"i-mdi-check":"i-mdi-plus")},null,2)),h(" "+d(E(f.imdbId)?"Added":"Add"),1)],10,xt)]))),128))])])):(s(o).length>=3||s(b))&&!s(v)?(i(),l("div",pt," No movies found"+d(s(o)?` for "${s(o)}"`:"")+d(s(b)?" with current filters":""),1)):y("",!0),L(Y,{"is-open":s(M),onClose:a[4]||(a[4]=f=>M.value=!1)},null,8,["is-open"])])}}}),ht=Object.assign(gt,{__name:"AdminMovieSearch"}),yt={class:"space-y-4"},_t={key:0,class:"text-sm text-theme-textmuted italic p-4 bg-theme-surface border border-theme-border border-dashed rounded-xl text-center"},wt={key:1,class:"space-y-3"},kt={class:"flex items-start justify-between gap-4"},$t={class:"flex-1 space-y-2"},St={class:"flex items-center gap-2"},Ct={class:"font-bold text-sm"},It={class:"flex flex-wrap gap-2"},Tt={key:0,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Vt={key:1,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Mt={key:2,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},At={key:3,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Rt={key:4,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Yt={key:5,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Ft={class:"flex items-center gap-1"},jt=["onClick"],Et=["onClick"],Lt=B({__name:"AdminSavedQueryManager",props:{collectionId:{},queries:{}},emits:["filtersApplied"],setup(R,{emit:A}){const _=R,w=A,k=O(),x=H(),{filters:n}=K(x),C=async()=>{const c={field:"year",direction:"desc"},r=n.value.sort.field===c.field&&n.value.sort.direction===c.direction,o={searchQuery:n.value.searchQuery,currentPage:1,lastScrollY:0};r||(o.sort={...n.value.sort}),n.value.sources.length>0&&(o.sources=[...n.value.sources]),n.value.minRating>0&&(o.minRating=n.value.minRating),n.value.minYear>0&&(o.minYear=n.value.minYear),n.value.maxYear&&n.value.maxYear>0&&(o.maxYear=n.value.maxYear),n.value.minVotes>0&&(o.minVotes=n.value.minVotes),n.value.maxVotes&&n.value.maxVotes>0&&(o.maxVotes=n.value.maxVotes),n.value.genres.length>0&&(o.genres=[...n.value.genres]),n.value.countries.length>0&&(o.countries=[...n.value.countries]);const t={searchQuery:n.value.searchQuery,filterState:o};await k.addQueryToCollection(_.collectionId,t)},b=async c=>{confirm("Are you sure you want to remove this saved query?")&&await k.removeQueryFromCollection(_.collectionId,c)},T=c=>{x.resetFilters(),c.searchQuery&&x.setSearchQuery(c.searchQuery),c.filterState.sort&&x.setSort(c.filterState.sort),c.filterState.minRating&&x.setMinRating(c.filterState.minRating),c.filterState.minYear&&x.setMinYear(c.filterState.minYear),c.filterState.maxYear&&x.setMaxYear(c.filterState.maxYear),c.filterState.minVotes&&x.setMinVotes(c.filterState.minVotes),c.filterState.maxVotes&&x.setMaxVotes(c.filterState.maxVotes),c.filterState.genres?.forEach(r=>x.toggleGenre(r)),c.filterState.countries?.forEach(r=>x.toggleCountry(r)),c.filterState.sources?.forEach(r=>x.toggleSource(r)),w("filtersApplied")};return(c,r)=>(i(),l("div",yt,[e("div",{class:"flex items-center justify-between"},[r[1]||(r[1]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Saved Queries ",-1)),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:C},[...r[0]||(r[0]=[e("div",{class:"i-mdi-plus"},null,-1),h(" Save Current Search ",-1)])])]),!R.queries||R.queries.length===0?(i(),l("div",_t," No saved queries for this collection. ")):(i(),l("div",wt,[(i(!0),l(F,null,j(R.queries,(o,t)=>(i(),l("div",{key:t,class:"p-4 bg-theme-surface border border-theme-border rounded-xl group hover:border-theme-textmuted transition-all"},[e("div",kt,[e("div",$t,[e("div",St,[r[2]||(r[2]=e("div",{class:"i-mdi-magnify text-theme-textmuted"},null,-1)),e("span",Ct,d(o.searchQuery||"All Movies"),1)]),e("div",It,[o.filterState.sort?(i(),l("div",Tt,[r[3]||(r[3]=e("div",{class:"i-mdi-sort"},null,-1)),h(" "+d(o.filterState.sort.field)+" ("+d(o.filterState.sort.direction)+") ",1)])):y("",!0),o.filterState.minYear&&o.filterState.minYear>0||o.filterState.maxYear?(i(),l("div",Vt,[r[4]||(r[4]=e("div",{class:"i-mdi-calendar"},null,-1)),h(" "+d(o.filterState.minYear||1910)+" - "+d(o.filterState.maxYear||2025),1)])):y("",!0),o.filterState.minRating&&o.filterState.minRating>0?(i(),l("div",Mt,[r[5]||(r[5]=e("div",{class:"i-mdi-star"},null,-1)),h(" "+d(o.filterState.minRating)+"+ ",1)])):y("",!0),o.filterState.minVotes&&o.filterState.minVotes>0||o.filterState.maxVotes?(i(),l("div",At,[r[6]||(r[6]=e("div",{class:"i-mdi-account-group"},null,-1)),h(" "+d((o.filterState.minVotes||0).toLocaleString())+" - "+d(o.filterState.maxVotes?o.filterState.maxVotes.toLocaleString():"Any"),1)])):y("",!0),o.filterState.genres?.length?(i(),l("div",Rt,[r[7]||(r[7]=e("div",{class:"i-mdi-movie-filter"},null,-1)),h(" "+d(o.filterState.genres.join(", ")),1)])):y("",!0),o.filterState.sources?.length?(i(),l("div",Yt,[r[8]||(r[8]=e("div",{class:"i-mdi-source-branch"},null,-1)),h(" "+d(o.filterState.sources.join(", ")),1)])):y("",!0)])]),e("div",Ft,[e("button",{class:"p-2 hover:bg-blue-600/10 text-blue-600 rounded-lg transition-colors",title:"Apply Filters",onClick:v=>T(o)},[...r[9]||(r[9]=[e("div",{class:"i-mdi-filter-variant"},null,-1)])],8,jt),e("button",{class:"p-2 hover:bg-red-600/10 text-red-600 rounded-lg transition-colors",title:"Remove Query",onClick:v=>b(t)},[...r[10]||(r[10]=[e("div",{class:"i-mdi-delete"},null,-1)])],8,Et)])])]))),128))]))]))}}),Qt=Object.assign(Lt,{__name:"AdminSavedQueryManager"}),Dt={class:"space-y-4"},Nt={key:0,class:"p-12 flex justify-center"},Pt={key:1,class:"overflow-hidden divide-y divide-theme-border"},Ut={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},Bt=["src","alt"],Ot={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},zt={class:"flex-1 min-w-0"},Kt={class:"flex items-center gap-2"},Ht={class:"font-bold truncate"},Gt={class:"text-xs text-theme-textmuted font-mono"},Wt={class:"text-xs text-theme-textmuted truncate"},Jt={class:"flex items-center gap-2 text-[10px] text-theme-textmuted mt-0.5"},Xt={class:"font-mono"},Zt={key:0,class:"flex items-center gap-1"},qt={class:"font-bold text-theme-text"},es={key:0,class:"opacity-70"},ts=["disabled","onClick"],ss={key:0,class:"i-mdi-loading animate-spin text-xl"},os={key:1,class:"i-mdi-trash-can-outline text-xl"},ls={key:2,class:"p-12 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},is=B({__name:"AdminCollectionMoviesList",props:{collectionId:{}},setup(R,{expose:A}){const _=R,w=O(),k=H(),x=Q(),n=S([]),C=S(!1),b=S(""),T=async()=>{if(_.collectionId){C.value=!0;try{const r=await w.getCollectionById(_.collectionId);if(!r||!r.movieIds||!r.movieIds.length){n.value=[];return}!k.allMovies.size&&!k.isLoading.movies&&await k.loadFromFile();const o=le(r.movieIds),t=await k.fetchMoviesByIds(o);n.value=o.map(v=>{const $=t.find(V=>V.imdbId===v);return $||{imdbId:v,title:`Missing: ${v}`,year:0}})}catch(r){window.console.error("Failed to load collection movies:",r),x.showToast("Failed to load collection movies","error")}finally{C.value=!1}}},c=async r=>{if(confirm(`Remove "${r.title}" from this collection?`)){b.value=r.imdbId;try{await w.removeMovieFromCollection(_.collectionId,r.imdbId)?(x.showToast("Movie removed from collection"),await T()):x.showToast("Failed to remove movie","error")}catch{x.showToast("Error removing movie","error")}finally{b.value=""}}};return A({refresh:T}),Z(()=>_.collectionId,()=>{T()},{immediate:!0}),(r,o)=>(i(),l("div",Dt,[s(C)?(i(),l("div",Nt,[...o[1]||(o[1]=[e("div",{class:"i-mdi-loading animate-spin text-4xl text-blue-600"},null,-1)])])):s(n).length>0?(i(),l("div",Pt,[(i(!0),l(F,null,j(s(n),t=>(i(),l("div",{key:t.imdbId,class:"py-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",Ut,[t.imdbId?.startsWith("tt")?(i(),l("img",{key:0,src:("getPosterPath"in r?r.getPosterPath:s(ie))(t.imdbId),alt:t.title,class:"w-full h-full object-cover",onError:o[0]||(o[0]=v=>v.target.style.display="none")},null,40,Bt)):(i(),l("div",Ot,[...o[2]||(o[2]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",zt,[e("div",Kt,[e("h4",Ht,d(t.title),1),e("span",Gt,d(t.year),1)]),e("p",Wt,d(t.genre||"Unknown Genre"),1),e("div",Jt,[e("span",Xt,d(t.imdbId),1),t.imdbRating?(i(),l("span",Zt,[o[3]||(o[3]=e("span",{class:"opacity-50"},"•",-1)),o[4]||(o[4]=e("div",{class:"i-mdi-star text-theme-accent text-xs"},null,-1)),e("span",qt,d(t.imdbRating),1),t.imdbVotes?(i(),l("span",es," ("+d(("formatVotes"in r?r.formatVotes:s(ne))(t.imdbVotes))+") ",1)):y("",!0)])):y("",!0)])]),e("button",{class:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Remove from collection",disabled:s(b)===t.imdbId,onClick:v=>c(t)},[s(b)===t.imdbId?(i(),l("div",ss)):(i(),l("div",os))],8,ts)]))),128))])):(i(),l("div",ls,[...o[5]||(o[5]=[e("div",{class:"i-mdi-movie-off-outline text-4xl mx-auto mb-2 opacity-20"},null,-1),e("p",null,"No movies in this collection yet.",-1)])]))]))}}),ns=Object.assign(is,{__name:"AdminCollectionMoviesList"}),rs={class:"min-h-screen bg-theme-background text-theme-text p-4 md:ml-16 transition-colors duration-300"},as={class:"max-w-7xl mx-auto space-y-8"},ds={key:0,class:"flex flex-col items-center justify-center h-[60vh] text-center"},cs={key:1,class:"flex flex-col gap-8"},us={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},ms={class:"bg-theme-surface border border-theme-border rounded-2xl p-6"},fs={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},bs={class:"space-y-8"},xs={key:0,class:"bg-theme-surface border border-theme-border rounded-2xl p-6 space-y-4"},vs={class:"flex items-start justify-between gap-4"},ps={class:"space-y-2"},gs={class:"flex items-center gap-3"},hs={class:"text-2xl font-bold"},ys={key:0,class:"px-2 py-0.5 bg-yellow-600/10 text-yellow-600 dark:text-yellow-400 border border-yellow-600/20 rounded text-xs font-bold uppercase"},_s={key:0,class:"flex flex-wrap gap-2"},ws={class:"text-theme-textmuted max-w-3xl"},ks={class:"flex items-center gap-2 text-sm font-mono text-theme-textmuted"},$s={class:"text-theme-text"},Ss={class:"flex items-center gap-2"},Cs={class:"space-y-6"},Is={class:"space-y-6"},Ts={class:"bg-theme-surface border border-theme-border rounded-2xl p-6 space-y-6"},Vs={class:"flex items-center justify-between gap-2"},Ls=B({__name:"index",setup(R){me({title:"Collection Editor - Movies Deluxe Admin",meta:[{name:"robots",content:"noindex, nofollow"}]});const A=S(!1),_=S(""),w=S(null),k=S(null),x=H(),n=O(),{collections:C}=K(n),b=N(()=>_.value&&C.value.get(_.value)||null);se(async()=>{A.value=fe(),A.value&&await x.loadFromFile()});const T=()=>{k.value&&k.value.refresh()},c=()=>{},r=async()=>{if(!(!_.value||!b.value)&&confirm("This will remove all movies from this collection that are no longer in the database. Continue?"))try{const o=le(b.value.movieIds);if(!o.length){Q().showToast("Collection is already empty");return}const t=await x.fetchMovies({where:`m.imdbId IN (${o.map(()=>"?").join(",")})`,params:o,limit:o.length}),v=new Set(t.result.map(M=>M.imdbId)),$=o.filter(M=>!v.has(M));if($.length===0){Q().showToast("No missing movies found in this collection");return}await n.removeMoviesFromCollection(_.value,$)?(Q().showToast(`Removed ${$.length} missing movies from collection`),k.value&&k.value.refresh()):Q().showToast("Failed to remove missing movies","error")}catch(o){console.error("Cleanup failed:",o),Q().showToast("Error during cleanup","error")}};return(o,t)=>{const v=re,$=Le,V=ht,M=Qt,z=ns;return i(),l("div",rs,[e("main",as,[s(A)?(i(),l("div",cs,[e("header",us,[t[9]||(t[9]=e("div",null,[e("h1",{class:"text-3xl font-bold flex items-center gap-3"},[e("div",{class:"i-mdi-movie-edit text-blue-600"}),h(" Collection Editor ")]),e("p",{class:"text-theme-textmuted mt-1"},"Add and remove movies from collections")],-1)),L(v,{to:"/admin",class:"px-4 py-2 text-sm bg-theme-surface border border-theme-border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"},{default:te(()=>[...t[8]||(t[8]=[e("div",{class:"i-mdi-arrow-left"},null,-1),h(" Back to Dashboard ",-1)])]),_:1})]),e("section",ms,[L($,{ref_key:"collectionSelector",ref:w,onSelect:t[0]||(t[0]=I=>_.value=I)},null,512)]),s(_)?(i(),l("section",fs,[e("div",bs,[s(b)?(i(),l("div",xs,[e("div",vs,[e("div",ps,[e("div",gs,[e("h2",hs,d(s(b).name),1),s(b).enabled===!1?(i(),l("span",ys," Hidden ")):y("",!0)]),s(b).tags?.length?(i(),l("div",_s,[(i(!0),l(F,null,j(s(b).tags,I=>(i(),l("span",{key:I,class:"px-2 py-1 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded-lg text-xs font-medium"},d(I),1))),128))])):y("",!0),e("p",ws,d(s(b).description||"No description provided."),1),e("div",ks,[t[10]||(t[10]=e("div",{class:"i-mdi-movie text-theme-text"},null,-1)),e("span",$s,d(s(b).movieIds.length),1),t[11]||(t[11]=h(" movies in collection ",-1))])]),e("div",Ss,[e("button",{class:D(["p-2 rounded-xl border border-theme-border hover:bg-theme-background transition-colors",s(b).enabled===!1?"text-green-600":"text-yellow-600"]),title:"Toggle Visibility",onClick:t[1]||(t[1]=I=>s(w)?.toggleEnabled(s(b)))},[e("div",{class:D([s(b).enabled===!1?"i-mdi-eye":"i-mdi-eye-off","text-xl"])},null,2)],2),e("button",{class:"p-2 rounded-xl border border-theme-border hover:bg-theme-background text-blue-600 transition-colors",title:"Edit Collection",onClick:t[2]||(t[2]=I=>s(w)?.editCollection(s(b)))},[...t[12]||(t[12]=[e("div",{class:"i-mdi-pencil text-xl"},null,-1)])]),e("button",{class:"p-2 rounded-xl border border-theme-border hover:bg-theme-background text-red-600 transition-colors",title:"Delete Collection",onClick:t[3]||(t[3]=I=>s(w)?.confirmDelete(s(b)))},[...t[13]||(t[13]=[e("div",{class:"i-mdi-delete text-xl"},null,-1)])])])])])):y("",!0),e("div",Cs,[t[14]||(t[14]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-magnify text-blue-600"}),h(" Search Library ")],-1)),L(V,{"collection-id":s(_),onAdd:T},null,8,["collection-id"])])]),e("div",Is,[e("div",Ts,[t[15]||(t[15]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-database-clock text-blue-600"}),h(" Dynamic Queries ")],-1)),L(M,{"collection-id":s(_),queries:s(b)?.savedQueries,onFiltersApplied:c},null,8,["collection-id","queries"])]),e("div",Vs,[t[17]||(t[17]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-playlist-play text-blue-600"}),h(" Collection Movies ")],-1)),s(_)?(i(),l("button",{key:0,class:"px-3 py-1 text-xs bg-theme-surface border border-theme-border rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 transition-colors flex items-center gap-2",title:"Remove movies that are no longer in the database",onClick:r},[...t[16]||(t[16]=[e("div",{class:"i-mdi-broom"},null,-1),h(" Cleanup ",-1)])])):y("",!0)]),L(z,{ref_key:"moviesList",ref:k,"collection-id":s(_)},null,8,["collection-id"])])])):y("",!0)])):(i(),l("div",ds,[t[5]||(t[5]=e("div",{class:"i-mdi-lock text-64px text-gray-300 dark:text-gray-700 mb-4"},null,-1)),t[6]||(t[6]=e("h1",{class:"text-2xl font-bold mb-2"},"Access Denied",-1)),t[7]||(t[7]=e("p",{class:"text-theme-textmuted"},"The admin interface is only available on localhost.",-1)),L(v,{to:"/",class:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors"},{default:te(()=>[...t[4]||(t[4]=[h(" Back to Home ",-1)])]),_:1})]))])])}}});export{Ls as default};
