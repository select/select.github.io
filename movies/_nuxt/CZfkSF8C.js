import{at as m,r as d,ae as c,au as w}from"./02OeVUp7.js";function z(a){return`${m().app.baseURL}posters/${a}.jpg`}let p=null;function f(){const a=d(null),u=d(!1),i=new Map,l=d(null);return{init:async n=>(l.value||(l.value=(async()=>{const s=await w(()=>import("./BiQWov_K.js"),[],import.meta.url);a.value=new s.default,a.value.onmessage=t=>{const{id:e,error:o,type:y}=t.data;if(y==="init-success"){u.value=!0;const v=i.get(e);v&&(v.resolve(t.data),i.delete(e));return}const g=i.get(e);g&&(o?g.reject(new Error(o)):g.resolve(t.data),i.delete(e))};const r=Math.random().toString(36).substring(7);return new Promise((t,e)=>{i.set(r,{resolve:o=>t(),reject:e}),a.value.postMessage({type:"init",id:r,url:n})})})()),l.value),query:async(n,s=[])=>{if(!u.value)throw new Error("Database not initialized");const r=Math.random().toString(36).substring(7);return new Promise((t,e)=>{i.set(r,{resolve:o=>t(o.result??[]),reject:e}),a.value.postMessage({type:"exec",id:r,sql:n,params:c(s)})})},extendedQuery:async n=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{i.set(s,{resolve:o=>r({result:o.result??[],totalCount:o.totalCount}),reject:t});const e={...n};e.params&&(e.params=c(e.params)),a.value.postMessage({type:"query",id:s,...e})})},lightweightQuery:async n=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{i.set(s,{resolve:o=>r({result:o.result??[],totalCount:o.totalCount}),reject:t});const e={...n};e.params&&(e.params=c(e.params)),a.value.postMessage({type:"query-lightweight",id:s,...e})})},queryByIds:async n=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{i.set(s,{resolve:e=>r(e.result??[]),reject:t}),a.value.postMessage({type:"query-by-ids",id:s,imdbIds:c(n)})})},getRelatedMovies:async(n,s=8)=>{if(!u.value)throw new Error("Database not initialized");const r=Math.random().toString(36).substring(7);return new Promise((t,e)=>{i.set(r,{resolve:o=>t(o.result??[]),reject:e}),a.value.postMessage({type:"query-related",id:r,imdbId:n,limit:s})})},getCollectionsForMovie:async n=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{i.set(s,{resolve:e=>r(e.result??[]),reject:t}),a.value.postMessage({type:"query-collections-for-movie",id:s,movieId:n})})},getFilterOptions:async()=>{if(!u.value)throw new Error("Database not initialized");const n=Math.random().toString(36).substring(7);return new Promise((s,r)=>{i.set(n,{resolve:t=>s({genres:t.genres??[],countries:t.countries??[],channels:t.channels??[]}),reject:r}),a.value.postMessage({type:"get-filter-options",id:n})})},isReady:u}}function C(){return p||(p=f()),p}export{z as g,C as u};
