import{_ as se}from"./D7z85Pj3.js";import{e as N,s as U,f as B,m as y,A as oe,h as Z,c as o,a as e,k as w,d as p,F as A,r as T,l as s,t as c,J as R,v as Y,z as E,B as J,y as q,o as l,q as j,D as ee,Y as le,p as G,b as F,Z as ie,$ as ne,w as X}from"./gTEv6Ct-.js";import{u as P}from"./B2x7Y8Eb.js";import{_ as re}from"./B5iGfxcA.js";import{g as te}from"./CCHQSMM1.js";import{u as O}from"./CYU45YWX.js";import{i as de}from"./BH85bPq3.js";const ae={class:"space-y-4"},ce={class:"flex items-center justify-between"},ue={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},me=["onClick"],be={class:"flex items-center justify-between mb-2 pr-12"},xe={key:0,class:"i-mdi-check-circle text-blue-600 text-xl flex-shrink-0"},fe={key:0,class:"flex flex-wrap gap-1 mb-2"},pe={class:"text-xs text-theme-textmuted line-clamp-1 mb-2"},ve={class:"flex items-center gap-2 text-xs font-mono bg-theme-bg/50 px-2 py-1 rounded w-fit"},ge=["onClick"],he=["onClick"],ye={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},_e={class:"bg-theme-surface rounded-2xl w-full max-w-lg shadow-2xl border border-theme-border overflow-hidden"},ke={class:"p-6 border-b border-theme-border flex items-center justify-between"},we={class:"text-xl font-bold"},$e=["disabled"],Se={class:"flex flex-wrap gap-2 p-3 bg-theme-background border border-theme-border rounded-lg min-h-[50px]"},Ce=["onClick"],Ie={class:"relative flex-1 min-w-[120px]"},Me=["onKeydown"],Ae={key:0,class:"absolute z-10 left-0 right-0 mt-2 bg-theme-surface border border-theme-border rounded-lg shadow-xl max-h-48 overflow-y-auto"},Te=["onMousedown"],Ve={class:"pt-4 flex gap-3"},Qe=["disabled"],Fe={key:0,class:"i-mdi-loading animate-spin mx-auto"},Le={key:1},je=N({__name:"AdminCollectionSelector",emits:["select"],setup(I,{emit:S}){const x=P(),{collections:f}=U(x),v=B(()=>Array.from(f.value.values())),g=y(""),b=S,C=i=>{g.value=i,b("select",i)},$=y(!1),_=y(null),r=y(!1),t=oe({id:"",name:"",description:"",tags:[]}),n=y(""),m=y(!1),k=B(()=>{const i=new Set;return f.value.forEach(d=>{d.tags&&d.tags.forEach(u=>i.add(u))}),Array.from(i).sort()}),M=B(()=>{const i=n.value.toLowerCase().trim();return k.value.filter(d=>d.toLowerCase().includes(i)&&!t.tags.includes(d))}),V=()=>{const i=n.value.trim();i&&!t.tags.includes(i)&&(t.tags.push(i),n.value="")},H=i=>{t.tags=t.tags.filter(d=>d!==i)},z=()=>{n.value===""&&t.tags.length>0&&t.tags.pop()},K=i=>{t.tags.includes(i)||t.tags.push(i),n.value="",m.value=!1},L=()=>{setTimeout(()=>{m.value=!1},200)},W=i=>{_.value=i,t.id=i.id,t.name=i.name,t.description=i.description,t.tags=[...i.tags||[]]},h=()=>{$.value=!1,_.value=null,t.id="",t.name="",t.description="",t.tags=[],n.value="",m.value=!1},a=async()=>{r.value=!0;try{const i=_.value?"/api/admin/collections/update":"/api/admin/collections/create";(await $fetch(i,{method:"POST",body:t})).success&&(await x.loadCollections(),h())}catch{}finally{r.value=!1}},D=async i=>{if(confirm(`Are you sure you want to delete the collection "${i.name}"? This cannot be undone.`))try{(await $fetch("/api/admin/collections/delete",{method:"POST",body:{id:i.id}})).success&&(g.value===i.id&&(g.value="",b("select","")),await x.loadCollections())}catch{}};return Z(async()=>{x.isLoaded||await x.loadCollections()}),(i,d)=>(l(),o("div",ae,[e("div",ce,[d[7]||(d[7]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Select Collection ",-1)),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:d[0]||(d[0]=u=>$.value=!0)},[...d[6]||(d[6]=[e("div",{class:"i-mdi-plus"},null,-1),p(" Create New ",-1)])])]),e("div",ue,[(l(!0),o(A,null,T(s(v),u=>(l(),o("div",{key:u.id,class:"relative group"},[e("button",{class:j(["w-full text-left p-4 rounded-xl border transition-all h-full",[s(g)===u.id?"bg-blue-600/10 border-blue-600 ring-2 ring-blue-600/20":"bg-theme-surface border-theme-border hover:border-theme-textmuted"]]),onClick:Q=>C(u.id)},[e("div",be,[e("span",{class:j(["font-bold text-lg truncate",s(g)===u.id?"text-blue-600 dark:text-blue-400":""])},c(u.name),3),s(g)===u.id?(l(),o("div",xe)):w("",!0)]),u.tags?.length?(l(),o("div",fe,[(l(!0),o(A,null,T(u.tags,Q=>(l(),o("span",{key:Q,class:"px-1.5 py-0.5 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded text-[10px] font-medium"},c(Q),1))),128))])):w("",!0),e("p",pe,c(u.description||"No description"),1),e("div",ve,[d[8]||(d[8]=e("div",{class:"i-mdi-movie"},null,-1)),p(" "+c(u.movieIds.length)+" movies ",1)])],10,me),e("div",{class:j(["absolute top-3 right-3 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",{"opacity-100":s(g)===u.id}])},[e("button",{class:"p-1.5 hover:bg-theme-selection rounded-lg text-blue-500 transition-colors",title:"Edit Collection",onClick:R(Q=>W(u),["stop"])},[...d[9]||(d[9]=[e("div",{class:"i-mdi-pencil text-lg"},null,-1)])],8,ge),e("button",{class:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg text-red-500 transition-colors",title:"Delete Collection",onClick:R(Q=>D(u),["stop"])},[...d[10]||(d[10]=[e("div",{class:"i-mdi-delete text-lg"},null,-1)])],8,he)],2)]))),128))]),s($)||s(_)?(l(),o("div",ye,[e("div",_e,[e("div",ke,[e("h3",we,c(s(_)?"Edit Collection":"Create New Collection"),1),e("button",{class:"p-2 hover:bg-theme-selection rounded-full transition-colors",onClick:h},[...d[11]||(d[11]=[e("div",{class:"i-mdi-close text-xl"},null,-1)])])]),e("form",{class:"p-6 space-y-4",onSubmit:R(a,["prevent"])},[e("div",null,[d[12]||(d[12]=e("label",{class:"block text-sm font-bold mb-1"},"ID (URL Slug)",-1)),Y(e("input",{"onUpdate:modelValue":d[1]||(d[1]=u=>s(t).id=u),type:"text",placeholder:"e.g. charlie-chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm font-mono",disabled:!!s(_),required:""},null,8,$e),[[E,s(t).id]])]),e("div",null,[d[13]||(d[13]=e("label",{class:"block text-sm font-bold mb-1"},"Name",-1)),Y(e("input",{"onUpdate:modelValue":d[2]||(d[2]=u=>s(t).name=u),type:"text",placeholder:"e.g. Charlie Chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm",required:""},null,512),[[E,s(t).name]])]),e("div",null,[d[14]||(d[14]=e("label",{class:"block text-sm font-bold mb-1"},"Description",-1)),Y(e("textarea",{"onUpdate:modelValue":d[3]||(d[3]=u=>s(t).description=u),rows:"3",placeholder:"Describe this collection...",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm"},null,512),[[E,s(t).description]])]),e("div",null,[d[16]||(d[16]=e("label",{class:"block text-sm font-bold mb-1"},"Tags",-1)),e("div",Se,[(l(!0),o(A,null,T(s(t).tags,u=>(l(),o("div",{key:u,class:"flex items-center gap-1.5 px-3 py-1 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded-full text-sm font-medium group"},[p(c(u)+" ",1),e("button",{type:"button",class:"p-0.5 hover:bg-blue-600/20 rounded-full transition-colors",onClick:Q=>H(u)},[...d[15]||(d[15]=[e("div",{class:"i-mdi-close text-xs"},null,-1)])],8,Ce)]))),128)),e("div",Ie,[Y(e("input",{"onUpdate:modelValue":d[4]||(d[4]=u=>q(n)?n.value=u:null),type:"text",placeholder:"Add tag...",class:"w-full bg-transparent border-none focus:ring-0 text-sm py-1",onKeydown:[J(R(V,["prevent"]),["enter"]),J(z,["backspace"])],onFocus:d[5]||(d[5]=u=>m.value=!0),onBlur:L},null,40,Me),[[E,s(n)]]),s(m)&&s(M).length>0?(l(),o("div",Ae,[(l(!0),o(A,null,T(s(M),u=>(l(),o("button",{key:u,type:"button",class:"w-full text-left px-4 py-2 text-sm hover:bg-theme-selection transition-colors",onMousedown:R(Q=>K(u),["prevent"])},c(u),41,Te))),128))])):w("",!0)])])]),e("div",Ve,[e("button",{type:"button",class:"flex-1 px-4 py-2 border border-theme-border rounded-lg font-bold hover:bg-theme-selection transition-colors",onClick:h}," Cancel "),e("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-500 transition-colors disabled:opacity-50",disabled:s(r)},[s(r)?(l(),o("div",Fe)):(l(),o("span",Le,c(s(_)?"Update":"Create"),1))],8,Qe)])],32)])])):w("",!0)]))}}),De=Object.assign(je,{__name:"AdminCollectionSelector"}),Re={class:"space-y-4"},Ye={class:"flex items-center gap-4"},Ee={class:"relative flex-1"},Ne={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},Pe={key:0,class:"bg-blue-600 text-white px-1.5 py-0.5 rounded-full text-[10px]"},Be={key:0,class:"flex flex-wrap items-center gap-2"},Ue={key:0,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},Oe={key:1,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},ze={key:2,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},Ke={key:1,class:"bg-theme-surface border border-theme-border rounded-2xl overflow-hidden divide-y divide-theme-border"},We={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},Ge=["src","alt"],He={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},Je={class:"flex-1 min-w-0"},Xe={class:"flex items-center gap-2"},Ze={class:"font-bold truncate"},qe={class:"text-xs text-theme-textmuted font-mono"},et={class:"text-xs text-theme-textmuted truncate"},tt={class:"text-[10px] text-theme-textmuted font-mono mt-0.5"},st=["disabled","onClick"],ot={key:0,class:"i-mdi-loading animate-spin"},lt={key:2,class:"p-8 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},it=N({__name:"AdminMovieSearch",props:{collectionId:{}},emits:["add"],setup(I,{emit:S}){const x=I,f=S,v=P(),g=O(),{filters:b,activeFiltersCount:C,hasActiveFilters:$}=U(g),{resetFilters:_}=g,r=ee(),t=y(null),n=y(""),m=y([]),k=y(!1),M=y(""),V=y(!1);le("/",h=>{const a=window.document.activeElement,D=a?.tagName==="INPUT"||a?.tagName==="TEXTAREA";h.preventDefault(),D||t.value?.focus()}),G(n,h=>{g.setSearchQuery(h)}),G(()=>b.value.searchQuery,h=>{h!==n.value&&(n.value=h)});const z=ie(async()=>{if(n.value.length<3){m.value=[];return}k.value=!0;try{const h=await $fetch("/api/admin/movies/search",{query:{q:n.value}});m.value=h}catch{r.showToast("Search failed","error")}finally{k.value=!1}},300),K=()=>{z()},L=h=>v.isMovieInCollection(h,x.collectionId),W=async h=>{M.value=h;try{await v.addMovieToCollection(x.collectionId,h)?(r.showToast("Movie added to collection"),f("add")):r.showToast("Failed to add movie","error")}catch{r.showToast("Error adding movie","error")}finally{M.value=""}};return(h,a)=>{const D=re;return l(),o("div",Re,[e("div",Ye,[e("div",Ee,[a[6]||(a[6]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-theme-textmuted"},[e("div",{class:"i-mdi-magnify text-xl"})],-1)),Y(e("input",{ref_key:"searchInput",ref:t,"onUpdate:modelValue":a[0]||(a[0]=i=>q(n)?n.value=i:null),type:"text",placeholder:"Search by title, director, writer, plot or IMDb ID...",class:"block w-full pl-10 pr-3 py-3 border border-theme-border rounded-xl bg-theme-surface focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none",onInput:K},null,544),[[E,s(n)]]),s(k)?(l(),o("div",Ne,[...a[5]||(a[5]=[e("div",{class:"i-mdi-loading animate-spin text-blue-600"},null,-1)])])):w("",!0)]),e("button",{class:"px-4 py-3 bg-theme-surface border border-theme-border rounded-xl text-sm font-bold hover:bg-theme-selection transition-colors flex items-center gap-2",onClick:a[1]||(a[1]=i=>V.value=!0)},[a[7]||(a[7]=e("div",{class:"i-mdi-filter-variant"},null,-1)),a[8]||(a[8]=p(" Filters ",-1)),s(C)>0?(l(),o("span",Pe,c(s(C)),1)):w("",!0)])]),s($)?(l(),o("div",Be,[s(b).minRating>0?(l(),o("div",Ue,[a[9]||(a[9]=e("div",{class:"i-mdi-star"},null,-1)),p(" "+c(s(b).minRating)+"+ ",1)])):w("",!0),s(b).minYear>0||s(b).maxYear?(l(),o("div",Oe,[a[10]||(a[10]=e("div",{class:"i-mdi-calendar"},null,-1)),p(" "+c(s(b).minYear||1910)+" - "+c(s(b).maxYear||2025),1)])):w("",!0),s(b).minVotes>0||s(b).maxVotes?(l(),o("div",ze,[a[11]||(a[11]=e("div",{class:"i-mdi-account-group"},null,-1)),p(" "+c(s(b).minVotes.toLocaleString())+" - "+c(s(b).maxVotes?s(b).maxVotes.toLocaleString():"Any"),1)])):w("",!0),(l(!0),o(A,null,T(s(b).genres,i=>(l(),o("div",{key:i,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[a[12]||(a[12]=e("div",{class:"i-mdi-movie-filter"},null,-1)),p(" "+c(i),1)]))),128)),(l(!0),o(A,null,T(s(b).sources,i=>(l(),o("div",{key:i,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[a[13]||(a[13]=e("div",{class:"i-mdi-source-branch"},null,-1)),p(" "+c(i),1)]))),128)),e("button",{class:"text-xs text-theme-primary hover:underline ml-2",onClick:a[2]||(a[2]=(...i)=>s(_)&&s(_)(...i))}," Clear All ")])):w("",!0),s(m).length>0?(l(),o("div",Ke,[(l(!0),o(A,null,T(s(m),i=>(l(),o("div",{key:i.imdbId,class:"p-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",We,[i.imdbId?.startsWith("tt")?(l(),o("img",{key:0,src:("getPosterPath"in h?h.getPosterPath:s(te))(i.imdbId),alt:i.title,class:"w-full h-full object-cover",onError:a[3]||(a[3]=d=>d.target.style.display="none")},null,40,Ge)):(l(),o("div",He,[...a[14]||(a[14]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",Je,[e("div",Xe,[e("h4",Ze,c(i.title),1),e("span",qe,c(i.year),1)]),e("p",et,c(i.metadata?.Director||"Unknown Director"),1),e("p",tt,c(i.imdbId),1)]),e("button",{class:j(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1.5 disabled:opacity-50",L(i.imdbId)?"bg-theme-selection text-theme-textmuted cursor-default":"bg-blue-600 hover:bg-blue-500 text-white"]),disabled:L(i.imdbId)||s(M)===i.imdbId,onClick:d=>W(i.imdbId)},[s(M)===i.imdbId?(l(),o("div",ot)):(l(),o("div",{key:1,class:j(L(i.imdbId)?"i-mdi-check":"i-mdi-plus")},null,2)),p(" "+c(L(i.imdbId)?"Added":"Add"),1)],10,st)]))),128))])):s(n).length>=3&&!s(k)?(l(),o("div",lt,' No movies found for "'+c(s(n))+'" ',1)):w("",!0),F(D,{"is-open":s(V),onClose:a[4]||(a[4]=i=>V.value=!1)},null,8,["is-open"])])}}}),nt=Object.assign(it,{__name:"AdminMovieSearch"}),rt={class:"space-y-4"},dt={key:0,class:"text-sm text-theme-textmuted italic p-4 bg-theme-surface border border-theme-border border-dashed rounded-xl text-center"},at={key:1,class:"space-y-3"},ct={class:"flex items-start justify-between gap-4"},ut={class:"flex-1 space-y-2"},mt={class:"flex items-center gap-2"},bt={class:"font-bold text-sm"},xt={class:"flex flex-wrap gap-2"},ft={class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},pt={key:0,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},vt={key:1,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},gt={key:2,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},ht={key:3,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},yt={key:4,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},_t={class:"flex items-center gap-1"},kt=["onClick"],wt=["onClick"],$t={class:"flex justify-end pt-2"},St=["disabled"],Ct=N({__name:"AdminSavedQueryManager",props:{collectionId:{},queries:{}},setup(I){const S=I,x=P(),f=O(),{filters:v}=U(f),g=y(!1),b=async()=>{const r={sort:{...v.value.sort},sources:[...v.value.sources],minRating:v.value.minRating,minYear:v.value.minYear,maxYear:v.value.maxYear,minVotes:v.value.minVotes,maxVotes:v.value.maxVotes,genres:[...v.value.genres],countries:[...v.value.countries],searchQuery:v.value.searchQuery,currentPage:1,lastScrollY:0},t={searchQuery:v.value.searchQuery,filterState:r};await x.addQueryToCollection(S.collectionId,t)},C=async r=>{confirm("Are you sure you want to remove this saved query?")&&await x.removeQueryFromCollection(S.collectionId,r)},$=r=>{f.resetFilters(),f.setSearchQuery(r.searchQuery),f.setSort(r.filterState.sort),f.setMinRating(r.filterState.minRating),f.setMinYear(r.filterState.minYear),r.filterState.maxYear&&f.setMaxYear(r.filterState.maxYear),f.setMinVotes(r.filterState.minVotes),r.filterState.maxVotes&&f.setMaxVotes(r.filterState.maxVotes),r.filterState.genres.forEach(t=>f.toggleGenre(t)),r.filterState.countries.forEach(t=>f.toggleCountry(t)),r.filterState.sources.forEach(t=>f.toggleSource(t))},_=async()=>{g.value=!0;try{const r=await x.refreshCollectionFromQuery(S.collectionId);r.success&&alert(`Collection refreshed! Now contains ${r.movieCount} movies.`)}finally{g.value=!1}};return(r,t)=>(l(),o("div",rt,[e("div",{class:"flex items-center justify-between"},[t[1]||(t[1]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Saved Queries ",-1)),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:b},[...t[0]||(t[0]=[e("div",{class:"i-mdi-plus"},null,-1),p(" Save Current Search ",-1)])])]),!I.queries||I.queries.length===0?(l(),o("div",dt," No saved queries for this collection. ")):(l(),o("div",at,[(l(!0),o(A,null,T(I.queries,(n,m)=>(l(),o("div",{key:m,class:"p-4 bg-theme-surface border border-theme-border rounded-xl group hover:border-theme-textmuted transition-all"},[e("div",ct,[e("div",ut,[e("div",mt,[t[2]||(t[2]=e("div",{class:"i-mdi-magnify text-theme-textmuted"},null,-1)),e("span",bt,c(n.searchQuery||"All Movies"),1)]),e("div",xt,[e("div",ft,[t[3]||(t[3]=e("div",{class:"i-mdi-sort"},null,-1)),p(" "+c(n.filterState.sort.field)+" ("+c(n.filterState.sort.direction)+") ",1)]),n.filterState.minYear>0||n.filterState.maxYear?(l(),o("div",pt,[t[4]||(t[4]=e("div",{class:"i-mdi-calendar"},null,-1)),p(" "+c(n.filterState.minYear||1910)+" - "+c(n.filterState.maxYear||2025),1)])):w("",!0),n.filterState.minRating>0?(l(),o("div",vt,[t[5]||(t[5]=e("div",{class:"i-mdi-star"},null,-1)),p(" "+c(n.filterState.minRating)+"+ ",1)])):w("",!0),n.filterState.minVotes>0||n.filterState.maxVotes?(l(),o("div",gt,[t[6]||(t[6]=e("div",{class:"i-mdi-account-group"},null,-1)),p(" "+c(n.filterState.minVotes.toLocaleString())+" - "+c(n.filterState.maxVotes?n.filterState.maxVotes.toLocaleString():"Any"),1)])):w("",!0),n.filterState.genres?.length?(l(),o("div",ht,[t[7]||(t[7]=e("div",{class:"i-mdi-movie-filter"},null,-1)),p(" "+c(n.filterState.genres.join(", ")),1)])):w("",!0),n.filterState.sources?.length?(l(),o("div",yt,[t[8]||(t[8]=e("div",{class:"i-mdi-source-branch"},null,-1)),p(" "+c(n.filterState.sources.join(", ")),1)])):w("",!0)])]),e("div",_t,[e("button",{class:"p-2 hover:bg-blue-600/10 text-blue-600 rounded-lg transition-colors",title:"Apply Filters",onClick:k=>$(n)},[...t[9]||(t[9]=[e("div",{class:"i-mdi-filter-variant"},null,-1)])],8,kt),e("button",{class:"p-2 hover:bg-red-600/10 text-red-600 rounded-lg transition-colors",title:"Remove Query",onClick:k=>C(m)},[...t[10]||(t[10]=[e("div",{class:"i-mdi-delete"},null,-1)])],8,wt)])])]))),128))])),e("div",$t,[e("button",{class:"px-4 py-2 bg-theme-primary text-white rounded-lg text-sm font-bold transition-colors flex items-center gap-2 disabled:opacity-50",disabled:s(g)||!I.queries?.length,onClick:_},[e("div",{class:j([s(g)?"i-mdi-loading animate-spin":"i-mdi-refresh"])},null,2),t[11]||(t[11]=p(" Refresh Collection from Queries ",-1))],8,St)])]))}}),It=Object.assign(Ct,{__name:"AdminSavedQueryManager"}),Mt={class:"space-y-4"},At={key:0,class:"p-12 flex justify-center"},Tt={key:1,class:"overflow-hidden divide-y divide-theme-border"},Vt={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},Qt=["src","alt"],Ft={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},Lt={class:"flex-1 min-w-0"},jt={class:"flex items-center gap-2"},Dt={class:"font-bold truncate"},Rt={class:"text-xs text-theme-textmuted font-mono"},Yt={class:"text-xs text-theme-textmuted truncate"},Et={class:"text-[10px] text-theme-textmuted font-mono mt-0.5"},Nt=["disabled","onClick"],Pt={key:0,class:"i-mdi-loading animate-spin text-xl"},Bt={key:1,class:"i-mdi-trash-can-outline text-xl"},Ut={key:2,class:"p-12 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},Ot=N({__name:"AdminCollectionMoviesList",props:{collectionId:{}},setup(I,{expose:S}){const x=I,f=P(),v=O(),g=ee(),b=y([]),C=y(!1),$=y(""),_=async()=>{if(x.collectionId){C.value=!0;try{const t=await f.getCollectionById(x.collectionId);if(!t||!t.movieIds||!t.movieIds.length){b.value=[];return}!v.allMovies.size&&!v.isLoading.movies&&await v.loadFromFile();const n=ne(t.movieIds),m=await v.fetchMoviesByIds(n);b.value=n.map(k=>m.find(M=>M.imdbId===k)).filter(k=>!!k)}catch(t){console.error("Failed to load collection movies:",t),g.showToast("Failed to load collection movies","error")}finally{C.value=!1}}},r=async t=>{if(confirm(`Remove "${t.title}" from this collection?`)){$.value=t.imdbId;try{await f.removeMovieFromCollection(x.collectionId,t.imdbId)?(g.showToast("Movie removed from collection"),await _()):g.showToast("Failed to remove movie","error")}catch{g.showToast("Error removing movie","error")}finally{$.value=""}}};return S({refresh:_}),G(()=>x.collectionId,()=>{_()},{immediate:!0}),(t,n)=>(l(),o("div",Mt,[s(C)?(l(),o("div",At,[...n[1]||(n[1]=[e("div",{class:"i-mdi-loading animate-spin text-4xl text-blue-600"},null,-1)])])):s(b).length>0?(l(),o("div",Tt,[(l(!0),o(A,null,T(s(b),m=>(l(),o("div",{key:m.imdbId,class:"py-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",Vt,[m.imdbId?.startsWith("tt")?(l(),o("img",{key:0,src:("getPosterPath"in t?t.getPosterPath:s(te))(m.imdbId),alt:m.title,class:"w-full h-full object-cover",onError:n[0]||(n[0]=k=>k.target.style.display="none")},null,40,Qt)):(l(),o("div",Ft,[...n[2]||(n[2]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",Lt,[e("div",jt,[e("h4",Dt,c(m.title),1),e("span",Rt,c(m.year),1)]),e("p",Yt,c(m.metadata?.Director||"Unknown Director"),1),e("p",Et,c(m.imdbId),1)]),e("button",{class:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Remove from collection",disabled:s($)===m.imdbId,onClick:k=>r(m)},[s($)===m.imdbId?(l(),o("div",Pt)):(l(),o("div",Bt))],8,Nt)]))),128))])):(l(),o("div",Ut,[...n[3]||(n[3]=[e("div",{class:"i-mdi-movie-off-outline text-4xl mx-auto mb-2 opacity-20"},null,-1),e("p",null,"No movies in this collection yet.",-1)])]))]))}}),zt=Object.assign(Ot,{__name:"AdminCollectionMoviesList"}),Kt={class:"min-h-screen bg-theme-background text-theme-text p-4 md:ml-16 transition-colors duration-300"},Wt={class:"max-w-7xl mx-auto space-y-8"},Gt={key:0,class:"flex flex-col items-center justify-center h-[60vh] text-center"},Ht={key:1,class:"flex flex-col gap-8"},Jt={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},Xt={class:"bg-theme-surface border border-theme-border rounded-2xl p-6"},Zt={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},qt={class:"space-y-8"},es={class:"space-y-6"},ts={class:"space-y-6"},ss={class:"bg-theme-surface border border-theme-border rounded-2xl p-6 space-y-6"},cs=N({__name:"index",setup(I){const S=y(!1),x=y(""),f=y(null),v=O(),g=P(),{collections:b}=U(g),C=B(()=>x.value&&b.value.get(x.value)||null);Z(async()=>{S.value=de(),S.value&&await v.loadFromFile()});const $=()=>{f.value&&f.value.refresh()};return(_,r)=>{const t=se,n=De,m=nt,k=It,M=zt;return l(),o("div",Kt,[e("main",Wt,[s(S)?(l(),o("div",Ht,[e("header",Jt,[r[6]||(r[6]=e("div",null,[e("h1",{class:"text-3xl font-bold flex items-center gap-3"},[e("div",{class:"i-mdi-movie-edit text-blue-600"}),p(" Collection Editor ")]),e("p",{class:"text-theme-textmuted mt-1"}," Add and remove movies from collections ")],-1)),F(t,{to:"/admin",class:"px-4 py-2 text-sm bg-theme-surface border border-theme-border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"},{default:X(()=>[...r[5]||(r[5]=[e("div",{class:"i-mdi-arrow-left"},null,-1),p(" Back to Dashboard ",-1)])]),_:1})]),e("section",Xt,[F(n,{onSelect:r[0]||(r[0]=V=>x.value=V)})]),s(x)?(l(),o("section",Zt,[e("div",qt,[e("div",es,[r[7]||(r[7]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-magnify text-blue-600"}),p(" Search Library ")],-1)),F(m,{"collection-id":s(x),onAdd:$},null,8,["collection-id"])])]),e("div",ts,[e("div",ss,[r[8]||(r[8]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-database-clock text-blue-600"}),p(" Dynamic Queries ")],-1)),F(k,{"collection-id":s(x),queries:s(C)?.savedQueries},null,8,["collection-id","queries"])]),r[9]||(r[9]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-playlist-play text-blue-600"}),p(" Collection Movies ")],-1)),F(M,{ref_key:"moviesList",ref:f,"collection-id":s(x)},null,8,["collection-id"])])])):w("",!0)])):(l(),o("div",Gt,[r[2]||(r[2]=e("div",{class:"i-mdi-lock text-64px text-gray-300 dark:text-gray-700 mb-4"},null,-1)),r[3]||(r[3]=e("h1",{class:"text-2xl font-bold mb-2"}," Access Denied ",-1)),r[4]||(r[4]=e("p",{class:"text-theme-textmuted"}," The admin interface is only available on localhost. ",-1)),F(t,{to:"/",class:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors"},{default:X(()=>[...r[1]||(r[1]=[p(" Back to Home ",-1)])]),_:1})]))])])}}});export{cs as default};
