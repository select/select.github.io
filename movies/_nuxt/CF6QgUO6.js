import{_ as q}from"./CilegPor.js";import{e as D,s as O,f as z,m as h,A as W,h as B,c as l,a as e,k as M,d as $,F as j,r as P,l as o,t as f,J as L,v as A,z as T,o as i,q as S,D as E,y as H,p as J,Y as Q,b as I,w as U}from"./Bs7tUwCE.js";import{u as F}from"./v_F87mN3.js";import{g as V}from"./BOPs-8Hy.js";import{u as R}from"./6v54Hgrk.js";import{i as Y}from"./BH85bPq3.js";const G={class:"space-y-4"},K={class:"flex items-center justify-between"},X={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},Z=["onClick"],ee={class:"flex items-center justify-between mb-2 pr-12"},te={key:0,class:"i-mdi-check-circle text-blue-600 text-xl flex-shrink-0"},oe={class:"text-xs text-theme-textmuted line-clamp-1 mb-2"},se={class:"flex items-center gap-2 text-xs font-mono bg-theme-bg/50 px-2 py-1 rounded w-fit"},le=["onClick"],ie=["onClick"],ne={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},de={class:"bg-theme-surface rounded-2xl w-full max-w-lg shadow-2xl border border-theme-border overflow-hidden"},re={class:"p-6 border-b border-theme-border flex items-center justify-between"},ae={class:"text-xl font-bold"},ce=["disabled"],me={class:"pt-4 flex gap-3"},ue=["disabled"],be={key:0,class:"i-mdi-loading animate-spin mx-auto"},xe={key:1},pe=D({__name:"AdminCollectionSelector",emits:["select"],setup(C,{emit:w}){const m=F(),{collections:_}=O(m),g=z(()=>Array.from(_.value.values())),c=h(""),x=w,n=d=>{c.value=d,x("select",d)},p=h(!1),u=h(null),y=h(!1),s=W({id:"",name:"",description:""}),b=d=>{u.value=d,s.id=d.id,s.name=d.name,s.description=d.description},r=()=>{p.value=!1,u.value=null,s.id="",s.name="",s.description=""},k=async()=>{y.value=!0;try{const d=u.value?"/api/admin/collections/update":"/api/admin/collections/create";(await $fetch(d,{method:"POST",body:s})).success&&(await m.loadCollections(),r())}catch{}finally{y.value=!1}},v=async d=>{if(confirm(`Are you sure you want to delete the collection "${d.name}"? This cannot be undone.`))try{(await $fetch("/api/admin/collections/delete",{method:"POST",body:{id:d.id}})).success&&(c.value===d.id&&(c.value="",x("select","")),await m.loadCollections())}catch{}};return B(async()=>{m.isLoaded||await m.loadCollections()}),(d,t)=>(i(),l("div",G,[e("div",K,[t[5]||(t[5]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Select Collection ",-1)),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:t[0]||(t[0]=a=>p.value=!0)},[...t[4]||(t[4]=[e("div",{class:"i-mdi-plus"},null,-1),$(" Create New ",-1)])])]),e("div",X,[(i(!0),l(j,null,P(o(g),a=>(i(),l("div",{key:a.id,class:"relative group"},[e("button",{class:S(["w-full text-left p-4 rounded-xl border transition-all h-full",[o(c)===a.id?"bg-blue-600/10 border-blue-600 ring-2 ring-blue-600/20":"bg-theme-surface border-theme-border hover:border-theme-textmuted"]]),onClick:N=>n(a.id)},[e("div",ee,[e("span",{class:S(["font-bold text-lg truncate",o(c)===a.id?"text-blue-600 dark:text-blue-400":""])},f(a.name),3),o(c)===a.id?(i(),l("div",te)):M("",!0)]),e("p",oe,f(a.description||"No description"),1),e("div",se,[t[6]||(t[6]=e("div",{class:"i-mdi-movie"},null,-1)),$(" "+f(a.movieIds.length)+" movies ",1)])],10,Z),e("div",{class:S(["absolute top-3 right-3 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",{"opacity-100":o(c)===a.id}])},[e("button",{class:"p-1.5 hover:bg-theme-selection rounded-lg text-blue-500 transition-colors",title:"Edit Collection",onClick:L(N=>b(a),["stop"])},[...t[7]||(t[7]=[e("div",{class:"i-mdi-pencil text-lg"},null,-1)])],8,le),e("button",{class:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg text-red-500 transition-colors",title:"Delete Collection",onClick:L(N=>v(a),["stop"])},[...t[8]||(t[8]=[e("div",{class:"i-mdi-delete text-lg"},null,-1)])],8,ie)],2)]))),128))]),o(p)||o(u)?(i(),l("div",ne,[e("div",de,[e("div",re,[e("h3",ae,f(o(u)?"Edit Collection":"Create New Collection"),1),e("button",{class:"p-2 hover:bg-theme-selection rounded-full transition-colors",onClick:r},[...t[9]||(t[9]=[e("div",{class:"i-mdi-close text-xl"},null,-1)])])]),e("form",{class:"p-6 space-y-4",onSubmit:L(k,["prevent"])},[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-bold mb-1"},"ID (URL Slug)",-1)),A(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>o(s).id=a),type:"text",placeholder:"e.g. charlie-chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm font-mono",disabled:!!o(u),required:""},null,8,ce),[[T,o(s).id]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-bold mb-1"},"Name",-1)),A(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>o(s).name=a),type:"text",placeholder:"e.g. Charlie Chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm",required:""},null,512),[[T,o(s).name]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-bold mb-1"},"Description",-1)),A(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=a=>o(s).description=a),rows:"3",placeholder:"Describe this collection...",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm"},null,512),[[T,o(s).description]])]),e("div",me,[e("button",{type:"button",class:"flex-1 px-4 py-2 border border-theme-border rounded-lg font-bold hover:bg-theme-selection transition-colors",onClick:r}," Cancel "),e("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-500 transition-colors disabled:opacity-50",disabled:o(y)},[o(y)?(i(),l("div",be)):(i(),l("span",xe,f(o(u)?"Update":"Create"),1))],8,ue)])],32)])])):M("",!0)]))}}),fe=Object.assign(pe,{__name:"AdminCollectionSelector"}),he={class:"space-y-4"},ve={class:"relative"},ge={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},ye={key:0,class:"bg-theme-surface border border-theme-border rounded-2xl overflow-hidden divide-y divide-theme-border"},_e={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},we=["src","alt"],ke={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},$e={class:"flex-1 min-w-0"},Ce={class:"flex items-center gap-2"},Ie={class:"font-bold truncate"},Se={class:"text-xs text-theme-textmuted font-mono"},Me={class:"text-xs text-theme-textmuted truncate"},Ae={class:"text-[10px] text-theme-textmuted font-mono mt-0.5"},Te=["disabled","onClick"],De={key:0,class:"i-mdi-loading animate-spin"},Le={key:1,class:"p-8 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},je=D({__name:"AdminMovieSearch",props:{collectionId:{}},emits:["add"],setup(C,{emit:w}){const m=C,_=w,g=F(),c=E(),x=h(""),n=h([]),p=h(!1),u=h("");let y;const s=()=>{if(clearTimeout(y),x.value.length<3){n.value=[];return}y=setTimeout(b,300)},b=async()=>{p.value=!0;try{const v=await $fetch("/api/admin/movies/search",{query:{q:x.value}});n.value=v}catch{c.showToast("Search failed","error")}finally{p.value=!1}},r=v=>g.isMovieInCollection(v,m.collectionId),k=async v=>{u.value=v;try{await g.addMovieToCollection(m.collectionId,v)?(c.showToast("Movie added to collection"),_("add")):c.showToast("Failed to add movie","error")}catch{c.showToast("Error adding movie","error")}finally{u.value=""}};return(v,d)=>(i(),l("div",he,[e("div",ve,[d[3]||(d[3]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-theme-textmuted"},[e("div",{class:"i-mdi-magnify text-xl"})],-1)),A(e("input",{"onUpdate:modelValue":d[0]||(d[0]=t=>H(x)?x.value=t:null),type:"text",placeholder:"Search by title, director, writer, plot or IMDb ID...",class:"block w-full pl-10 pr-3 py-3 border border-theme-border rounded-xl bg-theme-surface focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none",onInput:s},null,544),[[T,o(x)]]),o(p)?(i(),l("div",ge,[...d[2]||(d[2]=[e("div",{class:"i-mdi-loading animate-spin text-blue-600"},null,-1)])])):M("",!0)]),o(n).length>0?(i(),l("div",ye,[(i(!0),l(j,null,P(o(n),t=>(i(),l("div",{key:t.imdbId,class:"p-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",_e,[t.imdbId?.startsWith("tt")?(i(),l("img",{key:0,src:("getPosterPath"in v?v.getPosterPath:o(V))(t.imdbId),alt:t.title,class:"w-full h-full object-cover",onError:d[1]||(d[1]=a=>a.target.style.display="none")},null,40,we)):(i(),l("div",ke,[...d[4]||(d[4]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",$e,[e("div",Ce,[e("h4",Ie,f(t.title),1),e("span",Se,f(t.year),1)]),e("p",Me,f(t.metadata?.Director||"Unknown Director"),1),e("p",Ae,f(t.imdbId),1)]),e("button",{class:S(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1.5 disabled:opacity-50",r(t.imdbId)?"bg-theme-selection text-theme-textmuted cursor-default":"bg-blue-600 hover:bg-blue-500 text-white"]),disabled:r(t.imdbId)||o(u)===t.imdbId,onClick:a=>k(t.imdbId)},[o(u)===t.imdbId?(i(),l("div",De)):(i(),l("div",{key:1,class:S(r(t.imdbId)?"i-mdi-check":"i-mdi-plus")},null,2)),$(" "+f(r(t.imdbId)?"Added":"Add"),1)],10,Te)]))),128))])):o(x).length>=3&&!o(p)?(i(),l("div",Le,' No movies found for "'+f(o(x))+'" ',1)):M("",!0)]))}}),Pe=Object.assign(je,{__name:"AdminMovieSearch"}),Fe={class:"space-y-4"},Ne={key:0,class:"p-12 flex justify-center"},Ue={key:1,class:"bg-theme-surface border border-theme-border rounded-2xl overflow-hidden divide-y divide-theme-border"},Be={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},Ee=["src","alt"],Ve={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},Re={class:"flex-1 min-w-0"},qe={class:"flex items-center gap-2"},Oe={class:"font-bold truncate"},ze={class:"text-xs text-theme-textmuted font-mono"},We={class:"text-xs text-theme-textmuted truncate"},He={class:"text-[10px] text-theme-textmuted font-mono mt-0.5"},Je=["disabled","onClick"],Qe={key:0,class:"i-mdi-loading animate-spin text-xl"},Ye={key:1,class:"i-mdi-trash-can-outline text-xl"},Ge={key:2,class:"p-12 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},Ke=D({__name:"AdminCollectionMoviesList",props:{collectionId:{}},setup(C,{expose:w}){const m=C,_=F(),g=R(),c=E(),x=h([]),n=h(!1),p=h(""),u=async()=>{if(m.collectionId){n.value=!0;try{const s=await _.getCollectionById(m.collectionId);if(!s||!s.movieIds||!s.movieIds.length){x.value=[];return}!g.allMovies.size&&!g.isLoading.movies&&await g.loadFromFile();const b=Q(s.movieIds),r=await g.fetchMoviesByIds(b);x.value=b.map(k=>r.find(v=>v.imdbId===k)).filter(Boolean)}catch(s){console.error("Failed to load collection movies:",s),c.showToast("Failed to load collection movies","error")}finally{n.value=!1}}},y=async s=>{if(confirm(`Remove "${s.title}" from this collection?`)){p.value=s.imdbId;try{await _.removeMovieFromCollection(m.collectionId,s.imdbId)?(c.showToast("Movie removed from collection"),await u()):c.showToast("Failed to remove movie","error")}catch{c.showToast("Error removing movie","error")}finally{p.value=""}}};return w({refresh:u}),J(()=>m.collectionId,()=>{u()},{immediate:!0}),(s,b)=>(i(),l("div",Fe,[o(n)?(i(),l("div",Ne,[...b[1]||(b[1]=[e("div",{class:"i-mdi-loading animate-spin text-4xl text-blue-600"},null,-1)])])):o(x).length>0?(i(),l("div",Ue,[(i(!0),l(j,null,P(o(x),r=>(i(),l("div",{key:r.imdbId,class:"p-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",Be,[r.imdbId?.startsWith("tt")?(i(),l("img",{key:0,src:("getPosterPath"in s?s.getPosterPath:o(V))(r.imdbId),alt:r.title,class:"w-full h-full object-cover",onError:b[0]||(b[0]=k=>k.target.style.display="none")},null,40,Ee)):(i(),l("div",Ve,[...b[2]||(b[2]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",Re,[e("div",qe,[e("h4",Oe,f(r.title),1),e("span",ze,f(r.year),1)]),e("p",We,f(r.metadata?.Director||"Unknown Director"),1),e("p",He,f(r.imdbId),1)]),e("button",{class:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Remove from collection",disabled:o(p)===r.imdbId,onClick:k=>y(r)},[o(p)===r.imdbId?(i(),l("div",Qe)):(i(),l("div",Ye))],8,Je)]))),128))])):(i(),l("div",Ge,[...b[3]||(b[3]=[e("div",{class:"i-mdi-movie-off-outline text-4xl mx-auto mb-2 opacity-20"},null,-1),e("p",null,"No movies in this collection yet.",-1)])]))]))}}),Xe=Object.assign(Ke,{__name:"AdminCollectionMoviesList"}),Ze={class:"min-h-screen bg-theme-background text-theme-text p-4 md:ml-16 transition-colors duration-300"},et={class:"max-w-7xl mx-auto space-y-8"},tt={key:0,class:"flex flex-col items-center justify-center h-[60vh] text-center"},ot={key:1},st={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},lt={class:"bg-theme-surface border border-theme-border rounded-2xl p-6"},it={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},nt={class:"space-y-6"},dt={class:"space-y-6"},xt=D({__name:"index",setup(C){const w=h(!1),m=h(""),_=h(null),g=R();B(async()=>{w.value=Y(),w.value&&await g.loadFromFile()});const c=()=>{_.value&&_.value.refresh()};return(x,n)=>{const p=q,u=fe,y=Pe,s=Xe;return i(),l("div",Ze,[e("main",et,[o(w)?(i(),l("div",ot,[e("header",st,[n[6]||(n[6]=e("div",null,[e("h1",{class:"text-3xl font-bold flex items-center gap-3"},[e("div",{class:"i-mdi-movie-edit text-blue-600"}),$(" Collection Editor ")]),e("p",{class:"text-theme-textmuted mt-1"}," Add and remove movies from collections ")],-1)),I(p,{to:"/admin",class:"px-4 py-2 text-sm bg-theme-surface border border-theme-border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"},{default:U(()=>[...n[5]||(n[5]=[e("div",{class:"i-mdi-arrow-left"},null,-1),$(" Back to Dashboard ",-1)])]),_:1})]),e("section",lt,[I(u,{onSelect:n[0]||(n[0]=b=>m.value=b)})]),o(m)?(i(),l("section",it,[e("div",nt,[n[7]||(n[7]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-database-search text-blue-600"}),$(" Search Library ")],-1)),I(y,{"collection-id":o(m),onAdd:c},null,8,["collection-id"])]),e("div",dt,[n[8]||(n[8]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-playlist-play text-blue-600"}),$(" Collection Movies ")],-1)),I(s,{ref_key:"moviesList",ref:_,"collection-id":o(m)},null,8,["collection-id"])])])):M("",!0)])):(i(),l("div",tt,[n[2]||(n[2]=e("div",{class:"i-mdi-lock text-64px text-gray-300 dark:text-gray-700 mb-4"},null,-1)),n[3]||(n[3]=e("h1",{class:"text-2xl font-bold mb-2"}," Access Denied ",-1)),n[4]||(n[4]=e("p",{class:"text-theme-textmuted"}," The admin interface is only available on localhost. ",-1)),I(p,{to:"/",class:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors"},{default:U(()=>[...n[1]||(n[1]=[$(" Back to Home ",-1)])]),_:1})]))])])}}});export{xt as default};
