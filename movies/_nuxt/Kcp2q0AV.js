import{ag as p,m as d,Y as l,ah as v}from"./DAm6bE2p.js";function q(o){return`${p().app.baseURL}posters/${o}.jpg`}let g=null;function m(){const o=d(null),i=d(!1),u=new Map;return{init:async n=>{if(o.value)return;const s=await v(()=>import("./DO5bXbcd.js"),[],import.meta.url);o.value=new s.default,o.value.onmessage=t=>{const{id:e,error:a}=t.data,c=u.get(e);c&&(a?c.reject(new Error(a)):c.resolve(t.data),u.delete(e))};const r=Math.random().toString(36).substring(7);return new Promise((t,e)=>{u.set(r,{resolve:t,reject:e}),o.value.postMessage({type:"init",id:r,url:n})}).then(()=>{i.value=!0})},query:async(n,s=[])=>{if(!i.value)throw new Error("Database not initialized");const r=Math.random().toString(36).substring(7);return new Promise((t,e)=>{u.set(r,{resolve:a=>t(a.result??[]),reject:e}),o.value.postMessage({type:"exec",id:r,sql:n,params:l(s)})})},extendedQuery:async n=>{if(!i.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{u.set(s,{resolve:a=>r({result:a.result??[],totalCount:a.totalCount}),reject:t});const e={...n};e.params&&(e.params=l(e.params)),o.value.postMessage({type:"query",id:s,...e})})},lightweightQuery:async n=>{if(!i.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{u.set(s,{resolve:a=>r({result:a.result??[],totalCount:a.totalCount}),reject:t});const e={...n};e.params&&(e.params=l(e.params)),o.value.postMessage({type:"query-lightweight",id:s,...e})})},queryByIds:async n=>{if(!i.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{u.set(s,{resolve:e=>r(e.result??[]),reject:t}),o.value.postMessage({type:"query-by-ids",id:s,imdbIds:l(n)})})},getRelatedMovies:async(n,s=8)=>{if(!i.value)throw new Error("Database not initialized");const r=Math.random().toString(36).substring(7);return new Promise((t,e)=>{u.set(r,{resolve:a=>t(a.result??[]),reject:e}),o.value.postMessage({type:"query-related",id:r,imdbId:n,limit:s})})},getCollectionsForMovie:async n=>{if(!i.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{u.set(s,{resolve:e=>r(e.result??[]),reject:t}),o.value.postMessage({type:"query-collections-for-movie",id:s,movieId:n})})},getFilterOptions:async()=>{if(!i.value)throw new Error("Database not initialized");const n=Math.random().toString(36).substring(7);return new Promise((s,r)=>{u.set(n,{resolve:t=>s({genres:t.genres??[],countries:t.countries??[],channels:t.channels??[]}),reject:r}),o.value.postMessage({type:"get-filter-options",id:n})})},isReady:i}}function S(){return g||(g=m()),g}export{q as g,S as u};
