import{_ as ye}from"./D-1NZnAu.js";import{a as ge}from"./DoKBSrbM.js";import{E as me,r as b,n as se,c as a,J as n,o as l,a as t,O as V,t as d,K as S,L as I,z as o,Z as q,ab as ke,a0 as U,B as we,N as xe,e as H,H as he,b as ce,d as j,$ as ee,a6 as te,ac as _e,x as $e,a2 as Se,a3 as Ie,a9 as Ce,ad as Me,ae as Y,af as ue,w as ve,F as pe,P as Ae,u as Te,a8 as be}from"./Ck9VlGs8.js";import{u as De}from"./PQilDTwg.js";import{g as Pe}from"./Bz8FWWbC.js";import{f as Re}from"./DMOTkeJ5.js";import{u as Ve}from"./CrqnEE15.js";var fe=(m=>(m.LOW_QUALITY="low-quality",m.CAM_RIP="cam-rip",m.HARDCODED_SUBS="hardcoded-subs",m.AUDIO_ISSUES="audio-issues",m.VIDEO_ISSUES="video-issues",m.INCOMPLETE="incomplete",m.WRONG_ASPECT_RATIO="wrong-aspect-ratio",m))(fe||{});const Ee={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},Fe={class:"bg-theme-surface rounded-2xl w-full max-w-lg shadow-2xl border border-theme-border overflow-hidden"},Be={class:"p-6 space-y-6"},Ne={class:"p-3 bg-theme-background/50 rounded-lg border border-theme-border"},je={class:"flex items-center gap-2 mb-1"},Oe={class:"font-medium text-theme-text"},Le={class:"text-xs text-theme-textmuted line-clamp-2"},qe={class:"grid grid-cols-2 gap-3"},Ue=["value"],ze={class:"text-sm capitalize"},We={class:"flex gap-3 pt-2"},Ge=["disabled"],Ke={key:0,class:"i-mdi-loading animate-spin"},Ye=me({__name:"AdminSourceQualityDialog",props:{modelValue:{type:Boolean},movie:{},source:{}},emits:["update:modelValue","saved"],setup(m,{emit:D}){const u=m,k=D,w=b(!1),x=b([]);se(()=>u.modelValue,M=>{M&&u.source&&(x.value=[...u.source.qualityMarks||[]])});const A=Object.values(fe),_=()=>{k("update:modelValue",!1)},p=async()=>{if(u.source){w.value=!0;try{(await $fetch("/api/admin/movie/update-source-quality",{method:"POST",body:{movieId:u.movie.imdbId,sourceId:u.source.id,qualityMarks:x.value}})).success&&(k("saved"),_())}catch(M){console.error("Failed to update source quality:",M)}finally{w.value=!1}}},C=async()=>{confirm("Clear all quality marks for this source?")&&(x.value=[],await p())};return(M,r)=>m.modelValue&&m.source?(l(),a("div",Ee,[t("div",Fe,[t("div",{class:"p-6 border-b border-theme-border flex items-center justify-between"},[r[2]||(r[2]=t("div",{class:"flex items-center gap-3"},[t("div",{class:"i-mdi-alert-decagram text-yellow-600 text-2xl"}),t("h3",{class:"text-xl font-bold"},"Mark Source Quality")],-1)),t("button",{class:"p-2 hover:bg-theme-selection rounded-full transition-colors",onClick:_},[...r[1]||(r[1]=[t("div",{class:"i-mdi-close text-xl"},null,-1)])])]),t("div",Be,[t("div",Ne,[t("div",je,[t("div",{class:V([m.source.type==="youtube"?"i-mdi-youtube text-red-600":"i-mdi-bank text-blue-600","text-lg"])},null,2),t("span",Oe,d(m.source.type),1)]),t("p",Le,d(m.source.title),1)]),t("div",null,[r[3]||(r[3]=t("h4",{class:"text-sm font-bold text-theme-text mb-3 uppercase tracking-wider"}," Quality Marks ",-1)),t("div",qe,[(l(!0),a(S,null,I(o(A),y=>(l(),a("label",{key:y,class:V(["flex items-center gap-2 p-2 rounded-lg border border-theme-border hover:bg-theme-selection cursor-pointer transition-colors",{"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-900/50":o(x).includes(y)}])},[q(t("input",{"onUpdate:modelValue":r[0]||(r[0]=h=>U(x)?x.value=h:null),type:"checkbox",value:y,class:"rounded text-yellow-600 focus:ring-yellow-500"},null,8,Ue),[[ke,o(x)]]),t("span",ze,d(y.replace(/-/g," ")),1)],2))),128))])]),t("div",We,[t("button",{class:"flex-1 px-4 py-2 border border-theme-border rounded-lg font-bold hover:bg-theme-selection transition-colors",onClick:_}," Cancel "),t("button",{class:"flex-1 px-4 py-2 bg-yellow-600 text-white rounded-lg font-bold hover:bg-yellow-500 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",disabled:o(w),onClick:p},[o(w)?(l(),a("div",Ke)):n("",!0),t("span",null,d(o(w)?"Saving...":"Save Quality"),1)],8,Ge)]),m.source.qualityMarks?.length?(l(),a("button",{key:0,class:"w-full mt-2 text-xs text-red-500 hover:text-red-600 underline font-medium",onClick:C}," Clear All Quality Marks ")):n("",!0)])])])):n("",!0)}}),He=Object.assign(Ye,{__name:"AdminSourceQualityDialog"});function Qe(m,D=2){if(m==null)return"N/A";if(m===0)return"0 Bytes";const u=1024,k=D<0?0:D,w=["Bytes","KB","MB","GB","TB","PB"],x=Math.floor(Math.log(m)/Math.log(u));return`${parseFloat((m/Math.pow(u,x)).toFixed(k))} ${w[x]}`}function Je(m){return m.replace(/\(.*?\)/g,"").replace(/\[.*?\]/g,"").replace(/["'“”‘’]/g,"").replace(/[*]/g,"").replace(/\s+/g," ").trim()}const Xe={key:0,class:"mt-8 p-6 bg-theme-surface border-2 border-theme-border rounded-xl text-theme-text"},Ze={class:"flex items-center gap-2 mb-4 text-theme-text"},et={key:0,class:"flex items-center gap-1 text-xs font-bold text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded"},tt={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},st={class:"space-y-6"},ot={class:"flex items-center gap-2 mb-1"},lt={class:"font-medium text-theme-text"},at=["onClick"],it=["onClick"],rt={key:0,class:"mb-2 flex flex-wrap gap-1"},dt={key:1,class:"mb-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded text-xs"},nt={key:0,class:"flex items-start gap-1.5"},ct={class:"text-theme-textmuted ml-1"},mt={class:"text-theme-textmuted ml-1"},ut={key:1,class:"flex items-start gap-1.5"},vt={class:"text-theme-textmuted ml-1"},pt={class:"text-theme-textmuted ml-1"},bt={key:2,class:"mb-2 p-2 bg-theme-background/50 rounded text-xs"},xt={class:"text-theme-textmuted ml-1"},ht={key:3,class:"mb-2 p-2 bg-theme-background/50 rounded text-xs"},ft={class:"text-theme-textmuted ml-1"},yt={key:4,class:"text-xs text-theme-textmuted line-clamp-4 whitespace-pre-wrap"},gt={key:5,class:"text-xs italic text-theme-textmuted"},kt={class:"mt-3 pt-2 border-t border-theme-border"},wt={class:"flex gap-1 mb-2"},_t=["onUpdate:modelValue","onKeyup"],$t=["onClick"],St={class:"flex flex-wrap gap-2"},It=["onClick"],Ct=["onClick"],Mt={class:"space-y-4"},At={class:"flex gap-2"},Tt=["disabled"],Dt={key:0,class:"i-mdi-loading animate-spin"},Pt={key:1},Rt={class:"pt-2"},Vt={class:"flex gap-2"},Et=["disabled"],Ft={key:0,class:"text-red-500 text-sm"},Bt={class:"pt-4 border-t border-theme-border flex flex-wrap gap-4"},Nt=["disabled"],jt=["disabled"],Ot={class:"pt-6 border-t border-theme-border"},Lt={class:"flex flex-wrap gap-2 mb-4"},qt={class:"font-medium"},Ut=["onClick"],zt={key:0,class:"text-sm text-theme-textmuted italic py-1.5"},Wt={class:"flex gap-2"},Gt=["value"],Kt=["disabled"],Yt={key:0,class:"i-mdi-loading animate-spin"},Ht={key:1},Qt={key:0,class:"space-y-2 max-h-[400px] overflow-y-auto pr-2 scrollbar-thin"},Jt=["src"],Xt={class:"flex-1 min-w-0"},Zt={class:"font-bold text-sm truncate text-theme-text"},es={class:"text-xs text-theme-textmuted dark:text-theme-textmuted"},ts={class:"text-[10px] font-mono text-theme-textmuted"},ss=["disabled","onClick"],os={key:1,class:"h-[200px] flex flex-col items-center justify-center text-theme-textmuted border-2 border-dashed border-theme-border rounded-lg"},ls={key:2,id:"google-results",class:"mt-8 pt-6 border-t border-theme-border"},as={class:"space-y-2 max-h-[400px] overflow-y-auto pr-2 scrollbar-thin"},is={class:"flex-1 min-w-0"},rs={class:"font-bold text-sm truncate text-theme-text"},ds={class:"text-xs text-theme-textmuted dark:text-theme-textmuted"},ns={class:"text-[10px] font-mono text-theme-textmuted"},cs=["disabled","onClick"],ms=me({__name:"AdminCurationPanel",props:{movie:{}},emits:["updated"],setup(m,{emit:D}){const u=m,k=D,w=b(!1),x=b(""),A=b(""),_=b(""),p=b(!1),C=b(!1),M=b(null),r=b([]),y=b([]),h=b(""),$=we({}),P=()=>{!u.movie.sources||u.movie.sources.length===0||u.movie.sources.forEach(s=>{const e=s.title||u.movie.title;$[s.id]=Je(e)})},R=De(),{collections:z}=xe(R),{getCollectionsForMovie:T,loadCollections:Q,addMovieToCollection:oe,removeMovieFromCollection:J}=R,g=b(""),E=b(!1),F=b([]),le=H(()=>Array.from(z.value.values()).filter(s=>!s.movieIds.includes(u.movie.imdbId)));he(async()=>{w.value=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",x.value=u.movie.title,A.value=u.movie.year?.toString()||"",P(),z.value.size===0&&Q(),F.value=await T(u.movie.imdbId)}),se(()=>u.movie.imdbId,async s=>{s&&(F.value=await T(s))});const ae=async()=>{if(g.value){E.value=!0;try{await oe(g.value,u.movie.imdbId)&&(g.value="",F.value=await T(u.movie.imdbId))}finally{E.value=!1}}},ie=async s=>{if(confirm("Remove movie from this collection?")){E.value=!0;try{await J(s,u.movie.imdbId),F.value=await T(u.movie.imdbId)}finally{E.value=!1}}};se(()=>u.movie.imdbId,()=>{x.value=u.movie.title,A.value=u.movie.year?.toString()||"",_.value="",r.value=[],h.value="",P()});const W=async()=>{const s=x.value.trim(),e=A.value.trim();if(s){p.value=!0,h.value="",r.value=[];try{const v=await $fetch("/api/admin/omdb/search",{query:{s,y:e}});v.Response==="True"?r.value=v.Search||[]:h.value=v.Error||"No results found"}catch{h.value="Failed to search OMDB"}finally{p.value=!1}}},O=async s=>{if(s){p.value=!0,h.value="",y.value=[];try{const e=await $fetch("/api/admin/google/search",{query:{q:`${s} site:imdb.com`}});e.Response==="True"?(y.value=e.Search||[],$e(()=>{document.getElementById("google-results")?.scrollIntoView({behavior:"smooth"})})):h.value=e.Error||"No Google results found"}catch{h.value="Failed to search Google"}finally{p.value=!1}}},B=s=>{if(!s.description)return;const e=s.description.substring(0,100).replace(/\n/g," ");O(e)},X=s=>{const e=$[s.id]||"",v=s.description?s.description.substring(0,50).replace(/\n/g," "):"";O(`${e} ${v}`)},re=async s=>{if(confirm("Are you sure you want to remove this source? If this is the last source, the movie entry will be deleted."))try{p.value=!0;const e=await $fetch("/api/admin/movie/remove-source",{method:"POST",body:{movieId:u.movie.imdbId,sourceId:s}});e.success&&(e.deleted?k("updated",""):e.movieId&&k("updated",e.movieId))}catch(e){console.error("Failed to remove source:",e)}finally{p.value=!1}},G=async()=>{const s=_.value.trim();if(!s)return;const e=s.match(/tt\d{7,}/);if(!e){h.value="Invalid IMDB ID or URL (should contain tt followed by at least 7 digits)";return}const v=e[0];await L(v)},L=async s=>{try{p.value=!0;const e=await $fetch("/api/admin/omdb/details",{query:{i:s}});if(e.Response==="True"){const v=await $fetch("/api/admin/movie/update",{method:"POST",body:{movieId:u.movie.imdbId,metadata:e}});v.success&&k("updated",v.movieId)}else console.error("Failed to get movie details:",e.Error)}catch(e){console.error("Failed to update movie:",e)}finally{p.value=!1}},de=async()=>{if(confirm("Are you sure you want to remove metadata? This will reset the movie to an unmatched state."))try{p.value=!0;const s=await $fetch("/api/admin/movie/update",{method:"POST",body:{movieId:u.movie.imdbId,removeMetadata:!0}});s.success&&k("updated",s.movieId)}catch(s){console.error("Failed to remove metadata:",s)}finally{p.value=!1}},Z=async()=>{try{p.value=!0;const s=await $fetch("/api/admin/movie/update",{method:"POST",body:{movieId:u.movie.imdbId,verified:!0}});s.success&&k("updated",s.movieId)}catch(s){console.error("Failed to verify movie:",s)}finally{p.value=!1}},ne=s=>{M.value=s,C.value=!0};return(s,e)=>{const v=He;return o(w)&&m.movie.sources&&m.movie.sources.length>0?(l(),a("div",Xe,[t("div",Ze,[e[7]||(e[7]=t("div",{class:"i-mdi-shield-edit text-2xl"},null,-1)),e[8]||(e[8]=t("h2",{class:"text-xl font-bold"},"Admin Curation",-1)),m.movie.verified?(l(),a("div",et,[...e[6]||(e[6]=[t("div",{class:"i-mdi-check-decagram"},null,-1),j(" Verified ",-1)])])):n("",!0),e[9]||(e[9]=t("span",{class:"ml-auto text-xs font-mono bg-theme-selection px-2 py-1 rounded"}," localhost only ",-1))]),t("div",tt,[t("div",st,[t("div",null,[e[19]||(e[19]=t("h3",{class:"text-sm font-semibold uppercase tracking-wider text-theme-textmuted mb-2"}," Source Info ",-1)),(l(!0),a(S,null,I(m.movie.sources,i=>(l(),a("div",{key:i.id,class:"bg-theme-surface/50 p-3 rounded border border-theme-border mb-2"},[t("div",ot,[t("div",{class:V([i.type==="youtube"?"i-mdi-youtube text-red-600":"i-mdi-bank text-blue-600","text-lg"])},null,2),t("span",lt,d(i.type),1),t("button",{class:"ml-auto p-1 text-theme-textmuted hover:text-yellow-500 transition-colors",title:"Mark source quality",onClick:f=>ne(i)},[...e[10]||(e[10]=[t("div",{class:"i-mdi-alert-decagram"},null,-1)])],8,at),t("button",{class:"p-1 text-theme-textmuted hover:text-red-500 transition-colors",title:"Remove source",onClick:f=>re(i.id)},[...e[11]||(e[11]=[t("div",{class:"i-mdi-close"},null,-1)])],8,it)]),i.qualityMarks?.length?(l(),a("div",rt,[(l(!0),a(S,null,I(i.qualityMarks,f=>(l(),a("span",{key:f,class:"text-[10px] font-bold text-yellow-700 dark:text-yellow-300 bg-yellow-100 dark:bg-yellow-900/30 px-1.5 py-0.5 rounded border border-yellow-200 dark:border-yellow-800 uppercase tracking-tighter"},d(f),1))),128))])):n("",!0),i.type==="youtube"&&i.regionRestriction?(l(),a("div",dt,[e[16]||(e[16]=t("div",{class:"flex items-center gap-1.5 mb-1"},[t("div",{class:"i-mdi-earth-off text-yellow-600 dark:text-yellow-400"}),t("span",{class:"font-semibold text-yellow-700 dark:text-yellow-300"},"Region Restrictions")],-1)),i.regionRestriction.blocked?(l(),a("div",nt,[e[13]||(e[13]=t("div",{class:"i-mdi-close-circle text-red-600 dark:text-red-400 mt-0.5"},null,-1)),t("div",null,[e[12]||(e[12]=t("span",{class:"font-medium text-red-700 dark:text-red-300"},"Blocked in:",-1)),t("span",ct,d(i.regionRestriction.blocked.join(", ")),1),t("span",mt,"("+d(i.regionRestriction.blocked.length)+" regions)",1)])])):n("",!0),i.regionRestriction.allowed?(l(),a("div",ut,[e[15]||(e[15]=t("div",{class:"i-mdi-check-circle text-green-600 dark:text-green-400 mt-0.5"},null,-1)),t("div",null,[e[14]||(e[14]=t("span",{class:"font-medium text-green-700 dark:text-green-300"},"Only allowed in:",-1)),t("span",vt,d(i.regionRestriction.allowed.join(", ")),1),t("span",pt,"("+d(i.regionRestriction.allowed.length)+" regions)",1)])])):n("",!0)])):n("",!0),i.title?(l(),a("div",bt,[e[17]||(e[17]=t("span",{class:"font-medium text-theme-text"},"Original title:",-1)),t("span",xt,d(i.title),1)])):n("",!0),i.fileSize?(l(),a("div",ht,[e[18]||(e[18]=t("span",{class:"font-medium text-theme-text"},"File size:",-1)),t("span",ft,d(("formatFileSize"in s?s.formatFileSize:o(Qe))(i.fileSize)),1)])):n("",!0),i.description?(l(),a("p",yt,d(i.description.length>1e3?i.description.substring(0,1e3)+"...":i.description),1)):(l(),a("p",gt," No description available in database ")),t("div",kt,[t("div",wt,[q(t("input",{"onUpdate:modelValue":f=>o($)[i.id]=f,type:"text",class:"flex-1 px-2 py-1 text-[10px] rounded border border-theme-border bg-theme-surface text-theme-text",placeholder:"Search query...",onKeyup:te(f=>O(o($)[i.id]||""),["enter"])},null,40,_t),[[ee,o($)[i.id]]]),t("button",{class:"px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white text-[10px] font-bold rounded transition-colors",onClick:f=>O(o($)[i.id]||"")}," Search ",8,$t)]),t("div",St,[i.description?(l(),a("button",{key:0,class:"px-2 py-1 bg-theme-selection hover:bg-theme-selection/80 text-theme-text text-[10px] font-bold rounded transition-colors",onClick:f=>B(i)}," Search Desc ",8,It)):n("",!0),i.title&&i.description?(l(),a("button",{key:1,class:"px-2 py-1 bg-theme-selection hover:bg-theme-selection/80 text-theme-text text-[10px] font-bold rounded transition-colors",onClick:f=>X(i)}," Search Both ",8,Ct)):n("",!0)])])]))),128))]),t("div",Mt,[e[21]||(e[21]=t("h3",{class:"text-sm font-semibold uppercase tracking-wider text-theme-textmuted"}," Search OMDB ",-1)),t("div",At,[q(t("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>U(x)?x.value=i:null),type:"text",placeholder:"Movie Title",class:"flex-1 px-3 py-2 rounded border border-theme-border bg-theme-surface/50 text-theme-text text-sm",onKeyup:te(W,["enter"])},null,544),[[ee,o(x),void 0,{trim:!0}]]),q(t("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>U(A)?A.value=i:null),type:"text",placeholder:"Year",class:"w-20 px-3 py-2 rounded border border-theme-border bg-theme-surface/50 text-theme-text text-sm",onKeyup:te(W,["enter"])},null,544),[[ee,o(A),void 0,{trim:!0}]]),t("button",{class:"px-4 py-2 bg-yellow-600 hover:bg-yellow-500 text-white rounded font-bold transition-colors disabled:opacity-50",disabled:o(p),onClick:W},[o(p)?(l(),a("div",Dt)):(l(),a("span",Pt,"Search"))],8,Tt)]),t("div",Rt,[e[20]||(e[20]=t("div",{class:"flex items-center gap-2 mb-2"},[t("h3",{class:"text-sm font-semibold uppercase tracking-wider text-theme-textmuted"}," Direct IMDB ID ")],-1)),t("div",Vt,[q(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>U(_)?_.value=i:null),type:"text",placeholder:"tt1234567",class:"flex-1 px-3 py-2 rounded border border-theme-border bg-theme-surface/50 text-theme-text text-sm font-mono",onKeyup:te(G,["enter"])},null,544),[[ee,o(_),void 0,{trim:!0}]]),t("button",{class:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded font-bold transition-colors disabled:opacity-50",disabled:o(p)||!o(_),onClick:G}," Fetch ",8,Et)])]),o(h)?(l(),a("div",Ft,d(o(h)),1)):n("",!0)]),t("div",Bt,[m.movie.verified?n("",!0):(l(),a("button",{key:0,class:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded transition-colors text-sm font-bold disabled:opacity-50",disabled:o(p),onClick:Z},[...e[22]||(e[22]=[t("div",{class:"i-mdi-check-decagram text-lg"},null,-1),j(" Mark as Verified ",-1)])],8,Nt)),t("button",{class:"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors text-sm font-bold disabled:opacity-50",disabled:o(p),onClick:de},[...e[23]||(e[23]=[t("div",{class:"i-mdi-delete-sweep text-lg"},null,-1),j(" Remove All Metadata ",-1)])],8,jt)]),t("div",Ot,[e[27]||(e[27]=t("h3",{class:"text-sm font-semibold uppercase tracking-wider text-theme-textmuted mb-3"}," Collections ",-1)),t("div",Lt,[(l(!0),a(S,null,I(o(F),i=>(l(),a("div",{key:i.id,class:"flex items-center gap-2 px-3 py-1.5 bg-theme-primary/10 border border-theme-primary/30 rounded-lg text-sm"},[e[25]||(e[25]=t("div",{class:"i-mdi:movie-roll text-theme-primary"},null,-1)),t("span",qt,d(i.name),1),t("button",{class:"p-0.5 hover:bg-red-100 dark:hover:bg-red-900/30 rounded text-red-500 transition-colors",title:"Remove from collection",onClick:f=>ie(i.id)},[...e[24]||(e[24]=[t("div",{class:"i-mdi-close text-xs"},null,-1)])],8,Ut)]))),128)),o(F).length===0?(l(),a("div",zt," Not in any collections ")):n("",!0)]),t("div",Wt,[q(t("select",{"onUpdate:modelValue":e[3]||(e[3]=i=>U(g)?g.value=i:null),class:"flex-1 px-3 py-2 rounded border border-theme-border bg-theme-surface/50 text-theme-text text-sm"},[e[26]||(e[26]=t("option",{value:"",disabled:""},"Add to collection...",-1)),(l(!0),a(S,null,I(o(le),i=>(l(),a("option",{key:i.id,value:i.id},d(i.name),9,Gt))),128))],512),[[_e,o(g)]]),t("button",{class:"px-4 py-2 bg-theme-primary hover:bg-theme-primary/80 text-white rounded font-bold transition-colors disabled:opacity-50",disabled:!o(g)||o(E),onClick:ae},[o(E)?(l(),a("div",Yt)):(l(),a("span",Ht,"Add"))],8,Kt)])])]),t("div",null,[e[31]||(e[31]=t("h3",{class:"text-sm font-semibold uppercase tracking-wider text-theme-textmuted mb-2"}," Search Results ",-1)),o(r).length>0?(l(),a("div",Qt,[(l(!0),a(S,null,I(o(r),i=>(l(),a("div",{key:i.imdbID,class:"flex gap-3 p-2 bg-theme-surface/50 rounded border border-theme-border hover:border-yellow-400 dark:hover:border-gray-500 transition-colors group"},[t("img",{src:i.Poster!=="N/A"?i.Poster:"/favicon.ico",class:"w-12 h-18 object-cover rounded",alt:"Poster"},null,8,Jt),t("div",Xt,[t("h4",Zt,d(i.Title),1),t("p",es,d(i.Year)+" • "+d(i.Type),1),t("p",ts,d(i.imdbID),1)]),t("button",{class:"self-center px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-xs rounded font-bold opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-50",disabled:o(p),onClick:f=>L(i.imdbID)}," Select ",8,ss)]))),128))])):o(p)?n("",!0):(l(),a("div",os,[...e[28]||(e[28]=[t("div",{class:"i-mdi-magnify text-4xl mb-2"},null,-1),t("p",{class:"text-sm"},"Search results will appear here",-1)])])),o(y).length>0?(l(),a("div",ls,[e[30]||(e[30]=t("div",{class:"flex items-center gap-2 mb-3"},[t("div",{class:"i-mdi-google text-blue-600"}),t("h3",{class:"text-sm font-semibold uppercase tracking-wider text-theme-textmuted"}," Google Results (IMDb) ")],-1)),t("div",as,[(l(!0),a(S,null,I(o(y),i=>(l(),a("div",{key:i.imdbID,class:"flex gap-3 p-2 bg-theme-surface/50 rounded border border-theme-border hover:border-blue-400 dark:hover:border-gray-500 transition-colors group"},[e[29]||(e[29]=t("div",{class:"w-12 h-18 bg-theme-selection flex items-center justify-center rounded"},[t("div",{class:"i-mdi-movie-open text-2xl text-theme-textmuted"})],-1)),t("div",is,[t("h4",rs,d(i.Title),1),t("p",ds,d(i.Year)+" • "+d(i.Type),1),t("p",ns,d(i.imdbID),1)]),t("button",{class:"self-center px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-xs rounded font-bold opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-50",disabled:o(p),onClick:f=>L(i.imdbID)}," Select ",8,cs)]))),128))])])):n("",!0)])]),ce(v,{modelValue:o(C),"onUpdate:modelValue":e[4]||(e[4]=i=>U(C)?C.value=i:null),movie:m.movie,source:o(M),onSaved:e[5]||(e[5]=i=>k("updated",m.movie.imdbId))},null,8,["modelValue","movie","source"])])):n("",!0)}}}),us=Object.assign(ms,{__name:"AdminCurationPanel"}),vs={class:"max-w-7xl mx-auto px-4 py-8 md:ml-16"},ps={key:0,class:"space-y-8"},bs={key:1,class:"text-center py-12"},xs={class:"text-gray-600 dark:text-gray-400 mb-6"},hs={key:2,class:"space-y-8 text-theme-text"},fs={class:"flex flex-col md:flex-row gap-8"},ys={class:"flex-shrink-0"},gs={class:"w-full md:w-80 aspect-[2/3] bg-theme-selection rounded-lg overflow-hidden border border-theme-border/50"},ks=["src","alt"],ws={key:1,class:"w-full h-full flex items-center justify-center text-theme-textmuted"},_s={class:"flex-1"},$s={class:"text-4xl font-bold mb-4"},Ss={class:"flex flex-wrap gap-4 text-sm mb-6"},Is={key:0,class:"px-3 py-1 rounded-full bg-theme-surface border border-theme-border/50"},Cs={key:1,class:"px-3 py-1 rounded-full bg-theme-surface border border-theme-border/50"},Ms={key:2,class:"px-3 py-1 rounded-full bg-theme-surface border border-theme-border/50"},As={key:0,class:"flex items-center gap-2 mb-6"},Ts={class:"text-2xl font-bold"},Ds={key:0,class:"text-sm text-theme-textmuted"},Ps={class:"flex flex-wrap gap-3 mb-6"},Rs={key:1,class:"mb-6"},Vs={class:"flex flex-wrap gap-2"},Es={key:2,class:"mb-6"},Fs={class:"flex flex-wrap gap-2"},Bs={key:3,class:"mb-6"},Ns={class:"relative"},js={class:"space-y-3"},Os={key:0},Ls={class:"text-theme-text"},qs={key:1},Us={class:"text-theme-text"},zs={key:2},Ws={class:"text-theme-text"},Gs={key:0,class:"mb-4"},Ks={class:"flex flex-wrap gap-2"},Ys={class:"flex flex-col gap-1"},Hs=["onClick"],Qs={class:"flex items-center gap-2"},Js={key:0,class:"text-xs opacity-75"},Xs={key:0,class:"flex flex-wrap gap-1"},Zs=["href","title"],eo={key:1,class:"bg-black rounded-lg overflow-hidden"},to={key:0,class:"aspect-video"},so=["src"],oo={key:1,class:"aspect-video"},lo=["src"],ao={key:2,class:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-8 border-t border-theme-border/50"},io={key:0},ro={class:"text-theme-text"},no={key:1},co={class:"text-theme-text"},mo={key:2},uo={class:"text-theme-text"},vo={key:3},po=["href"],bo={key:3,class:"pt-8 border-t border-theme-border/50"},xo={class:"relative"},ho={class:"flex gap-4 overflow-x-auto pb-4 snap-x snap-mandatory scrollbar-thin"},fo={class:"border-t border-theme-border/50 mt-12"},yo={class:"max-w-7xl mx-auto px-4 py-6 text-center text-sm text-theme-textmuted"},go={class:"flex items-center justify-between mb-4"},Mo=me({__name:"[id]",setup(m){const D=Ve(),{currentMovieList:u,likedMovieIds:k}=xe(D),{getMovieById:w,getRelatedMovies:x,loadFromFile:A,toggleLike:_}=D,{showToast:p}=Se(),C=Ie(),{y:M}=Ce(),r=b(null),y=b([]),h=b(!0),$=b(null),P=b(0),R=b(!1),z=H(()=>r.value?.collections||[]),T=H(()=>!r.value||!r.value.sources?null:r.value.sources[P.value]||r.value.sources[0]||null),Q=H(()=>r.value?k.value.includes(r.value.imdbId):!1),oe=async s=>{y.value=[];try{y.value=await x(s,8)}catch{y.value=[]}},J=async s=>{h.value=!0,$.value=null,P.value=0,y.value=[],R.value=!1;try{const e=await w(s);if(!e){$.value=`Movie with ID "${s}" not found.`,h.value=!1;return}r.value=e,G(e),oe(s),h.value=!1}catch(e){console.error("Failed to load movie:",e),$.value=`Failed to load movie data. ${e instanceof Error?e.message:"Please try again."}`,h.value=!1}};he(async()=>{M.value=0;const s=C.params.id;await J(s)}),se(()=>C.params.id,async s=>{s&&(M.value=0,await J(s))});const g=b(!1),E=Me(),{Escape:F,Space:le,Enter:ae,ArrowLeft:ie,ArrowRight:W,Shift_Slash:O}=E,B=H(()=>{const s=document.activeElement;return s?.tagName==="INPUT"||s?.tagName==="TEXTAREA"});Y(()=>F?.value&&!B.value,()=>{be("/")}),Y(()=>(le?.value||ae?.value)&&!B.value,()=>{L()}),Y(()=>ie?.value&&!B.value,()=>{X("prev")}),Y(()=>W?.value&&!B.value,()=>{X("next")}),Y(()=>O?.value&&!B.value,()=>{g.value=!g.value});const X=s=>{const e=C.params.id;if(!e)return;const v=u.value,i=v.findIndex(K=>K.imdbId===e);if(i===-1)return;const c=i+(s==="prev"?-1:1);if(c<0||c>=v.length)return;const N=v[c];N&&be(`/movie/${N.imdbId}`)},re=async s=>{if(await A(),s!==r.value?.imdbId){const v=`/movie/${s}`;window.history.replaceState({},"",v),C.params.id=s}const e=await w(s);e&&(r.value=e,G(e))},G=s=>{const e=s.title+(s.year?` (${s.year})`:""),v=s.metadata?.Plot||`Watch ${s.title} for free on Movies Deluxe`,i=s.metadata?.Poster||"/favicon.ico",f=`https://movies-deluxe.app/movie/${s.imdbId}`;Te({title:e,meta:[{name:"description",content:v},{property:"og:type",content:"video.movie"},{property:"og:title",content:e},{property:"og:description",content:v},{property:"og:image",content:i},{property:"og:url",content:f},{property:"og:site_name",content:"Movies Deluxe"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:title",content:e},{name:"twitter:description",content:v},{name:"twitter:image",content:i},...s.metadata?.Director?[{property:"video:director",content:s.metadata.Director}]:[],...s.metadata?.Actors?[{property:"video:actor",content:s.metadata.Actors}]:[],...s.year?[{property:"video:release_date",content:s.year.toString()}]:[]],script:[{type:"application/ld+json",textContent:JSON.stringify({"@context":"https://schema.org","@type":"Movie",name:s.title,...s.year&&{datePublished:s.year.toString()},...s.metadata?.Plot&&{description:s.metadata.Plot},...s.metadata?.Poster&&{image:i},...s.metadata?.Director&&{director:{"@type":"Person",name:s.metadata.Director}},...s.metadata?.Actors&&{actor:s.metadata.Actors.split(",").map(c=>({"@type":"Person",name:c.trim()}))},...s.metadata?.Genre&&{genre:s.metadata.Genre.split(",").map(c=>c.trim())},...s.metadata?.imdbRating&&{aggregateRating:{"@type":"AggregateRating",ratingValue:s.metadata.imdbRating,...s.metadata.imdbVotes&&{ratingCount:String(s.metadata.imdbVotes)}}},...s.imdbId?.startsWith("tt")&&{sameAs:`https://www.imdb.com/title/${s.imdbId}/`}})}]})},L=()=>{r.value&&_(r.value.imdbId)},de=async()=>{if(!r.value)return;const s=r.value.title+(r.value.year?` (${r.value.year})`:""),e=r.value.metadata?.Plot||`Watch ${r.value.title} for free on Movies Deluxe`,v=`${window.location.origin}/movie/${r.value.imdbId}`;if(!navigator.share){await Z(v);return}try{await navigator.share({title:s,text:e,url:v}),p("Shared successfully!")}catch(i){i.name!=="AbortError"&&await Z(v)}},Z=async s=>{try{await navigator.clipboard.writeText(s),p("Link copied to clipboard!")}catch{p("Failed to copy link","error")}},ne=s=>{const e=s.target;e.style.display="none"};return(s,e)=>{const v=ye,i=ge,f=us;return l(),a("div",null,[t("main",vs,[o(h)?(l(),a("div",ps,[...e[5]||(e[5]=[ue('<div class="flex flex-col md:flex-row gap-8"><div class="flex-shrink-0"><div class="w-full md:w-80 aspect-[2/3] skeleton rounded-lg"></div></div><div class="flex-1 space-y-6"><div class="h-10 skeleton rounded-lg w-3/4"></div><div class="flex gap-4"><div class="h-8 w-20 skeleton rounded-full"></div><div class="h-8 w-16 skeleton rounded-full"></div><div class="h-8 w-24 skeleton rounded-full"></div></div><div class="flex items-center gap-2"><div class="h-8 w-8 skeleton rounded-full"></div><div class="h-8 w-16 skeleton rounded-md"></div></div><div class="flex gap-3"><div class="h-10 w-40 skeleton rounded-full"></div><div class="h-10 w-28 skeleton rounded-full"></div></div><div class="space-y-2"><div class="h-4 w-16 skeleton rounded-md"></div><div class="flex gap-2"><div class="h-8 w-20 skeleton rounded-full"></div><div class="h-8 w-24 skeleton rounded-full"></div></div></div><div class="space-y-2"><div class="h-4 w-12 skeleton rounded-md"></div><div class="space-y-2"><div class="h-4 skeleton rounded-md"></div><div class="h-4 skeleton rounded-md"></div><div class="h-4 skeleton rounded-md w-3/4"></div></div></div></div></div><div class="aspect-video skeleton rounded-lg"></div>',2)])])):o($)?(l(),a("div",bs,[e[7]||(e[7]=t("div",{class:"i-mdi-alert-circle text-6xl text-red-500 mb-4"},null,-1)),e[8]||(e[8]=t("h2",{class:"text-2xl font-bold mb-2"},"Movie Not Found",-1)),t("p",xs,d(o($)),1),ce(v,{to:"/",class:"inline-block px-6 py-3 rounded-full bg-gray-700 dark:bg-yellow-600 text-white hover:bg-gray-600 dark:hover:bg-yellow-500 transition-colors"},{default:ve(()=>[...e[6]||(e[6]=[j(" Back to Movies ",-1)])]),_:1})])):o(r)?(l(),a("div",hs,[t("div",fs,[t("div",ys,[t("div",gs,[o(r).imdbId?.startsWith("tt")?(l(),a("img",{key:0,src:("getPosterPath"in s?s.getPosterPath:o(Pe))(o(r).imdbId),alt:o(r).title,class:"w-full h-full object-cover object-center",onError:ne},null,40,ks)):(l(),a("div",ws,[...e[9]||(e[9]=[t("div",{class:"i-mdi-movie text-8xl"},null,-1)])]))])]),t("div",_s,[t("h1",$s,d(o(r).title),1),t("div",Ss,[o(r).year?(l(),a("span",Is,d(o(r).year),1)):n("",!0),o(r).metadata?.Rated?(l(),a("span",Cs,d(o(r).metadata.Rated),1)):n("",!0),o(r).metadata?.Runtime?(l(),a("span",Ms,d(o(r).metadata.Runtime),1)):n("",!0)]),o(r).metadata?.imdbRating?(l(),a("div",As,[e[10]||(e[10]=t("div",{class:"i-mdi-star text-theme-accent text-2xl"},null,-1)),t("span",Ts,d(o(r).metadata.imdbRating),1),e[11]||(e[11]=t("span",{class:"text-theme-textmuted"},"/ 10",-1)),o(r).metadata?.imdbVotes?(l(),a("span",Ds," ("+d(("formatVotes"in s?s.formatVotes:o(Re))(o(r).metadata.imdbVotes))+") ",1)):n("",!0)])):n("",!0),t("div",Ps,[t("button",{class:"btn flex items-center gap-2",onClick:L},[t("div",{class:V(["i-mdi-heart text-lg",{"text-theme-accent":o(Q)}])},null,2),j(" "+d(o(Q)?"Liked":"Like"),1)]),t("button",{class:"btn flex items-center gap-2",onClick:de},[...e[12]||(e[12]=[t("div",{class:"i-mdi-share-variant text-lg"},null,-1),j(" Share ",-1)])])]),o(r).metadata?.Genre?(l(),a("div",Rs,[e[13]||(e[13]=t("h3",{class:"movie-label"},"Genre",-1)),t("div",Vs,[(l(!0),a(S,null,I(o(r).metadata.Genre.split(", "),c=>(l(),a("span",{key:c,class:"px-3 py-1 rounded-full bg-theme-surface border border-theme-border/50 text-sm"},d(c),1))),128))])])):n("",!0),o(z).length>0?(l(),a("div",Es,[e[15]||(e[15]=t("h3",{class:"movie-label"},"Part of Collection",-1)),t("div",Fs,[(l(!0),a(S,null,I(o(z),c=>(l(),pe(v,{key:c.id,to:`/collections/${c.id}`,class:"px-3 py-1 rounded-full bg-theme-primary/10 border border-theme-primary/20 text-theme-primary text-sm hover:bg-theme-primary/20 transition-colors flex items-center gap-1.5"},{default:ve(()=>[e[14]||(e[14]=t("div",{class:"i-mdi:movie-roll text-base"},null,-1)),j(" "+d(c.name),1)]),_:2},1032,["to"]))),128))])])):n("",!0),o(r).metadata?.Plot?(l(),a("div",Bs,[e[16]||(e[16]=t("h3",{class:"movie-label"},"Plot",-1)),t("div",Ns,[t("p",{class:V(["text-theme-text leading-relaxed transition-all duration-300",{"line-clamp-3":!o(R)}])},d(o(r).metadata.Plot),3),o(r).metadata.Plot.length>150?(l(),a("button",{key:0,class:"mt-1 text-sm font-medium text-theme-primary hover:text-theme-accent transition-colors flex items-center gap-1",onClick:e[0]||(e[0]=c=>R.value=!o(R))},[t("span",null,d(o(R)?"Show less":"Show more"),1),t("div",{class:V(["transition-transform duration-300",o(R)?"i-mdi-chevron-up":"i-mdi-chevron-down"])},null,2)])):n("",!0)])])):n("",!0),t("div",js,[o(r).metadata?.Director?(l(),a("div",Os,[e[17]||(e[17]=t("span",{class:"movie-label block !mb-1"},"Director",-1)),t("span",Ls,d(o(r).metadata.Director),1)])):n("",!0),o(r).metadata?.Writer?(l(),a("div",qs,[e[18]||(e[18]=t("span",{class:"movie-label block !mb-1"},"Writer",-1)),t("span",Us,d(o(r).metadata.Writer),1)])):n("",!0),o(r).metadata?.Actors?(l(),a("div",zs,[e[19]||(e[19]=t("span",{class:"movie-label block !mb-1"},"Actors",-1)),t("span",Ws,d(o(r).metadata.Actors),1)])):n("",!0)])])]),o(r).sources&&o(r).sources.length>0?(l(),a("div",Gs,[e[21]||(e[21]=t("h3",{class:"movie-label"},"Select Source",-1)),t("div",Ks,[(l(!0),a(S,null,I(o(r).sources,(c,N)=>(l(),a("div",{key:c.id,class:"flex items-center gap-1"},[t("div",Ys,[t("button",{class:V(["px-4 py-2 rounded-lg text-sm font-medium transition-colors border",{"bg-theme-primary border-theme-primary text-white":o(P)===N,"bg-theme-surface border-theme-border/50 text-theme-text hover:bg-theme-selection":o(P)!==N}]),onClick:K=>P.value=N},[t("div",Qs,[t("div",{class:V(c.type==="youtube"?"i-mdi-youtube text-theme-accent":"i-mdi-bank")},null,2),t("span",null,d(c.label||(c.type==="youtube"?c.channelName||"YouTube":"Archive.org")),1),c.quality?(l(),a("span",Js,"("+d(c.quality)+")",1)):n("",!0)])],10,Hs),c.qualityMarks?.length?(l(),a("div",Xs,[(l(!0),a(S,null,I(c.qualityMarks,K=>(l(),a("span",{key:K,class:"text-[10px] font-bold text-yellow-700 dark:text-yellow-300 bg-yellow-100 dark:bg-yellow-900/30 px-1.5 py-0.5 rounded border border-yellow-200 dark:border-yellow-800 uppercase tracking-tighter"},d(K),1))),128))])):n("",!0)]),t("a",{href:c.url,target:"_blank",rel:"noopener noreferrer",title:c.type==="youtube"?`Watch on YouTube${c.channelName?" - "+c.channelName:""}`:"Watch on Archive.org",class:V(["p-2 rounded-lg transition-colors hover:bg-theme-selection text-theme-primary",{"text-theme-accent":o(P)===N}])},[...e[20]||(e[20]=[t("div",{class:"i-mdi-open-in-new text-lg"},null,-1)])],10,Zs)]))),128))])])):n("",!0),o(T)?(l(),a("div",eo,[o(T).type==="youtube"?(l(),a("div",to,[t("iframe",{src:`https://www.youtube.com/embed/${o(T).id}`,class:"w-full h-full",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:"",title:"YouTube video player"},null,8,so)])):o(T).type==="archive.org"?(l(),a("div",oo,[t("iframe",{src:`https://archive.org/embed/${o(T).id}`,class:"w-full h-full",frameborder:"0",webkitallowfullscreen:"true",mozallowfullscreen:"true",allowfullscreen:"",title:"Archive.org video player"},null,8,lo)])):n("",!0)])):n("",!0),o(r).metadata?(l(),a("div",ao,[o(r).metadata.Language?(l(),a("div",io,[e[22]||(e[22]=t("h3",{class:"movie-label"},"Language",-1)),t("p",ro,d(o(r).metadata.Language),1)])):n("",!0),o(r).metadata.Country?(l(),a("div",no,[e[23]||(e[23]=t("h3",{class:"movie-label"},"Country",-1)),t("p",co,d(o(r).metadata.Country),1)])):n("",!0),o(r).metadata.Awards?(l(),a("div",mo,[e[24]||(e[24]=t("h3",{class:"movie-label"},"Awards",-1)),t("p",uo,d(o(r).metadata.Awards),1)])):n("",!0),o(r).imdbId?.startsWith("tt")?(l(),a("div",vo,[e[25]||(e[25]=t("h3",{class:"movie-label"},"IMDB",-1)),t("a",{href:`https://www.imdb.com/title/${o(r).imdbId}/`,target:"_blank",rel:"noopener noreferrer",class:"text-theme-primary hover:underline"}," View on IMDB ",8,po)])):n("",!0)])):n("",!0),o(y).length>0?(l(),a("div",bo,[e[26]||(e[26]=t("h2",{class:"text-2xl font-bold mb-6"},"Related Movies",-1)),t("div",xo,[t("div",ho,[(l(!0),a(S,null,I(o(y),c=>(l(),a("div",{key:c.imdbId,class:"flex-shrink-0 w-48 snap-start"},[ce(i,{movie:c},null,8,["movie"])]))),128))])])])):n("",!0),o(r)?(l(),pe(f,{key:4,movie:o(r),onUpdated:re},null,8,["movie"])):n("",!0)])):n("",!0)]),t("footer",fo,[t("div",yo,[e[27]||(e[27]=t("p",null,"All movies are legally available from Archive.org and YouTube",-1)),t("button",{class:"mt-2 text-xs hover:underline",onClick:e[1]||(e[1]=c=>g.value=!0)}," Press ? for keyboard shortcuts ")])]),o(g)?(l(),a("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm",onClick:e[4]||(e[4]=c=>g.value=!1)},[t("div",{class:"bg-theme-surface rounded-lg p-6 max-w-md w-full mx-4 border border-theme-border shadow-2xl",onClick:e[3]||(e[3]=Ae(()=>{},["stop"]))},[t("div",go,[e[29]||(e[29]=t("h3",{class:"text-xl font-bold text-theme-text"},"Keyboard Shortcuts",-1)),t("button",{class:"p-2 hover:bg-theme-selection rounded-full text-theme-text",onClick:e[2]||(e[2]=c=>g.value=!1)},[...e[28]||(e[28]=[t("div",{class:"i-mdi-close text-xl"},null,-1)])])]),e[30]||(e[30]=ue('<div class="space-y-3"><div class="flex items-center justify-between"><span class="text-theme-text">Go back to home</span><kbd class="px-3 py-1 bg-theme-selection border border-theme-border/50 rounded text-sm font-mono text-theme-text">ESC</kbd></div><div class="flex items-center justify-between"><span class="text-theme-text">Toggle liked</span><kbd class="px-3 py-1 bg-theme-selection border border-theme-border/50 rounded text-sm font-mono text-theme-text">Space / Enter</kbd></div><div class="flex items-center justify-between"><span class="text-theme-text">Previous movie</span><kbd class="px-3 py-1 bg-theme-selection border border-theme-border/50 rounded text-sm font-mono text-theme-text">←</kbd></div><div class="flex items-center justify-between"><span class="text-theme-text">Next movie</span><kbd class="px-3 py-1 bg-theme-selection border border-theme-border/50 rounded text-sm font-mono text-theme-text">→</kbd></div><div class="flex items-center justify-between"><span class="text-theme-text">Show this help</span><kbd class="px-3 py-1 bg-theme-selection border border-theme-border/50 rounded text-sm font-mono text-theme-text">?</kbd></div></div>',1))])])):n("",!0)])}}});export{Mo as default};
