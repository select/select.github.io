import{_ as T}from"./fyh0VxbN.js";import{e as O,g as j,f as u,m as _,T as F,h as I,U as N,p as U,c,k as b,l as t,N as y,F as W,r as z,o as a,q as Y,j as $,V as q,W as P,X}from"./Ctgg7gKM.js";const h=3,A=O({__name:"MovieVirtualGrid",props:{movies:{},totalMovies:{}},emits:["load-more"],setup(H,{emit:V}){const d=H,C=V,{y:S}=j(),{height:B,width:E}=q(),i=P(X),r=u(()=>i.xl.value?6:i.lg.value?5:i.md.value?4:i.sm.value?3:2),G=u(()=>i.xl.value?"grid-cols-6":i.lg.value?"grid-cols-5":i.md.value?"grid-cols-4":i.sm.value?"grid-cols-3":"grid-cols-2"),x=_(null),{height:M}=F(x),v=u(()=>{if(M.value>0)return M.value+16;const n=E.value||1024,s=i.lg.value?n*.12:32,g=n-s,o=(r.value-1)*16,m=(g-o)/r.value*1.5;return Math.ceil(m+80+16)}),R=u(()=>Math.ceil(d.movies.length/r.value)),L=u(()=>R.value*v.value),k=_(0),f=_(null),p=()=>{if(f.value){const n=f.value.getBoundingClientRect();k.value=n.top+window.scrollY}};I(()=>{p(),window.addEventListener("resize",p)}),N(()=>{window.removeEventListener("resize",p)});const e=u(()=>{if(!d.movies||d.movies.length===0)return[];const n=Math.max(0,S.value-k.value),s=Math.max(0,Math.floor(n/v.value)-h),g=Math.min(R.value-1,Math.ceil((n+B.value)/v.value)+h),l=[];for(let o=s;o<=g;o++){const w=o*r.value,m=d.movies.slice(w,w+r.value);m.length>0&&l.push({index:o,top:o*v.value,movies:m})}return l});return U(e,()=>{const n=Math.ceil(d.movies.length/r.value),s=e.value[e.value.length-1];s&&s.index>=n-h-1&&(window.console.log("[VirtualGrid] Load more triggered - lastVisibleRow:",s.index,"loadedRows:",n,"buffer:",h),C("load-more"))},{deep:!0}),(n,s)=>{const g=T;return a(),c("div",{ref_key:"gridRef",ref:f,class:"w-full"},[t(e).length>0&&t(e)[0]&&t(e)[0].index>0?(a(),c("div",{key:0,style:y({height:`${t(e)[0].top}px`})},null,4)):b("",!0),(a(!0),c(W,null,z(t(e),l=>(a(),c("div",{key:l.index,ref_for:!0,ref:l.index===0?o=>x.value=o:void 0,class:Y(["grid gap-4 mb-4",t(G)])},[(a(!0),c(W,null,z(l.movies,o=>(a(),$(g,{key:o.imdbId,movie:o},null,8,["movie"]))),128))],2))),128)),t(e).length>0&&t(e)[t(e).length-1]?(a(),c("div",{key:1,style:y({height:`${t(L)-(t(e)[t(e).length-1].top+t(v))}px`})},null,4)):b("",!0)],512)}}}),Z=Object.assign(A,{__name:"MovieVirtualGrid"});export{Z as _};
