import{_ as se}from"./CU8EfSz-.js";import{e as N,s as B,f as U,m as y,A as oe,h as Z,c as l,a as e,k as w,d as v,F as T,r as A,l as s,t as c,J as R,v as E,z as Y,B as J,y as q,o as i,q as D,D as ee,Y as le,p as G,b as F,Z as ie,$ as ne,w as X}from"./CUMus-hn.js";import{u as P}from"./B6ZO72Gu.js";import{_ as re}from"./Sn5izEfN.js";import{g as te}from"./DIyg_nqV.js";import{u as O}from"./Cl5T_FlK.js";import{i as de}from"./BH85bPq3.js";const ae={class:"space-y-4"},ce={class:"flex items-center justify-between"},ue={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},me=["onClick"],be={class:"flex items-center justify-between mb-2 pr-12"},fe={key:0,class:"flex flex-wrap gap-1 mb-2"},xe={class:"text-xs text-theme-textmuted line-clamp-1 mb-2"},pe={class:"flex items-center gap-2 text-xs font-mono bg-theme-bg/50 px-2 py-1 rounded w-fit"},ve=["onClick"],ge=["onClick"],he={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},ye={class:"bg-theme-surface rounded-2xl w-full max-w-lg shadow-2xl border border-theme-border overflow-hidden"},_e={class:"p-6 border-b border-theme-border flex items-center justify-between"},ke={class:"text-xl font-bold"},we=["disabled"],$e={class:"flex flex-wrap gap-2 p-3 bg-theme-background border border-theme-border rounded-lg min-h-[50px]"},Se=["onClick"],Ce={class:"relative flex-1 min-w-[120px]"},Ie=["onKeydown"],Me={key:0,class:"absolute z-10 left-0 right-0 mt-2 bg-theme-surface border border-theme-border rounded-lg shadow-xl max-h-48 overflow-y-auto"},Te=["onMousedown"],Ae={class:"pt-4 flex gap-3"},Ve=["disabled"],Qe={key:0,class:"i-mdi-loading animate-spin mx-auto"},Fe={key:1},Le=N({__name:"AdminCollectionSelector",emits:["select"],setup(I,{emit:S}){const b=P(),{collections:p}=B(b),x=U(()=>Array.from(p.value.values())),g=y(""),f=S,C=n=>{g.value=n,f("select",n)},$=y(!1),_=y(null),r=y(!1),t=oe({id:"",name:"",description:"",tags:[]}),o=y(""),m=y(!1),k=U(()=>{const n=new Set;return p.value.forEach(d=>{d.tags&&d.tags.forEach(u=>n.add(u))}),Array.from(n).sort()}),M=U(()=>{const n=o.value.toLowerCase().trim();return k.value.filter(d=>d.toLowerCase().includes(n)&&!t.tags.includes(d))}),V=()=>{const n=o.value.trim();n&&!t.tags.includes(n)&&(t.tags.push(n),o.value="")},H=n=>{t.tags=t.tags.filter(d=>d!==n)},z=()=>{o.value===""&&t.tags.length>0&&t.tags.pop()},K=n=>{t.tags.includes(n)||t.tags.push(n),o.value="",m.value=!1},L=()=>{setTimeout(()=>{m.value=!1},200)},W=n=>{_.value=n,t.id=n.id,t.name=n.name,t.description=n.description,t.tags=[...n.tags||[]]},h=()=>{$.value=!1,_.value=null,t.id="",t.name="",t.description="",t.tags=[],o.value="",m.value=!1},a=async()=>{r.value=!0;try{_.value?(await $fetch("/api/admin/collections/update-collection",{method:"POST",body:{collectionId:t.id,updates:{name:t.name,description:t.description,tags:{action:"set",values:t.tags}}}})).success&&(await b.loadCollections(),h()):(await $fetch("/api/admin/collections/create",{method:"POST",body:t})).success&&(await b.loadCollections(),h())}catch{}finally{r.value=!1}},j=async n=>{if(confirm(`Are you sure you want to delete the collection "${n.name}"? This cannot be undone.`))try{(await $fetch("/api/admin/collections/delete",{method:"POST",body:{id:n.id}})).success&&(g.value===n.id&&(g.value="",f("select","")),await b.loadCollections())}catch{}};return Z(async()=>{b.isLoaded||await b.loadCollections()}),(n,d)=>(i(),l("div",ae,[e("div",ce,[d[7]||(d[7]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Select Collection ",-1)),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:d[0]||(d[0]=u=>$.value=!0)},[...d[6]||(d[6]=[e("div",{class:"i-mdi-plus"},null,-1),v(" Create New ",-1)])])]),e("div",ue,[(i(!0),l(T,null,A(s(x),u=>(i(),l("div",{key:u.id,class:"relative group"},[e("button",{class:D(["w-full text-left p-4 rounded-xl border transition-all h-full",[s(g)===u.id?"bg-blue-600/10 border-blue-600 ring-2 ring-blue-600/20":"bg-theme-surface border-theme-border hover:border-theme-textmuted"]]),onClick:Q=>C(u.id)},[e("div",be,[e("span",{class:D(["font-bold text-lg truncate",s(g)===u.id?"text-blue-600 dark:text-blue-400":""])},c(u.name),3)]),u.tags?.length?(i(),l("div",fe,[(i(!0),l(T,null,A(u.tags,Q=>(i(),l("span",{key:Q,class:"px-1.5 py-0.5 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded text-[10px] font-medium"},c(Q),1))),128))])):w("",!0),e("p",xe,c(u.description||"No description"),1),e("div",pe,[d[8]||(d[8]=e("div",{class:"i-mdi-movie"},null,-1)),v(" "+c(u.movieIds.length)+" movies ",1)])],10,me),e("div",{class:D(["absolute top-3 right-3 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",{"opacity-100":s(g)===u.id}])},[e("button",{class:"p-1.5 hover:bg-theme-selection rounded-lg text-blue-500 transition-colors",title:"Edit Collection",onClick:R(Q=>W(u),["stop"])},[...d[9]||(d[9]=[e("div",{class:"i-mdi-pencil text-lg"},null,-1)])],8,ve),e("button",{class:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg text-red-500 transition-colors",title:"Delete Collection",onClick:R(Q=>j(u),["stop"])},[...d[10]||(d[10]=[e("div",{class:"i-mdi-delete text-lg"},null,-1)])],8,ge)],2)]))),128))]),s($)||s(_)?(i(),l("div",he,[e("div",ye,[e("div",_e,[e("h3",ke,c(s(_)?"Edit Collection":"Create New Collection"),1),e("button",{class:"p-2 hover:bg-theme-selection rounded-full transition-colors",onClick:h},[...d[11]||(d[11]=[e("div",{class:"i-mdi-close text-xl"},null,-1)])])]),e("form",{class:"p-6 space-y-4",onSubmit:R(a,["prevent"])},[e("div",null,[d[12]||(d[12]=e("label",{class:"block text-sm font-bold mb-1"},"ID (URL Slug)",-1)),E(e("input",{"onUpdate:modelValue":d[1]||(d[1]=u=>s(t).id=u),type:"text",placeholder:"e.g. charlie-chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm font-mono",disabled:!!s(_),required:""},null,8,we),[[Y,s(t).id]])]),e("div",null,[d[13]||(d[13]=e("label",{class:"block text-sm font-bold mb-1"},"Name",-1)),E(e("input",{"onUpdate:modelValue":d[2]||(d[2]=u=>s(t).name=u),type:"text",placeholder:"e.g. Charlie Chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm",required:""},null,512),[[Y,s(t).name]])]),e("div",null,[d[14]||(d[14]=e("label",{class:"block text-sm font-bold mb-1"},"Description",-1)),E(e("textarea",{"onUpdate:modelValue":d[3]||(d[3]=u=>s(t).description=u),rows:"3",placeholder:"Describe this collection...",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm"},null,512),[[Y,s(t).description]])]),e("div",null,[d[16]||(d[16]=e("label",{class:"block text-sm font-bold mb-1"},"Tags",-1)),e("div",$e,[(i(!0),l(T,null,A(s(t).tags,u=>(i(),l("div",{key:u,class:"flex items-center gap-1.5 px-3 py-1 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded-full text-sm font-medium group"},[v(c(u)+" ",1),e("button",{type:"button",class:"p-0.5 hover:bg-blue-600/20 rounded-full transition-colors",onClick:Q=>H(u)},[...d[15]||(d[15]=[e("div",{class:"i-mdi-close text-xs"},null,-1)])],8,Se)]))),128)),e("div",Ce,[E(e("input",{"onUpdate:modelValue":d[4]||(d[4]=u=>q(o)?o.value=u:null),type:"text",placeholder:"Add tag...",class:"w-full bg-transparent border-none focus:ring-0 text-sm py-1",onKeydown:[J(R(V,["prevent"]),["enter"]),J(z,["backspace"])],onFocus:d[5]||(d[5]=u=>m.value=!0),onBlur:L},null,40,Ie),[[Y,s(o)]]),s(m)&&s(M).length>0?(i(),l("div",Me,[(i(!0),l(T,null,A(s(M),u=>(i(),l("button",{key:u,type:"button",class:"w-full text-left px-4 py-2 text-sm hover:bg-theme-selection transition-colors",onMousedown:R(Q=>K(u),["prevent"])},c(u),41,Te))),128))])):w("",!0)])])]),e("div",Ae,[e("button",{type:"button",class:"flex-1 px-4 py-2 border border-theme-border rounded-lg font-bold hover:bg-theme-selection transition-colors",onClick:h}," Cancel "),e("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-500 transition-colors disabled:opacity-50",disabled:s(r)},[s(r)?(i(),l("div",Qe)):(i(),l("span",Fe,c(s(_)?"Update":"Create"),1))],8,Ve)])],32)])])):w("",!0)]))}}),De=Object.assign(Le,{__name:"AdminCollectionSelector"}),je={class:"space-y-4"},Re={class:"flex items-center gap-4"},Ee={class:"relative flex-1"},Ye={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},Ne={key:0,class:"bg-blue-600 text-white px-1.5 py-0.5 rounded-full text-[10px]"},Pe={key:0,class:"flex flex-wrap items-center gap-2"},Ue={key:0,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},Be={key:1,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},Oe={key:2,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},ze={key:1,class:"bg-theme-surface border border-theme-border rounded-2xl overflow-hidden divide-y divide-theme-border"},Ke={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},We=["src","alt"],Ge={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},He={class:"flex-1 min-w-0"},Je={class:"flex items-center gap-2"},Xe={class:"font-bold truncate"},Ze={class:"text-xs text-theme-textmuted font-mono"},qe={class:"text-xs text-theme-textmuted truncate"},et={class:"text-[10px] text-theme-textmuted font-mono mt-0.5"},tt=["disabled","onClick"],st={key:0,class:"i-mdi-loading animate-spin"},ot={key:2,class:"p-8 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},lt=N({__name:"AdminMovieSearch",props:{collectionId:{}},emits:["add"],setup(I,{emit:S}){const b=I,p=S,x=P(),g=O(),{filters:f,activeFiltersCount:C,hasActiveFilters:$}=B(g),{resetFilters:_}=g,r=ee(),t=y(null),o=y(""),m=y([]),k=y(!1),M=y(""),V=y(!1);le("/",h=>{const a=window.document.activeElement,j=a?.tagName==="INPUT"||a?.tagName==="TEXTAREA";h.preventDefault(),j||t.value?.focus()}),G(o,h=>{g.setSearchQuery(h)}),G(()=>f.value.searchQuery,h=>{h!==o.value&&(o.value=h)});const z=ie(async()=>{if(o.value.length<3){m.value=[];return}k.value=!0;try{const h=await $fetch("/api/admin/movies/search",{query:{q:o.value}});m.value=h}catch{r.showToast("Search failed","error")}finally{k.value=!1}},300),K=()=>{z()},L=h=>x.isMovieInCollection(h,b.collectionId),W=async h=>{M.value=h;try{await x.addMovieToCollection(b.collectionId,h)?(r.showToast("Movie added to collection"),p("add")):r.showToast("Failed to add movie","error")}catch{r.showToast("Error adding movie","error")}finally{M.value=""}};return(h,a)=>{const j=re;return i(),l("div",je,[e("div",Re,[e("div",Ee,[a[6]||(a[6]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-theme-textmuted"},[e("div",{class:"i-mdi-magnify text-xl"})],-1)),E(e("input",{ref_key:"searchInput",ref:t,"onUpdate:modelValue":a[0]||(a[0]=n=>q(o)?o.value=n:null),type:"text",placeholder:"Search by title, director, writer, plot or IMDb ID...",class:"block w-full pl-10 pr-3 py-3 border border-theme-border rounded-xl bg-theme-surface focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none",onInput:K},null,544),[[Y,s(o)]]),s(k)?(i(),l("div",Ye,[...a[5]||(a[5]=[e("div",{class:"i-mdi-loading animate-spin text-blue-600"},null,-1)])])):w("",!0)]),e("button",{class:"px-4 py-3 bg-theme-surface border border-theme-border rounded-xl text-sm font-bold hover:bg-theme-selection transition-colors flex items-center gap-2",onClick:a[1]||(a[1]=n=>V.value=!0)},[a[7]||(a[7]=e("div",{class:"i-mdi-filter-variant"},null,-1)),a[8]||(a[8]=v(" Filters ",-1)),s(C)>0?(i(),l("span",Ne,c(s(C)),1)):w("",!0)])]),s($)?(i(),l("div",Pe,[s(f).minRating>0?(i(),l("div",Ue,[a[9]||(a[9]=e("div",{class:"i-mdi-star"},null,-1)),v(" "+c(s(f).minRating)+"+ ",1)])):w("",!0),s(f).minYear>0||s(f).maxYear?(i(),l("div",Be,[a[10]||(a[10]=e("div",{class:"i-mdi-calendar"},null,-1)),v(" "+c(s(f).minYear||1910)+" - "+c(s(f).maxYear||2025),1)])):w("",!0),s(f).minVotes>0||s(f).maxVotes?(i(),l("div",Oe,[a[11]||(a[11]=e("div",{class:"i-mdi-account-group"},null,-1)),v(" "+c(s(f).minVotes.toLocaleString())+" - "+c(s(f).maxVotes?s(f).maxVotes.toLocaleString():"Any"),1)])):w("",!0),(i(!0),l(T,null,A(s(f).genres,n=>(i(),l("div",{key:n,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[a[12]||(a[12]=e("div",{class:"i-mdi-movie-filter"},null,-1)),v(" "+c(n),1)]))),128)),(i(!0),l(T,null,A(s(f).sources,n=>(i(),l("div",{key:n,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[a[13]||(a[13]=e("div",{class:"i-mdi-source-branch"},null,-1)),v(" "+c(n),1)]))),128)),e("button",{class:"text-xs text-theme-primary hover:underline ml-2",onClick:a[2]||(a[2]=(...n)=>s(_)&&s(_)(...n))}," Clear All ")])):w("",!0),s(m).length>0?(i(),l("div",ze,[(i(!0),l(T,null,A(s(m),n=>(i(),l("div",{key:n.imdbId,class:"p-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",Ke,[n.imdbId?.startsWith("tt")?(i(),l("img",{key:0,src:("getPosterPath"in h?h.getPosterPath:s(te))(n.imdbId),alt:n.title,class:"w-full h-full object-cover",onError:a[3]||(a[3]=d=>d.target.style.display="none")},null,40,We)):(i(),l("div",Ge,[...a[14]||(a[14]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",He,[e("div",Je,[e("h4",Xe,c(n.title),1),e("span",Ze,c(n.year),1)]),e("p",qe,c(n.metadata?.Director||"Unknown Director"),1),e("p",et,c(n.imdbId),1)]),e("button",{class:D(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1.5 disabled:opacity-50",L(n.imdbId)?"bg-theme-selection text-theme-textmuted cursor-default":"bg-blue-600 hover:bg-blue-500 text-white"]),disabled:L(n.imdbId)||s(M)===n.imdbId,onClick:d=>W(n.imdbId)},[s(M)===n.imdbId?(i(),l("div",st)):(i(),l("div",{key:1,class:D(L(n.imdbId)?"i-mdi-check":"i-mdi-plus")},null,2)),v(" "+c(L(n.imdbId)?"Added":"Add"),1)],10,tt)]))),128))])):s(o).length>=3&&!s(k)?(i(),l("div",ot,' No movies found for "'+c(s(o))+'" ',1)):w("",!0),F(j,{"is-open":s(V),onClose:a[4]||(a[4]=n=>V.value=!1)},null,8,["is-open"])])}}}),it=Object.assign(lt,{__name:"AdminMovieSearch"}),nt={class:"space-y-4"},rt={key:0,class:"text-sm text-theme-textmuted italic p-4 bg-theme-surface border border-theme-border border-dashed rounded-xl text-center"},dt={key:1,class:"space-y-3"},at={class:"flex items-start justify-between gap-4"},ct={class:"flex-1 space-y-2"},ut={class:"flex items-center gap-2"},mt={class:"font-bold text-sm"},bt={class:"flex flex-wrap gap-2"},ft={key:0,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},xt={key:1,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},pt={key:2,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},vt={key:3,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},gt={key:4,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},ht={key:5,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},yt={class:"flex items-center gap-1"},_t=["onClick"],kt=["onClick"],wt={class:"flex justify-end pt-2"},$t=["disabled"],St=N({__name:"AdminSavedQueryManager",props:{collectionId:{},queries:{}},setup(I){const S=I,b=P(),p=O(),{filters:x}=B(p),g=y(!1),f=async()=>{const r={field:"year",direction:"desc"},o={...x.value.sort.field===r.field&&x.value.sort.direction===r.direction?{}:{sort:{...x.value.sort}},sources:[...x.value.sources],minRating:x.value.minRating,minYear:x.value.minYear,maxYear:x.value.maxYear,minVotes:x.value.minVotes,maxVotes:x.value.maxVotes,genres:[...x.value.genres],countries:[...x.value.countries],searchQuery:x.value.searchQuery,currentPage:1,lastScrollY:0},m={searchQuery:x.value.searchQuery,filterState:o};await b.addQueryToCollection(S.collectionId,m)},C=async r=>{confirm("Are you sure you want to remove this saved query?")&&await b.removeQueryFromCollection(S.collectionId,r)},$=r=>{p.resetFilters(),r.searchQuery&&p.setSearchQuery(r.searchQuery),r.filterState.sort&&p.setSort(r.filterState.sort),p.setMinRating(r.filterState.minRating),p.setMinYear(r.filterState.minYear),r.filterState.maxYear&&p.setMaxYear(r.filterState.maxYear),p.setMinVotes(r.filterState.minVotes),r.filterState.maxVotes&&p.setMaxVotes(r.filterState.maxVotes),r.filterState.genres.forEach(t=>p.toggleGenre(t)),r.filterState.countries.forEach(t=>p.toggleCountry(t)),r.filterState.sources.forEach(t=>p.toggleSource(t))},_=async()=>{g.value=!0;try{const r=await b.refreshCollectionFromQuery(S.collectionId);r.success&&alert(`Collection refreshed! Now contains ${r.movieCount} movies.`)}finally{g.value=!1}};return(r,t)=>(i(),l("div",nt,[e("div",{class:"flex items-center justify-between"},[t[1]||(t[1]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Saved Queries ",-1)),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:f},[...t[0]||(t[0]=[e("div",{class:"i-mdi-plus"},null,-1),v(" Save Current Search ",-1)])])]),!I.queries||I.queries.length===0?(i(),l("div",rt," No saved queries for this collection. ")):(i(),l("div",dt,[(i(!0),l(T,null,A(I.queries,(o,m)=>(i(),l("div",{key:m,class:"p-4 bg-theme-surface border border-theme-border rounded-xl group hover:border-theme-textmuted transition-all"},[e("div",at,[e("div",ct,[e("div",ut,[t[2]||(t[2]=e("div",{class:"i-mdi-magnify text-theme-textmuted"},null,-1)),e("span",mt,c(o.searchQuery||"All Movies"),1)]),e("div",bt,[o.filterState.sort?(i(),l("div",ft,[t[3]||(t[3]=e("div",{class:"i-mdi-sort"},null,-1)),v(" "+c(o.filterState.sort.field)+" ("+c(o.filterState.sort.direction)+") ",1)])):w("",!0),o.filterState.minYear>0||o.filterState.maxYear?(i(),l("div",xt,[t[4]||(t[4]=e("div",{class:"i-mdi-calendar"},null,-1)),v(" "+c(o.filterState.minYear||1910)+" - "+c(o.filterState.maxYear||2025),1)])):w("",!0),o.filterState.minRating>0?(i(),l("div",pt,[t[5]||(t[5]=e("div",{class:"i-mdi-star"},null,-1)),v(" "+c(o.filterState.minRating)+"+ ",1)])):w("",!0),o.filterState.minVotes>0||o.filterState.maxVotes?(i(),l("div",vt,[t[6]||(t[6]=e("div",{class:"i-mdi-account-group"},null,-1)),v(" "+c(o.filterState.minVotes.toLocaleString())+" - "+c(o.filterState.maxVotes?o.filterState.maxVotes.toLocaleString():"Any"),1)])):w("",!0),o.filterState.genres?.length?(i(),l("div",gt,[t[7]||(t[7]=e("div",{class:"i-mdi-movie-filter"},null,-1)),v(" "+c(o.filterState.genres.join(", ")),1)])):w("",!0),o.filterState.sources?.length?(i(),l("div",ht,[t[8]||(t[8]=e("div",{class:"i-mdi-source-branch"},null,-1)),v(" "+c(o.filterState.sources.join(", ")),1)])):w("",!0)])]),e("div",yt,[e("button",{class:"p-2 hover:bg-blue-600/10 text-blue-600 rounded-lg transition-colors",title:"Apply Filters",onClick:k=>$(o)},[...t[9]||(t[9]=[e("div",{class:"i-mdi-filter-variant"},null,-1)])],8,_t),e("button",{class:"p-2 hover:bg-red-600/10 text-red-600 rounded-lg transition-colors",title:"Remove Query",onClick:k=>C(m)},[...t[10]||(t[10]=[e("div",{class:"i-mdi-delete"},null,-1)])],8,kt)])])]))),128))])),e("div",wt,[e("button",{class:"px-4 py-2 bg-theme-primary text-white rounded-lg text-sm font-bold transition-colors flex items-center gap-2 disabled:opacity-50",disabled:s(g)||!I.queries?.length,onClick:_},[e("div",{class:D([s(g)?"i-mdi-loading animate-spin":"i-mdi-refresh"])},null,2),t[11]||(t[11]=v(" Refresh Collection from Queries ",-1))],8,$t)])]))}}),Ct=Object.assign(St,{__name:"AdminSavedQueryManager"}),It={class:"space-y-4"},Mt={key:0,class:"p-12 flex justify-center"},Tt={key:1,class:"overflow-hidden divide-y divide-theme-border"},At={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},Vt=["src","alt"],Qt={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},Ft={class:"flex-1 min-w-0"},Lt={class:"flex items-center gap-2"},Dt={class:"font-bold truncate"},jt={class:"text-xs text-theme-textmuted font-mono"},Rt={class:"text-xs text-theme-textmuted truncate"},Et={class:"text-[10px] text-theme-textmuted font-mono mt-0.5"},Yt=["disabled","onClick"],Nt={key:0,class:"i-mdi-loading animate-spin text-xl"},Pt={key:1,class:"i-mdi-trash-can-outline text-xl"},Ut={key:2,class:"p-12 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},Bt=N({__name:"AdminCollectionMoviesList",props:{collectionId:{}},setup(I,{expose:S}){const b=I,p=P(),x=O(),g=ee(),f=y([]),C=y(!1),$=y(""),_=async()=>{if(b.collectionId){C.value=!0;try{const t=await p.getCollectionById(b.collectionId);if(!t||!t.movieIds||!t.movieIds.length){f.value=[];return}!x.allMovies.size&&!x.isLoading.movies&&await x.loadFromFile();const o=ne(t.movieIds),m=await x.fetchMoviesByIds(o);f.value=o.map(k=>m.find(M=>M.imdbId===k)).filter(k=>!!k)}catch(t){console.error("Failed to load collection movies:",t),g.showToast("Failed to load collection movies","error")}finally{C.value=!1}}},r=async t=>{if(confirm(`Remove "${t.title}" from this collection?`)){$.value=t.imdbId;try{await p.removeMovieFromCollection(b.collectionId,t.imdbId)?(g.showToast("Movie removed from collection"),await _()):g.showToast("Failed to remove movie","error")}catch{g.showToast("Error removing movie","error")}finally{$.value=""}}};return S({refresh:_}),G(()=>b.collectionId,()=>{_()},{immediate:!0}),(t,o)=>(i(),l("div",It,[s(C)?(i(),l("div",Mt,[...o[1]||(o[1]=[e("div",{class:"i-mdi-loading animate-spin text-4xl text-blue-600"},null,-1)])])):s(f).length>0?(i(),l("div",Tt,[(i(!0),l(T,null,A(s(f),m=>(i(),l("div",{key:m.imdbId,class:"py-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",At,[m.imdbId?.startsWith("tt")?(i(),l("img",{key:0,src:("getPosterPath"in t?t.getPosterPath:s(te))(m.imdbId),alt:m.title,class:"w-full h-full object-cover",onError:o[0]||(o[0]=k=>k.target.style.display="none")},null,40,Vt)):(i(),l("div",Qt,[...o[2]||(o[2]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",Ft,[e("div",Lt,[e("h4",Dt,c(m.title),1),e("span",jt,c(m.year),1)]),e("p",Rt,c(m.metadata?.Director||"Unknown Director"),1),e("p",Et,c(m.imdbId),1)]),e("button",{class:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Remove from collection",disabled:s($)===m.imdbId,onClick:k=>r(m)},[s($)===m.imdbId?(i(),l("div",Nt)):(i(),l("div",Pt))],8,Yt)]))),128))])):(i(),l("div",Ut,[...o[3]||(o[3]=[e("div",{class:"i-mdi-movie-off-outline text-4xl mx-auto mb-2 opacity-20"},null,-1),e("p",null,"No movies in this collection yet.",-1)])]))]))}}),Ot=Object.assign(Bt,{__name:"AdminCollectionMoviesList"}),zt={class:"min-h-screen bg-theme-background text-theme-text p-4 md:ml-16 transition-colors duration-300"},Kt={class:"max-w-7xl mx-auto space-y-8"},Wt={key:0,class:"flex flex-col items-center justify-center h-[60vh] text-center"},Gt={key:1,class:"flex flex-col gap-8"},Ht={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},Jt={class:"bg-theme-surface border border-theme-border rounded-2xl p-6"},Xt={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},Zt={class:"space-y-8"},qt={class:"space-y-6"},es={class:"space-y-6"},ts={class:"bg-theme-surface border border-theme-border rounded-2xl p-6 space-y-6"},as=N({__name:"index",setup(I){const S=y(!1),b=y(""),p=y(null),x=O(),g=P(),{collections:f}=B(g),C=U(()=>b.value&&f.value.get(b.value)||null);Z(async()=>{S.value=de(),S.value&&await x.loadFromFile()});const $=()=>{p.value&&p.value.refresh()};return(_,r)=>{const t=se,o=De,m=it,k=Ct,M=Ot;return i(),l("div",zt,[e("main",Kt,[s(S)?(i(),l("div",Gt,[e("header",Ht,[r[6]||(r[6]=e("div",null,[e("h1",{class:"text-3xl font-bold flex items-center gap-3"},[e("div",{class:"i-mdi-movie-edit text-blue-600"}),v(" Collection Editor ")]),e("p",{class:"text-theme-textmuted mt-1"}," Add and remove movies from collections ")],-1)),F(t,{to:"/admin",class:"px-4 py-2 text-sm bg-theme-surface border border-theme-border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"},{default:X(()=>[...r[5]||(r[5]=[e("div",{class:"i-mdi-arrow-left"},null,-1),v(" Back to Dashboard ",-1)])]),_:1})]),e("section",Jt,[F(o,{onSelect:r[0]||(r[0]=V=>b.value=V)})]),s(b)?(i(),l("section",Xt,[e("div",Zt,[e("div",qt,[r[7]||(r[7]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-magnify text-blue-600"}),v(" Search Library ")],-1)),F(m,{"collection-id":s(b),onAdd:$},null,8,["collection-id"])])]),e("div",es,[e("div",ts,[r[8]||(r[8]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-database-clock text-blue-600"}),v(" Dynamic Queries ")],-1)),F(k,{"collection-id":s(b),queries:s(C)?.savedQueries},null,8,["collection-id","queries"])]),r[9]||(r[9]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-playlist-play text-blue-600"}),v(" Collection Movies ")],-1)),F(M,{ref_key:"moviesList",ref:p,"collection-id":s(b)},null,8,["collection-id"])])])):w("",!0)])):(i(),l("div",Wt,[r[2]||(r[2]=e("div",{class:"i-mdi-lock text-64px text-gray-300 dark:text-gray-700 mb-4"},null,-1)),r[3]||(r[3]=e("h1",{class:"text-2xl font-bold mb-2"}," Access Denied ",-1)),r[4]||(r[4]=e("p",{class:"text-theme-textmuted"}," The admin interface is only available on localhost. ",-1)),F(t,{to:"/",class:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors"},{default:X(()=>[...r[1]||(r[1]=[v(" Back to Home ",-1)])]),_:1})]))])])}}});export{as as default};
