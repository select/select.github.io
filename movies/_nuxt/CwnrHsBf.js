import{a as O}from"./B3VMFFaX.js";import{E as Y,r as w,a3 as N,G as P,e as c,J as y,k as j,n as W,x as q,c as d,L as z,z as n,a8 as B,M as S,N as H,af as A,o as a,P as D,F as J,ag as U,ah as K,Y as Q}from"./DGvbdLlG.js";const V=3,X=Y({__name:"MovieVirtualGrid",props:{movieIds:{},columnCount:{}},setup(F){const i=F,M=w(null),_=w(null),v=U(K),{y:b}=N(),{height:k,width:G}=A(),$=P(),{fetchMoviesByIds:x}=$,I=c(()=>i.movieIds.length),r=c(()=>i.columnCount?i.columnCount:v.xl.value?6:v.lg.value?5:v.md.value?4:v.sm.value?3:2),E=c(()=>i.columnCount?`grid-cols-${i.columnCount}`:"grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6"),u=c(()=>{if(_.value)return _.value.getBoundingClientRect().height+16;const t=G.value||1024,e=v.lg.value?t*.12:32,f=t-e,s=(r.value-1)*16,p=(f-s)/r.value*1.5;return Math.ceil(p+80+16)}),C=c(()=>Math.ceil(I.value/r.value)),L=c(()=>C.value*u.value),R=w(0),g=()=>{if(M.value){const t=M.value.getBoundingClientRect();R.value=t.top+window.scrollY}};y(()=>{g(),window.addEventListener("resize",g)}),j(()=>{window.removeEventListener("resize",g)});const h=()=>{if(I.value===0)return[];const t=Math.max(0,b.value-R.value),e=Math.max(0,Math.floor(t/u.value)-V),f=Math.min(C.value-1,Math.ceil((t+k.value)/u.value)+V),l=[];for(let s=e;s<=f;s++){const m=s*r.value,p=i.movieIds?.slice(m,m+r.value)||[];p.length>0&&l.push({index:s,top:s*u.value,movieIds:p})}return l},o=w(h()),T=Q(()=>{o.value=h();const t=o.value.flatMap(e=>e.movieIds).filter(e=>e!==null&&!!e);t.length>0&&x(t).catch(e=>{console.error("[MovieVirtualGrid] Failed to load visible range:",e)})},80);return W([b,k,u,r,I],()=>{T()}),W(()=>i.movieIds,()=>{if(i.movieIds){o.value=h();const t=o.value.flatMap(e=>e.movieIds).filter(e=>e!==null&&!!e);t.length>0&&x(t)}},{deep:!0}),y(async()=>{if(i.movieIds){o.value=h();const t=o.value.flatMap(e=>e.movieIds).filter(e=>e!==null&&!!e);t.length>0&&x(t)}await q(),requestAnimationFrame(()=>{g()})}),(t,e)=>{const f=O;return a(),d("div",{ref_key:"gridRef",ref:M,class:"w-full"},[n(o).length>0&&n(o)[0]&&n(o)[0].index>0?(a(),d("div",{key:0,style:B({height:`${n(o)[0].top}px`})},null,4)):z("",!0),(a(!0),d(S,null,H(n(o),l=>(a(),d("div",{key:l.index,ref_for:!0,ref:l.index===0?s=>_.value=s:void 0,class:D(["grid gap-4 mb-4",n(E)])},[(a(!0),d(S,null,H(l.movieIds,(s,m)=>(a(),J(f,{key:s||`skeleton-${l.index}-${m}`,"movie-id":s},null,8,["movie-id"]))),128))],2))),128)),n(o).length>0&&n(o)[n(o).length-1]?(a(),d("div",{key:1,style:B({height:`${n(L)-(n(o)[n(o).length-1].top+n(u))}px`})},null,4)):z("",!0)],512)}}}),se=Object.assign(X,{__name:"MovieVirtualGrid"});export{se as _};
