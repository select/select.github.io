import{af as v,m as p,Y as l,ag as m}from"./rWn8E2qi.js";function q(o){const a=v().app.baseURL||"/",c=`/posters/${o}.jpg`;return a==="/"?c:`${a}${c.slice(1)}`}let d=null;function w(){const o=p(null),u=p(!1),a=new Map;return{init:async n=>{if(o.value)return;const s=await m(()=>import("./DO5bXbcd.js"),[],import.meta.url);o.value=new s.default,o.value.onmessage=t=>{const{id:e,error:i}=t.data,g=a.get(e);g&&(i?g.reject(new Error(i)):g.resolve(t.data),a.delete(e))};const r=Math.random().toString(36).substring(7);return new Promise((t,e)=>{a.set(r,{resolve:t,reject:e}),o.value.postMessage({type:"init",id:r,url:n})}).then(()=>{u.value=!0})},query:async(n,s=[])=>{if(!u.value)throw new Error("Database not initialized");const r=Math.random().toString(36).substring(7);return new Promise((t,e)=>{a.set(r,{resolve:i=>t(i.result??[]),reject:e}),o.value.postMessage({type:"exec",id:r,sql:n,params:l(s)})})},extendedQuery:async n=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{a.set(s,{resolve:i=>r({result:i.result??[],totalCount:i.totalCount}),reject:t});const e={...n};e.params&&(e.params=l(e.params)),o.value.postMessage({type:"query",id:s,...e})})},lightweightQuery:async n=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{a.set(s,{resolve:i=>r({result:i.result??[],totalCount:i.totalCount}),reject:t});const e={...n};e.params&&(e.params=l(e.params)),o.value.postMessage({type:"query-lightweight",id:s,...e})})},queryByIds:async n=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{a.set(s,{resolve:e=>r(e.result??[]),reject:t}),o.value.postMessage({type:"query-by-ids",id:s,imdbIds:l(n)})})},getRelatedMovies:async(n,s=8)=>{if(!u.value)throw new Error("Database not initialized");const r=Math.random().toString(36).substring(7);return new Promise((t,e)=>{a.set(r,{resolve:i=>t(i.result??[]),reject:e}),o.value.postMessage({type:"query-related",id:r,imdbId:n,limit:s})})},getCollectionsForMovie:async n=>{if(!u.value)throw new Error("Database not initialized");const s=Math.random().toString(36).substring(7);return new Promise((r,t)=>{a.set(s,{resolve:e=>r(e.result??[]),reject:t}),o.value.postMessage({type:"query-collections-for-movie",id:s,movieId:n})})},getFilterOptions:async()=>{if(!u.value)throw new Error("Database not initialized");const n=Math.random().toString(36).substring(7);return new Promise((s,r)=>{a.set(n,{resolve:t=>s({genres:t.genres??[],countries:t.countries??[],channels:t.channels??[]}),reject:r}),o.value.postMessage({type:"get-filter-options",id:n})})},isReady:u}}function R(){return d||(d=w()),d}export{q as g,R as u};
