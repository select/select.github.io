import{_ as ne}from"./B-qhTGpT.js";import{E as B,M as z,e as P,r as _,B as re,G as te,c as l,a as e,I as h,t as d,z as o,d as v,J as Y,K as F,a0 as J,Q as N,T as U,U as q,S as se,o as i,P as L,W as oe,ac as ae,n as X,b as E,ad as de,ae as ce,w as ee}from"./02OeVUp7.js";import{u as O}from"./CFWjqK0N.js";import{_ as ue}from"./DphTw9eM.js";import{g as le}from"./CZfkSF8C.js";import{f as ie}from"./DMOTkeJ5.js";import{u as K}from"./CfQ1CYlZ.js";import{i as me}from"./BH85bPq3.js";const fe={class:"space-y-4"},be={class:"flex items-center justify-between"},xe={class:"flex items-center gap-3"},pe={class:"px-2 py-0.5 text-sm font-mono text-theme-text"},ve={class:"flex flex-wrap gap-2"},ge=["onClick"],he={key:0,class:"i-mdi-eye-off text-xs opacity-70"},ye={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},_e={class:"bg-theme-surface rounded-2xl w-full max-w-lg shadow-2xl border border-theme-border overflow-hidden"},we={class:"p-6 border-b border-theme-border flex items-center justify-between"},ke={class:"text-xl font-bold"},$e=["disabled"],Se={class:"flex flex-wrap gap-2 p-3 bg-theme-background border border-theme-border rounded-lg min-h-[50px]"},Ce=["onClick"],Ie={class:"relative flex-1 min-w-[120px]"},Ve=["onKeydown"],Ae={key:0,class:"absolute z-10 left-0 right-0 mt-2 bg-theme-surface border border-theme-border rounded-lg shadow-xl max-h-48 overflow-y-auto"},Te=["onMousedown"],Me={class:"pt-4 flex gap-3"},Re=["disabled"],Ye={key:0,class:"i-mdi-loading animate-spin mx-auto"},Fe={key:1},Qe=B({__name:"AdminCollectionSelector",emits:["select"],setup(V,{expose:A,emit:y}){const w=O(),{collections:$}=z(w),g=P(()=>Array.from($.value.values())),n=P(()=>g.value.filter(u=>u.enabled!==!1).length),S=_(""),f=y,I=u=>{S.value=u,f("select",u)},C=_(!1),b=_(null),t=_(!1),s=re({id:"",name:"",description:"",tags:[]}),r=_(""),k=_(!1),T=P(()=>{const u=new Set;return $.value.forEach(c=>{c.tags&&c.tags.forEach(p=>u.add(p))}),Array.from(u).sort()}),Q=P(()=>{const u=r.value.toLowerCase().trim();return T.value.filter(c=>c.toLowerCase().includes(u)&&!s.tags.includes(c))}),M=()=>{const u=r.value.trim();u&&!s.tags.includes(u)&&(s.tags.push(u),r.value="")},D=u=>{s.tags=s.tags.filter(c=>c!==u)},W=()=>{r.value===""&&s.tags.length>0&&s.tags.pop()},j=u=>{s.tags.includes(u)||s.tags.push(u),r.value="",k.value=!1},G=()=>{setTimeout(()=>{k.value=!1},200)},H=u=>{b.value=u,s.id=u.id,s.name=u.name,s.description=u.description,s.tags=[...u.tags||[]]},x=()=>{C.value=!1,b.value=null,s.id="",s.name="",s.description="",s.tags=[],r.value="",k.value=!1},a=async()=>{t.value=!0;try{b.value?(await $fetch("/api/admin/collections/update-collection",{method:"POST",body:{collectionId:s.id,updates:{name:s.name,description:s.description,tags:{action:"set",values:s.tags}}}})).success&&(await w.loadCollections(),x()):(await $fetch("/api/admin/collections/create",{method:"POST",body:s})).success&&(await w.loadCollections(),x())}catch{}finally{t.value=!1}},R=async u=>{if(confirm(`Are you sure you want to delete the collection "${u.name}"? This cannot be undone.`))try{(await $fetch("/api/admin/collections/delete",{method:"POST",body:{id:u.id}})).success&&(S.value===u.id&&(S.value="",f("select","")),await w.loadCollections())}catch{}},m=async u=>{const c=u.enabled===!1;try{(await $fetch("/api/admin/collections/update-collection",{method:"POST",body:{collectionId:u.id,updates:{enabled:c}}})).success&&await w.loadCollections()}catch{}};return te(async()=>{w.isLoaded||await w.loadCollections()}),A({editCollection:H,toggleEnabled:m,confirmDelete:R,openCreateModal:()=>C.value=!0}),(u,c)=>(i(),l("div",fe,[e("div",be,[e("div",xe,[c[6]||(c[6]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Select Collection ",-1)),e("span",pe,d(o(n))+"/"+d(o(g).length),1)]),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:c[0]||(c[0]=p=>C.value=!0)},[...c[7]||(c[7]=[e("div",{class:"i-mdi-plus"},null,-1),v(" Create New ",-1)])])]),e("div",ve,[(i(!0),l(Y,null,F(o(g),p=>(i(),l("button",{key:p.id,class:L(["px-4 py-2 rounded-xl border transition-all text-sm font-bold flex items-center gap-2",[o(S)===p.id?"bg-blue-600 text-white border-blue-600 shadow-lg shadow-blue-600/20":"bg-theme-surface border-theme-border hover:border-theme-textmuted text-theme-text",p.enabled===!1?"opacity-60":""]]),onClick:Z=>I(p.id)},[v(d(p.name)+" ",1),p.enabled===!1?(i(),l("div",he)):h("",!0)],10,ge))),128))]),o(C)||o(b)?(i(),l("div",ye,[e("div",_e,[e("div",we,[e("h3",ke,d(o(b)?"Edit Collection":"Create New Collection"),1),e("button",{class:"p-2 hover:bg-theme-selection rounded-full transition-colors",onClick:x},[...c[8]||(c[8]=[e("div",{class:"i-mdi-close text-xl"},null,-1)])])]),e("form",{class:"p-6 space-y-4",onSubmit:J(a,["prevent"])},[e("div",null,[c[9]||(c[9]=e("label",{class:"block text-sm font-bold mb-1"},"ID (URL Slug)",-1)),N(e("input",{"onUpdate:modelValue":c[1]||(c[1]=p=>o(s).id=p),type:"text",placeholder:"e.g. charlie-chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm font-mono",disabled:!!o(b),required:""},null,8,$e),[[U,o(s).id]])]),e("div",null,[c[10]||(c[10]=e("label",{class:"block text-sm font-bold mb-1"},"Name",-1)),N(e("input",{"onUpdate:modelValue":c[2]||(c[2]=p=>o(s).name=p),type:"text",placeholder:"e.g. Charlie Chaplin",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm",required:""},null,512),[[U,o(s).name]])]),e("div",null,[c[11]||(c[11]=e("label",{class:"block text-sm font-bold mb-1"},"Description",-1)),N(e("textarea",{"onUpdate:modelValue":c[3]||(c[3]=p=>o(s).description=p),rows:"3",placeholder:"Describe this collection...",class:"w-full px-4 py-2 rounded-lg border border-theme-border bg-theme-surface text-sm"},null,512),[[U,o(s).description]])]),e("div",null,[c[13]||(c[13]=e("label",{class:"block text-sm font-bold mb-1"},"Tags",-1)),e("div",Se,[(i(!0),l(Y,null,F(o(s).tags,p=>(i(),l("div",{key:p,class:"flex items-center gap-1.5 px-3 py-1 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded-full text-sm font-medium group"},[v(d(p)+" ",1),e("button",{type:"button",class:"p-0.5 hover:bg-blue-600/20 rounded-full transition-colors",onClick:Z=>D(p)},[...c[12]||(c[12]=[e("div",{class:"i-mdi-close text-xs"},null,-1)])],8,Ce)]))),128)),e("div",Ie,[N(e("input",{"onUpdate:modelValue":c[4]||(c[4]=p=>se(r)?r.value=p:null),type:"text",placeholder:"Add tag...",class:"w-full bg-transparent border-none focus:ring-0 text-sm py-1",onKeydown:[q(J(M,["prevent"]),["enter"]),q(W,["backspace"])],onFocus:c[5]||(c[5]=p=>k.value=!0),onBlur:G},null,40,Ve),[[U,o(r)]]),o(k)&&o(Q).length>0?(i(),l("div",Ae,[(i(!0),l(Y,null,F(o(Q),p=>(i(),l("button",{key:p,type:"button",class:"w-full text-left px-4 py-2 text-sm hover:bg-theme-selection transition-colors",onMousedown:J(Z=>j(p),["prevent"])},d(p),41,Te))),128))])):h("",!0)])])]),e("div",Me,[e("button",{type:"button",class:"flex-1 px-4 py-2 border border-theme-border rounded-lg font-bold hover:bg-theme-selection transition-colors",onClick:x}," Cancel "),e("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-500 transition-colors disabled:opacity-50",disabled:o(t)},[o(t)?(i(),l("div",Ye)):(i(),l("span",Fe,d(o(b)?"Update":"Create"),1))],8,Re)])],32)])])):h("",!0)]))}}),je=Object.assign(Qe,{__name:"AdminCollectionSelector"}),Ee={class:"space-y-4"},Le={class:"flex items-center gap-4"},De={class:"relative flex-1"},Pe={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},Ne={key:0,class:"bg-blue-600 text-white px-1.5 py-0.5 rounded-full text-[10px]"},Ue={key:0,class:"flex flex-wrap items-center gap-2"},Be={key:0,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},Oe={key:1,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},ze={key:2,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},Ke={key:1,class:"bg-theme-surface border border-theme-border rounded-2xl overflow-hidden"},We={class:"p-4 border-b border-theme-border flex items-center justify-between bg-theme-bg/30"},Ge={class:"text-sm text-theme-textmuted"},He={class:"font-semibold text-theme-text"},Je={key:0,class:"text-xs"},Xe=["disabled"],Ze={key:0,class:"i-mdi-loading animate-spin"},qe={key:1,class:"i-mdi-plus-box-multiple"},et={class:"divide-y divide-theme-border"},tt={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},st=["src","alt"],ot={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},lt={class:"flex-1 min-w-0"},it={class:"flex items-center gap-2"},nt={class:"font-bold truncate"},rt={class:"text-xs text-theme-textmuted font-mono"},at={class:"text-xs text-theme-textmuted truncate"},dt={class:"flex items-center gap-2 text-[10px] text-theme-textmuted mt-0.5"},ct={class:"font-mono"},ut={key:0,class:"flex items-center gap-1"},mt={class:"font-bold text-theme-text"},ft={key:0,class:"opacity-70"},bt=["disabled","onClick"],xt={key:0,class:"i-mdi-loading animate-spin"},pt={key:2,class:"p-8 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},vt=B({__name:"AdminMovieSearch",props:{collectionId:{}},emits:["add"],setup(V,{emit:A}){const y=V,w=A,$=O(),g=K(),{filters:n,activeFiltersCount:S,hasActiveFilters:f}=z(g),{resetFilters:I}=g,C=oe(),b=_(null),t=_(""),s=_([]),r=_(!1),k=_(""),T=_(!1),Q=_(!1);ae("/",x=>{const a=window.document.activeElement,R=a?.tagName==="INPUT"||a?.tagName==="TEXTAREA";x.preventDefault(),R||b.value?.focus()}),X(()=>n.value.searchQuery,x=>{x!==t.value&&(t.value=x,x.length>=3||f.value?D():s.value=[])}),X(()=>[n.value.minRating,n.value.minYear,n.value.maxYear,n.value.minVotes,n.value.maxVotes,n.value.genres,n.value.countries,n.value.sources],()=>{(t.value.length>=3||f.value)&&D()},{deep:!0});const D=de(async()=>{const x=t.value.length>=3,a=f.value;if(!x&&!a){s.value=[];return}r.value=!0;try{const R=await $fetch("/api/admin/movies/search",{query:{q:t.value,minRating:n.value.minRating||void 0,minYear:n.value.minYear||void 0,maxYear:n.value.maxYear||void 0,minVotes:n.value.minVotes||void 0,maxVotes:n.value.maxVotes||void 0,genres:n.value.genres.join(",")||void 0,countries:n.value.countries.join(",")||void 0,sources:n.value.sources.join(",")||void 0}});s.value=R.slice(0,300)}catch{C.showToast("Search failed","error")}finally{r.value=!1}},300),W=()=>{D()},j=x=>$.isMovieInCollection(x,y.collectionId),G=async x=>{k.value=x;try{await $.addMovieToCollection(y.collectionId,x)?(C.showToast("Movie added to collection"),w("add")):C.showToast("Failed to add movie","error")}catch{C.showToast("Error adding movie","error")}finally{k.value=""}},H=async()=>{T.value=!0;let x=0,a=0;try{const R=s.value.filter(m=>!j(m.imdbId));if(R.length===0){C.showToast("All movies are already in the collection","info");return}for(const m of R)try{await $.addMovieToCollection(y.collectionId,m.imdbId)?x++:a++}catch{a++}x>0&&(C.showToast(`Added ${x} movie${x>1?"s":""} to collection`),w("add")),a>0&&C.showToast(`Failed to add ${a} movie${a>1?"s":""}`,"error")}finally{T.value=!1}};return(x,a)=>{const R=ue;return i(),l("div",Ee,[e("div",Le,[e("div",De,[a[6]||(a[6]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-theme-textmuted"},[e("div",{class:"i-mdi-magnify text-xl"})],-1)),N(e("input",{ref_key:"searchInput",ref:b,"onUpdate:modelValue":a[0]||(a[0]=m=>se(t)?t.value=m:null),type:"text",placeholder:"Search by title, director, writer, plot or IMDb ID... (or use filters below)",class:"block w-full pl-10 pr-3 py-3 border border-theme-border rounded-xl bg-theme-surface focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none",onInput:W},null,544),[[U,o(t)]]),o(r)?(i(),l("div",Pe,[...a[5]||(a[5]=[e("div",{class:"i-mdi-loading animate-spin text-blue-600"},null,-1)])])):h("",!0)]),e("button",{class:"px-4 py-3 bg-theme-surface border border-theme-border rounded-xl text-sm font-bold hover:bg-theme-selection transition-colors flex items-center gap-2",onClick:a[1]||(a[1]=m=>Q.value=!0)},[a[7]||(a[7]=e("div",{class:"i-mdi-filter-variant"},null,-1)),a[8]||(a[8]=v(" Filters ",-1)),o(S)>0?(i(),l("span",Ne,d(o(S)),1)):h("",!0)])]),o(f)?(i(),l("div",Ue,[o(n).minRating>0?(i(),l("div",Be,[a[9]||(a[9]=e("div",{class:"i-mdi-star"},null,-1)),v(" "+d(o(n).minRating)+"+ ",1)])):h("",!0),o(n).minYear>0||o(n).maxYear?(i(),l("div",Oe,[a[10]||(a[10]=e("div",{class:"i-mdi-calendar"},null,-1)),v(" "+d(o(n).minYear||1910)+" - "+d(o(n).maxYear||2025),1)])):h("",!0),o(n).minVotes>0||o(n).maxVotes?(i(),l("div",ze,[a[11]||(a[11]=e("div",{class:"i-mdi-account-group"},null,-1)),v(" "+d(o(n).minVotes.toLocaleString())+" - "+d(o(n).maxVotes?o(n).maxVotes.toLocaleString():"Any"),1)])):h("",!0),(i(!0),l(Y,null,F(o(n).genres,m=>(i(),l("div",{key:m,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[a[12]||(a[12]=e("div",{class:"i-mdi-movie-filter"},null,-1)),v(" "+d(m),1)]))),128)),(i(!0),l(Y,null,F(o(n).sources,m=>(i(),l("div",{key:m,class:"px-2 py-1 bg-blue-600/10 text-blue-600 rounded-lg text-xs font-medium flex items-center gap-1"},[a[13]||(a[13]=e("div",{class:"i-mdi-source-branch"},null,-1)),v(" "+d(m),1)]))),128)),e("button",{class:"text-xs text-theme-primary hover:underline ml-2",onClick:a[2]||(a[2]=(...m)=>o(I)&&o(I)(...m))}," Clear All ")])):h("",!0),o(s).length>0?(i(),l("div",Ke,[e("div",We,[e("div",Ge,[e("span",He,d(o(s).length),1),a[14]||(a[14]=v(" results ",-1)),o(s).length===300?(i(),l("span",Je,"(limited to 300)")):h("",!0)]),e("button",{class:L(["px-4 py-2 rounded-lg text-sm font-bold transition-all flex items-center gap-2 disabled:opacity-50",o(T)?"bg-theme-selection text-theme-textmuted cursor-wait":"bg-blue-600 hover:bg-blue-500 text-white"]),disabled:o(T)||o(k)!=="",onClick:H},[o(T)?(i(),l("div",Ze)):(i(),l("div",qe)),a[15]||(a[15]=v(" Add All to Collection ",-1))],10,Xe)]),e("div",et,[(i(!0),l(Y,null,F(o(s),m=>(i(),l("div",{key:m.imdbId,class:"p-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",tt,[m.imdbId?.startsWith("tt")?(i(),l("img",{key:0,src:("getPosterPath"in x?x.getPosterPath:o(le))(m.imdbId),alt:m.title,class:"w-full h-full object-cover",onError:a[3]||(a[3]=u=>u.target.style.display="none")},null,40,st)):(i(),l("div",ot,[...a[16]||(a[16]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",lt,[e("div",it,[e("h4",nt,d(m.title),1),e("span",rt,d(m.year),1)]),e("p",at,d(m.metadata?.Director||"Unknown Director"),1),e("div",dt,[e("span",ct,d(m.imdbId),1),m.metadata?.imdbRating?(i(),l("span",ut,[a[17]||(a[17]=e("span",{class:"opacity-50"},"•",-1)),a[18]||(a[18]=e("div",{class:"i-mdi-star text-theme-accent text-xs"},null,-1)),e("span",mt,d(m.metadata.imdbRating),1),m.metadata?.imdbVotes?(i(),l("span",ft," ("+d(("formatVotes"in x?x.formatVotes:o(ie))(m.metadata.imdbVotes))+") ",1)):h("",!0)])):h("",!0)])]),e("button",{class:L(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1.5 disabled:opacity-50",j(m.imdbId)?"bg-theme-selection text-theme-textmuted cursor-default":"bg-blue-600 hover:bg-blue-500 text-white"]),disabled:j(m.imdbId)||o(k)===m.imdbId,onClick:u=>G(m.imdbId)},[o(k)===m.imdbId?(i(),l("div",xt)):(i(),l("div",{key:1,class:L(j(m.imdbId)?"i-mdi-check":"i-mdi-plus")},null,2)),v(" "+d(j(m.imdbId)?"Added":"Add"),1)],10,bt)]))),128))])])):(o(t).length>=3||o(f))&&!o(r)?(i(),l("div",pt," No movies found"+d(o(t)?` for "${o(t)}"`:"")+d(o(f)?" with current filters":""),1)):h("",!0),E(R,{"is-open":o(Q),onClose:a[4]||(a[4]=m=>Q.value=!1)},null,8,["is-open"])])}}}),gt=Object.assign(vt,{__name:"AdminMovieSearch"}),ht={class:"space-y-4"},yt={key:0,class:"text-sm text-theme-textmuted italic p-4 bg-theme-surface border border-theme-border border-dashed rounded-xl text-center"},_t={key:1,class:"space-y-3"},wt={class:"flex items-start justify-between gap-4"},kt={class:"flex-1 space-y-2"},$t={class:"flex items-center gap-2"},St={class:"font-bold text-sm"},Ct={class:"flex flex-wrap gap-2"},It={key:0,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Vt={key:1,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},At={key:2,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Tt={key:3,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Mt={key:4,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Rt={key:5,class:"px-2 py-0.5 bg-theme-bg border border-theme-border rounded text-[10px] font-mono flex items-center gap-1"},Yt={class:"flex items-center gap-1"},Ft=["onClick"],Qt=["onClick"],jt={class:"flex justify-end pt-2"},Et=["disabled"],Lt=B({__name:"AdminSavedQueryManager",props:{collectionId:{},queries:{}},emits:["filtersApplied"],setup(V,{emit:A}){const y=V,w=A,$=O(),g=K(),{filters:n}=z(g),S=_(!1),f=async()=>{const t={field:"year",direction:"desc"},s=n.value.sort.field===t.field&&n.value.sort.direction===t.direction,r={searchQuery:n.value.searchQuery,currentPage:1,lastScrollY:0};s||(r.sort={...n.value.sort}),n.value.sources.length>0&&(r.sources=[...n.value.sources]),n.value.minRating>0&&(r.minRating=n.value.minRating),n.value.minYear>0&&(r.minYear=n.value.minYear),n.value.maxYear&&n.value.maxYear>0&&(r.maxYear=n.value.maxYear),n.value.minVotes>0&&(r.minVotes=n.value.minVotes),n.value.maxVotes&&n.value.maxVotes>0&&(r.maxVotes=n.value.maxVotes),n.value.genres.length>0&&(r.genres=[...n.value.genres]),n.value.countries.length>0&&(r.countries=[...n.value.countries]);const k={searchQuery:n.value.searchQuery,filterState:r};await $.addQueryToCollection(y.collectionId,k)},I=async t=>{confirm("Are you sure you want to remove this saved query?")&&await $.removeQueryFromCollection(y.collectionId,t)},C=t=>{g.resetFilters(),t.searchQuery&&g.setSearchQuery(t.searchQuery),t.filterState.sort&&g.setSort(t.filterState.sort),t.filterState.minRating&&g.setMinRating(t.filterState.minRating),t.filterState.minYear&&g.setMinYear(t.filterState.minYear),t.filterState.maxYear&&g.setMaxYear(t.filterState.maxYear),t.filterState.minVotes&&g.setMinVotes(t.filterState.minVotes),t.filterState.maxVotes&&g.setMaxVotes(t.filterState.maxVotes),t.filterState.genres?.forEach(s=>g.toggleGenre(s)),t.filterState.countries?.forEach(s=>g.toggleCountry(s)),t.filterState.sources?.forEach(s=>g.toggleSource(s)),w("filtersApplied")},b=async()=>{S.value=!0;try{const t=await $.refreshCollectionFromQuery(y.collectionId);t.success&&alert(`Collection refreshed! Now contains ${t.movieCount} movies.`)}finally{S.value=!1}};return(t,s)=>(i(),l("div",ht,[e("div",{class:"flex items-center justify-between"},[s[1]||(s[1]=e("label",{class:"block text-sm font-bold text-theme-textmuted uppercase tracking-wider"}," Saved Queries ",-1)),e("button",{class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-2",onClick:f},[...s[0]||(s[0]=[e("div",{class:"i-mdi-plus"},null,-1),v(" Save Current Search ",-1)])])]),!V.queries||V.queries.length===0?(i(),l("div",yt," No saved queries for this collection. ")):(i(),l("div",_t,[(i(!0),l(Y,null,F(V.queries,(r,k)=>(i(),l("div",{key:k,class:"p-4 bg-theme-surface border border-theme-border rounded-xl group hover:border-theme-textmuted transition-all"},[e("div",wt,[e("div",kt,[e("div",$t,[s[2]||(s[2]=e("div",{class:"i-mdi-magnify text-theme-textmuted"},null,-1)),e("span",St,d(r.searchQuery||"All Movies"),1)]),e("div",Ct,[r.filterState.sort?(i(),l("div",It,[s[3]||(s[3]=e("div",{class:"i-mdi-sort"},null,-1)),v(" "+d(r.filterState.sort.field)+" ("+d(r.filterState.sort.direction)+") ",1)])):h("",!0),r.filterState.minYear&&r.filterState.minYear>0||r.filterState.maxYear?(i(),l("div",Vt,[s[4]||(s[4]=e("div",{class:"i-mdi-calendar"},null,-1)),v(" "+d(r.filterState.minYear||1910)+" - "+d(r.filterState.maxYear||2025),1)])):h("",!0),r.filterState.minRating&&r.filterState.minRating>0?(i(),l("div",At,[s[5]||(s[5]=e("div",{class:"i-mdi-star"},null,-1)),v(" "+d(r.filterState.minRating)+"+ ",1)])):h("",!0),r.filterState.minVotes&&r.filterState.minVotes>0||r.filterState.maxVotes?(i(),l("div",Tt,[s[6]||(s[6]=e("div",{class:"i-mdi-account-group"},null,-1)),v(" "+d((r.filterState.minVotes||0).toLocaleString())+" - "+d(r.filterState.maxVotes?r.filterState.maxVotes.toLocaleString():"Any"),1)])):h("",!0),r.filterState.genres?.length?(i(),l("div",Mt,[s[7]||(s[7]=e("div",{class:"i-mdi-movie-filter"},null,-1)),v(" "+d(r.filterState.genres.join(", ")),1)])):h("",!0),r.filterState.sources?.length?(i(),l("div",Rt,[s[8]||(s[8]=e("div",{class:"i-mdi-source-branch"},null,-1)),v(" "+d(r.filterState.sources.join(", ")),1)])):h("",!0)])]),e("div",Yt,[e("button",{class:"p-2 hover:bg-blue-600/10 text-blue-600 rounded-lg transition-colors",title:"Apply Filters",onClick:T=>C(r)},[...s[9]||(s[9]=[e("div",{class:"i-mdi-filter-variant"},null,-1)])],8,Ft),e("button",{class:"p-2 hover:bg-red-600/10 text-red-600 rounded-lg transition-colors",title:"Remove Query",onClick:T=>I(k)},[...s[10]||(s[10]=[e("div",{class:"i-mdi-delete"},null,-1)])],8,Qt)])])]))),128))])),e("div",jt,[e("button",{class:"px-4 py-2 bg-theme-primary text-white rounded-lg text-sm font-bold transition-colors flex items-center gap-2 disabled:opacity-50",disabled:o(S)||!V.queries?.length,onClick:b},[e("div",{class:L([o(S)?"i-mdi-loading animate-spin":"i-mdi-refresh"])},null,2),s[11]||(s[11]=v(" Refresh Collection from Queries ",-1))],8,Et)])]))}}),Dt=Object.assign(Lt,{__name:"AdminSavedQueryManager"}),Pt={class:"space-y-4"},Nt={key:0,class:"p-12 flex justify-center"},Ut={key:1,class:"overflow-hidden divide-y divide-theme-border"},Bt={class:"w-12 h-16 rounded bg-theme-selection relative overflow-hidden flex-shrink-0"},Ot=["src","alt"],zt={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},Kt={class:"flex-1 min-w-0"},Wt={class:"flex items-center gap-2"},Gt={class:"font-bold truncate"},Ht={class:"text-xs text-theme-textmuted font-mono"},Jt={class:"text-xs text-theme-textmuted truncate"},Xt={class:"flex items-center gap-2 text-[10px] text-theme-textmuted mt-0.5"},Zt={class:"font-mono"},qt={key:0,class:"flex items-center gap-1"},es={class:"font-bold text-theme-text"},ts={key:0,class:"opacity-70"},ss=["disabled","onClick"],os={key:0,class:"i-mdi-loading animate-spin text-xl"},ls={key:1,class:"i-mdi-trash-can-outline text-xl"},is={key:2,class:"p-12 text-center text-theme-textmuted bg-theme-surface border border-theme-border border-dashed rounded-2xl"},ns=B({__name:"AdminCollectionMoviesList",props:{collectionId:{}},setup(V,{expose:A}){const y=V,w=O(),$=K(),g=oe(),n=_([]),S=_(!1),f=_(""),I=async()=>{if(y.collectionId){S.value=!0;try{const b=await w.getCollectionById(y.collectionId);if(!b||!b.movieIds||!b.movieIds.length){n.value=[];return}!$.allMovies.size&&!$.isLoading.movies&&await $.loadFromFile();const t=ce(b.movieIds),s=await $.fetchMoviesByIds(t);n.value=t.map(r=>s.find(k=>k.imdbId===r)).filter(r=>!!r)}catch(b){console.error("Failed to load collection movies:",b),g.showToast("Failed to load collection movies","error")}finally{S.value=!1}}},C=async b=>{if(confirm(`Remove "${b.title}" from this collection?`)){f.value=b.imdbId;try{await w.removeMovieFromCollection(y.collectionId,b.imdbId)?(g.showToast("Movie removed from collection"),await I()):g.showToast("Failed to remove movie","error")}catch{g.showToast("Error removing movie","error")}finally{f.value=""}}};return A({refresh:I}),X(()=>y.collectionId,()=>{I()},{immediate:!0}),(b,t)=>(i(),l("div",Pt,[o(S)?(i(),l("div",Nt,[...t[1]||(t[1]=[e("div",{class:"i-mdi-loading animate-spin text-4xl text-blue-600"},null,-1)])])):o(n).length>0?(i(),l("div",Ut,[(i(!0),l(Y,null,F(o(n),s=>(i(),l("div",{key:s.imdbId,class:"py-4 flex items-center gap-4 hover:bg-theme-bg/50 transition-colors"},[e("div",Bt,[s.imdbId?.startsWith("tt")?(i(),l("img",{key:0,src:("getPosterPath"in b?b.getPosterPath:o(le))(s.imdbId),alt:s.title,class:"w-full h-full object-cover",onError:t[0]||(t[0]=r=>r.target.style.display="none")},null,40,Ot)):(i(),l("div",zt,[...t[2]||(t[2]=[e("div",{class:"i-mdi-movie text-2xl"},null,-1)])]))]),e("div",Kt,[e("div",Wt,[e("h4",Gt,d(s.title),1),e("span",Ht,d(s.year),1)]),e("p",Jt,d(s.metadata?.Director||"Unknown Director"),1),e("div",Xt,[e("span",Zt,d(s.imdbId),1),s.metadata?.imdbRating?(i(),l("span",qt,[t[3]||(t[3]=e("span",{class:"opacity-50"},"•",-1)),t[4]||(t[4]=e("div",{class:"i-mdi-star text-theme-accent text-xs"},null,-1)),e("span",es,d(s.metadata.imdbRating),1),s.metadata?.imdbVotes?(i(),l("span",ts," ("+d(("formatVotes"in b?b.formatVotes:o(ie))(s.metadata.imdbVotes))+") ",1)):h("",!0)])):h("",!0)])]),e("button",{class:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Remove from collection",disabled:o(f)===s.imdbId,onClick:r=>C(s)},[o(f)===s.imdbId?(i(),l("div",os)):(i(),l("div",ls))],8,ss)]))),128))])):(i(),l("div",is,[...t[5]||(t[5]=[e("div",{class:"i-mdi-movie-off-outline text-4xl mx-auto mb-2 opacity-20"},null,-1),e("p",null,"No movies in this collection yet.",-1)])]))]))}}),rs=Object.assign(ns,{__name:"AdminCollectionMoviesList"}),as={class:"min-h-screen bg-theme-background text-theme-text p-4 md:ml-16 transition-colors duration-300"},ds={class:"max-w-7xl mx-auto space-y-8"},cs={key:0,class:"flex flex-col items-center justify-center h-[60vh] text-center"},us={key:1,class:"flex flex-col gap-8"},ms={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},fs={class:"bg-theme-surface border border-theme-border rounded-2xl p-6"},bs={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},xs={class:"space-y-8"},ps={key:0,class:"bg-theme-surface border border-theme-border rounded-2xl p-6 space-y-4"},vs={class:"flex items-start justify-between gap-4"},gs={class:"space-y-2"},hs={class:"flex items-center gap-3"},ys={class:"text-2xl font-bold"},_s={key:0,class:"px-2 py-0.5 bg-yellow-600/10 text-yellow-600 dark:text-yellow-400 border border-yellow-600/20 rounded text-xs font-bold uppercase"},ws={key:0,class:"flex flex-wrap gap-2"},ks={class:"text-theme-textmuted max-w-3xl"},$s={class:"flex items-center gap-2 text-sm font-mono text-theme-textmuted"},Ss={class:"text-theme-text"},Cs={class:"flex items-center gap-2"},Is={class:"space-y-6"},Vs={class:"space-y-6"},As={class:"bg-theme-surface border border-theme-border rounded-2xl p-6 space-y-6"},Ls=B({__name:"index",setup(V){const A=_(!1),y=_(""),w=_(null),$=_(null),g=K(),n=O(),{collections:S}=z(n),f=P(()=>y.value&&S.value.get(y.value)||null);te(async()=>{A.value=me(),A.value&&await g.loadFromFile()});const I=()=>{$.value&&$.value.refresh()},C=()=>{};return(b,t)=>{const s=ne,r=je,k=gt,T=Dt,Q=rs;return i(),l("div",as,[e("main",ds,[o(A)?(i(),l("div",us,[e("header",ms,[t[9]||(t[9]=e("div",null,[e("h1",{class:"text-3xl font-bold flex items-center gap-3"},[e("div",{class:"i-mdi-movie-edit text-blue-600"}),v(" Collection Editor ")]),e("p",{class:"text-theme-textmuted mt-1"}," Add and remove movies from collections ")],-1)),E(s,{to:"/admin",class:"px-4 py-2 text-sm bg-theme-surface border border-theme-border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"},{default:ee(()=>[...t[8]||(t[8]=[e("div",{class:"i-mdi-arrow-left"},null,-1),v(" Back to Dashboard ",-1)])]),_:1})]),e("section",fs,[E(r,{ref_key:"collectionSelector",ref:w,onSelect:t[0]||(t[0]=M=>y.value=M)},null,512)]),o(y)?(i(),l("section",bs,[e("div",xs,[o(f)?(i(),l("div",ps,[e("div",vs,[e("div",gs,[e("div",hs,[e("h2",ys,d(o(f).name),1),o(f).enabled===!1?(i(),l("span",_s," Hidden ")):h("",!0)]),o(f).tags?.length?(i(),l("div",ws,[(i(!0),l(Y,null,F(o(f).tags,M=>(i(),l("span",{key:M,class:"px-2 py-1 bg-blue-600/10 text-blue-600 dark:text-blue-400 border border-blue-600/20 rounded-lg text-xs font-medium"},d(M),1))),128))])):h("",!0),e("p",ks,d(o(f).description||"No description provided."),1),e("div",$s,[t[10]||(t[10]=e("div",{class:"i-mdi-movie text-theme-text"},null,-1)),e("span",Ss,d(o(f).movieIds.length),1),t[11]||(t[11]=v(" movies in collection ",-1))])]),e("div",Cs,[e("button",{class:L(["p-2 rounded-xl border border-theme-border hover:bg-theme-background transition-colors",o(f).enabled===!1?"text-green-600":"text-yellow-600"]),title:"Toggle Visibility",onClick:t[1]||(t[1]=M=>o(w)?.toggleEnabled(o(f)))},[e("div",{class:L([o(f).enabled===!1?"i-mdi-eye":"i-mdi-eye-off","text-xl"])},null,2)],2),e("button",{class:"p-2 rounded-xl border border-theme-border hover:bg-theme-background text-blue-600 transition-colors",title:"Edit Collection",onClick:t[2]||(t[2]=M=>o(w)?.editCollection(o(f)))},[...t[12]||(t[12]=[e("div",{class:"i-mdi-pencil text-xl"},null,-1)])]),e("button",{class:"p-2 rounded-xl border border-theme-border hover:bg-theme-background text-red-600 transition-colors",title:"Delete Collection",onClick:t[3]||(t[3]=M=>o(w)?.confirmDelete(o(f)))},[...t[13]||(t[13]=[e("div",{class:"i-mdi-delete text-xl"},null,-1)])])])])])):h("",!0),e("div",Is,[t[14]||(t[14]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-magnify text-blue-600"}),v(" Search Library ")],-1)),E(k,{"collection-id":o(y),onAdd:I},null,8,["collection-id"])])]),e("div",Vs,[e("div",As,[t[15]||(t[15]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-database-clock text-blue-600"}),v(" Dynamic Queries ")],-1)),E(T,{"collection-id":o(y),queries:o(f)?.savedQueries,onFiltersApplied:C},null,8,["collection-id","queries"])]),t[16]||(t[16]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("div",{class:"i-mdi-playlist-play text-blue-600"}),v(" Collection Movies ")],-1)),E(Q,{ref_key:"moviesList",ref:$,"collection-id":o(y)},null,8,["collection-id"])])])):h("",!0)])):(i(),l("div",cs,[t[5]||(t[5]=e("div",{class:"i-mdi-lock text-64px text-gray-300 dark:text-gray-700 mb-4"},null,-1)),t[6]||(t[6]=e("h1",{class:"text-2xl font-bold mb-2"}," Access Denied ",-1)),t[7]||(t[7]=e("p",{class:"text-theme-textmuted"}," The admin interface is only available on localhost. ",-1)),E(s,{to:"/",class:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors"},{default:ee(()=>[...t[4]||(t[4]=[v(" Back to Home ",-1)])]),_:1})]))])])}}});export{Ls as default};
