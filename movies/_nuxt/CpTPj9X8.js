import{_ as I}from"./BTlOGk9l.js";import{E as O,N as T,e as u,r as _,a8 as F,G as N,k as P,n as Y,c,I as k,z as t,a2 as y,J as z,K as W,o as l,P as $,F as j,a9 as J,aa as K,ab as U}from"./02OeVUp7.js";const h=3,q=O({__name:"MovieVirtualGrid",props:{movies:{},totalMovies:{}},emits:["load-more"],setup(H,{emit:C}){const d=H,S=C,{y:V}=T(),{height:B,width:E}=J(),i=K(U),r=u(()=>i.xl.value?6:i.lg.value?5:i.md.value?4:i.sm.value?3:2),G=u(()=>i.xl.value?"grid-cols-6":i.lg.value?"grid-cols-5":i.md.value?"grid-cols-4":i.sm.value?"grid-cols-3":"grid-cols-2"),x=_(null),{height:M}=F(x),v=u(()=>{if(M.value>0)return M.value+16;const n=E.value||1024,s=i.lg.value?n*.12:32,g=n-s,o=(r.value-1)*16,m=(g-o)/r.value*1.5;return Math.ceil(m+80+16)}),R=u(()=>Math.ceil(d.movies.length/r.value)),L=u(()=>R.value*v.value),b=_(0),f=_(null),w=()=>{if(f.value){const n=f.value.getBoundingClientRect();b.value=n.top+window.scrollY}};N(()=>{w(),window.addEventListener("resize",w)}),P(()=>{window.removeEventListener("resize",w)});const e=u(()=>{if(!d.movies||d.movies.length===0)return[];const n=Math.max(0,V.value-b.value),s=Math.max(0,Math.floor(n/v.value)-h),g=Math.min(R.value-1,Math.ceil((n+B.value)/v.value)+h),a=[];for(let o=s;o<=g;o++){const p=o*r.value,m=d.movies.slice(p,p+r.value);m.length>0&&a.push({index:o,top:o*v.value,movies:m})}return a});return Y(e,()=>{const n=Math.ceil(d.movies.length/r.value),s=e.value[e.value.length-1];s&&s.index>=n-h-1&&(window.console.log("[VirtualGrid] Load more triggered - lastVisibleRow:",s.index,"loadedRows:",n,"buffer:",h),S("load-more"))},{deep:!0}),(n,s)=>{const g=I;return l(),c("div",{ref_key:"gridRef",ref:f,class:"w-full"},[t(e).length>0&&t(e)[0]&&t(e)[0].index>0?(l(),c("div",{key:0,style:y({height:`${t(e)[0].top}px`})},null,4)):k("",!0),(l(!0),c(z,null,W(t(e),a=>(l(),c("div",{key:a.index,ref_for:!0,ref:a.index===0?o=>x.value=o:void 0,class:$(["grid gap-4 mb-4",t(G)])},[(l(!0),c(z,null,W(a.movies,o=>(l(),j(g,{key:o.imdbId,movie:o},null,8,["movie"]))),128))],2))),128)),t(e).length>0&&t(e)[t(e).length-1]?(l(),c("div",{key:1,style:y({height:`${t(L)-(t(e)[t(e).length-1].top+t(v))}px`})},null,4)):k("",!0)],512)}}}),Z=Object.assign(q,{__name:"MovieVirtualGrid"});export{Z as _};
