import{h as C}from"./DU-EsTaw.js";import{D as V}from"./cTjeiag2.js";import{G as A,h as c,p as g,z as L,H as F}from"./CKJZimam.js";const R=A("playlistStore",()=>{const a=c(null),s=c(null),d=c(!1),v=c(""),m=g(()=>a.value!==null),p=g(()=>a.value?.videos||[]),f=r=>[...r].sort((i,y)=>i.createdAt&&!y.createdAt?-1:!i.createdAt&&y.createdAt?1:i.createdAt&&y.createdAt?y.createdAt-i.createdAt:0),n=r=>({...r,videos:f(r.videos)});return{currentPlaylist:a,loading:d,error:v,hasCurrentPlaylist:m,originalCurrentPlaylist:s,currentVideos:p,loadFirstPlaylist:async()=>{try{d.value=!0,v.value="";const r=await $fetch("/index.json");if(!r.success||!r.data.length){a.value=null,s.value=null;return}const i=r.data[0],y=await $fetch(`/playlist/${i?.fileName}`),P=n(y);a.value=P,s.value=JSON.parse(JSON.stringify(P))}catch(r){console.error("Error loading first playlist:",r),v.value=r.data?.message||r.message||"Failed to load playlist",a.value=null,s.value=null}finally{d.value=!1}},setCurrentPlaylistVideos:r=>{a.value&&(a.value={...a.value,videos:r})},findVideoIndex:r=>a.value?a.value.videos.findIndex(i=>i.id===r):-1,sortVideosByCreatedAt:f}}),k=A("Player",()=>{const a=c(!1),s=c(null),d=c(0),v=c(!1),m=c(!1),p=c(!1),f=c(null),{currentVideos:n}=L(R()),b=g(()=>s.value?n.value.findIndex(o=>o.id===s.value?.id)>0:!1),w=g(()=>{if(!s.value)return!1;const t=n.value.findIndex(o=>o.id===s.value?.id);return t===-1?n.value.length>0:t<n.value.length-1}),I=t=>{s.value=t,m.value=!!t},r=t=>{a.value=t},i=t=>{v.value=t},y=t=>{f.value=t},P=()=>{!f.value||!v.value||(a.value?f.value.pauseVideo():f.value.playVideo())},h=t=>{t>=0&&t<n.value.length&&(d.value=t,s.value=n.value[t]||null)};return{isPlaying:a,currentVideo:s,currentIndex:d,isPlayerReady:v,showPlayerBar:m,isFloatingPlayerOpen:p,canPlayPrevious:b,canPlayNext:w,setCurrentVideo:I,setIsPlaying:r,setIsPlayerReady:i,setCurrentIndex:h,setYouTubePlayerInstance:y,togglePlayPause:P,previousVideo:()=>{if(!s.value)return;const t=n.value.findIndex(o=>o.id===s.value?.id);if(t>0){const o=t-1;d.value=o,s.value=n.value[o]||null}},nextVideo:()=>{if(!s.value)return;const t=n.value.findIndex(o=>o.id===s.value?.id);if(t!==-1&&t<n.value.length-1){const o=t+1;d.value=o,s.value=n.value[o]||null}else t===-1&&n.value.length>0&&(d.value=0,s.value=n.value[0]||null)},playVideo:t=>{h(t)},closePlayer:()=>{m.value=!1,p.value=!1,s.value=null,a.value=!1,v.value=!1,f.value=null},initializeGlobalPlayer:(t=0)=>{h(t),m.value=!0,p.value=!0},openFloatingPlayer:()=>{p.value=!0},closeFloatingPlayer:()=>{p.value=!1}}}),M={simple:{playPause:" ",nextTrack:"ArrowRight",previousTrack:"ArrowLeft",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"l",seekBackward:"j",focusSearch:"ctrl+k"},winamp:{playPause:"c",nextTrack:"b",previousTrack:"z",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"v",seekBackward:"c",focusSearch:"ctrl+k"},youtube:{playPause:"k",nextTrack:"n",previousTrack:"p",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"l",seekBackward:"j",focusSearch:"ctrl+k"}},K=A("userSettingsStore",()=>{const a=c({keyboardShortcutScheme:"winamp",selectedPlatforms:V}),s=c(!0),d=C("video-view-mode","list"),v=C("video-player-position",{x:100,y:100,width:320,height:240}),m=g(()=>a.value.customShortcuts?a.value.customShortcuts:M[a.value.keyboardShortcutScheme]),p=g(()=>[{value:"simple",label:"Simple (Space, Arrow Keys)"},{value:"winamp",label:"Winamp Style (X, Z, B, C, V)"},{value:"youtube",label:"YouTube Style (K, J, L, N, P)"}]),f=e=>{a.value.keyboardShortcutScheme=e,a.value.customShortcuts=void 0,r()},n=e=>{a.value.selectedPlatforms=e,r()},b=()=>{a.value={keyboardShortcutScheme:"simple",selectedPlatforms:V},r()},w=()=>{s.value=!0},I=()=>{s.value=!1},r=()=>{localStorage.setItem("userSettings",JSON.stringify(a.value))},i=()=>{try{const e=localStorage.getItem("userSettings");if(e){const l=JSON.parse(e);a.value={keyboardShortcutScheme:l.keyboardShortcutScheme||"simple",customShortcuts:l.customShortcuts,selectedPlatforms:l.selectedPlatforms||V}}}catch(e){console.warn("Failed to load user settings:",e),b()}},y=e=>{if(!s.value)return;const l=k();if(!P(e,l)&&e.ctrlKey&&e.key.toLowerCase()==="k"){e.preventDefault();const t=document.getElementById("search");t&&t.focus()}},P=(e,l)=>{const u=e.target;if(u instanceof HTMLInputElement||u instanceof HTMLTextAreaElement||u instanceof HTMLSelectElement||u?.contentEditable==="true"||u?.closest("input, textarea, select, [contenteditable]")||u?.closest("[class*='input'], [class*='select'], [class*='dropdown']")||u?.closest("[role='textbox'], [role='combobox'], [role='searchbox']")||u?.closest("[data-input], [data-multiselect]"))return!1;const t=m.value,o=e.key.toLowerCase();let S=!1;return o===t.playPause||a.value.keyboardShortcutScheme==="youtube"&&o===" "?(e.preventDefault(),l.togglePlayPause(),S=!0):o===t.nextTrack?(e.preventDefault(),l.nextVideo(),S=!0):o===t.previousTrack?(e.preventDefault(),l.previousVideo(),S=!0):(o===t.mute||o===t.volumeUp||o===t.volumeDown||o===t.seekForward||o===t.seekBackward)&&(e.preventDefault(),S=!0),S},h=()=>{document.addEventListener("keydown",y)},T=()=>{document.removeEventListener("keydown",y)},x=()=>{if(!("mediaSession"in navigator))return;const e=k();try{navigator.mediaSession.setActionHandler("play",()=>{e.youtubePlayerInstance&&e.isPlayerReady&&e.youtubePlayerInstance.playVideo()}),navigator.mediaSession.setActionHandler("pause",()=>{e.youtubePlayerInstance&&e.isPlayerReady&&e.youtubePlayerInstance.pauseVideo()}),navigator.mediaSession.setActionHandler("previoustrack",()=>{k().previousVideo()}),navigator.mediaSession.setActionHandler("nexttrack",()=>{k().nextVideo()}),navigator.mediaSession.setActionHandler("seekbackward",()=>{if(e.youtubePlayerInstance&&e.isPlayerReady){const l=e.youtubePlayerInstance.getCurrentTime();e.youtubePlayerInstance.seekTo(Math.max(0,l-10))}}),navigator.mediaSession.setActionHandler("seekforward",()=>{if(e.youtubePlayerInstance&&e.isPlayerReady){const l=e.youtubePlayerInstance.getCurrentTime();e.youtubePlayerInstance.seekTo(l+10)}})}catch{}},D=e=>{if(!("mediaSession"in navigator)||!e)return;const l=k();R(),navigator.mediaSession.metadata=new MediaMetadata({title:e.title||"Unknown Title",artist:e.artist||"Unknown Artist",album:e.album||void 0,artwork:e.thumbnail?[{src:e.thumbnail,sizes:"512x512",type:"image/jpeg"}]:void 0});try{if(l.youtubePlayerInstance&&l.isPlayerReady){const u=l.youtubePlayerInstance.getDuration(),t=l.youtubePlayerInstance.getCurrentTime()||0;u&&u>0&&navigator.mediaSession.setPositionState({duration:u,playbackRate:1,position:t})}}catch{}},E=e=>{"mediaSession"in navigator&&(navigator.mediaSession.playbackState=e)};return i(),h(),x(),{settings:F(a),shortcutsEnabled:F(s),viewMode:d,videoPlayerPosition:v,currentKeyboardShortcuts:m,availableShortcutSchemes:p,setKeyboardShortcutScheme:f,setSelectedPlatforms:n,resetToDefaults:b,loadSettings:i,saveSettings:r,handleKeyboardEvent:P,enableShortcuts:w,disableShortcuts:I,setupGlobalListeners:h,cleanupGlobalListeners:T,setupMediaSession:x,updateMediaSessionMetadata:D,updateMediaSessionPlaybackState:E}});export{R as a,k as b,K as u};
