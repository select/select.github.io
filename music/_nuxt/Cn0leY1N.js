import{H as ne,I as re,x as W,J as E,p as _,y as Y,E as F,K as q,L as oe,h as T,M as le,q as ae,s as O,N as B,g as se,O as z,z as ue}from"./CIyaTQZv.js";import{D as J}from"./D373tK42.js";function X(e,t){return ne()?(re(e,t),!0):!1}const ie=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const ce=e=>e!=null,de=Object.prototype.toString,fe=e=>de.call(e)==="[object Object]",V=()=>{};function ve(...e){if(e.length!==1)return oe(...e);const t=e[0];return typeof t=="function"?F(le(()=>({get:t,set:V}))):T(t)}function K(e,t){function n(...o){return new Promise((u,c)=>{Promise.resolve(e(()=>t.apply(this,o),{fn:t,thisArg:this,args:o})).then(u).catch(c)})}return n}const Z=e=>e();function pe(e,t={}){let n,o,u=V;const c=a=>{clearTimeout(a),u(),u=V};let v;return a=>{const d=E(e),p=E(t.maxWait);return n&&c(n),d<=0||p!==void 0&&p<=0?(o&&(c(o),o=void 0),Promise.resolve(a())):new Promise((l,m)=>{u=t.rejectOnCancel?m:l,v=a,p&&!o&&(o=setTimeout(()=>{n&&c(n),o=void 0,l(v())},p)),n=setTimeout(()=>{o&&c(o),o=void 0,l(a())},d)})}}function ye(...e){let t=0,n,o=!0,u=V,c,v,r,a,d;!ae(e[0])&&typeof e[0]=="object"?{delay:v,trailing:r=!0,leading:a=!0,rejectOnCancel:d=!1}=e[0]:[v,r=!0,a=!0,d=!1]=e;const p=()=>{n&&(clearTimeout(n),n=void 0,u(),u=V)};return m=>{const y=E(v),h=Date.now()-t,S=()=>c=m();return p(),y<=0?(t=Date.now(),S()):(h>y?(t=Date.now(),(a||!o)&&S()):r&&(c=new Promise((g,s)=>{u=d?s:g,n=setTimeout(()=>{t=Date.now(),o=!0,g(S()),p()},Math.max(0,y-h))})),!a&&!n&&(n=setTimeout(()=>o=!0,y)),o=!1,c)}}function me(e=Z,t={}){const{initialState:n="active"}=t,o=ve(n==="active");function u(){o.value=!1}function c(){o.value=!0}const v=(...r)=>{o.value&&e(...r)};return{isActive:F(o),pause:u,resume:c,eventFilter:v}}function R(e){return Array.isArray(e)?e:[e]}function he(e){return q()}function Ne(e,t=200,n={}){return K(pe(t,n),e)}function Me(e,t=200,n=!1,o=!0,u=!1){return K(ye(t,n,o,u),e)}function Se(e,t,n={}){const{eventFilter:o=Z,...u}=n;return W(e,K(o,t),u)}function ge(e,t,n={}){const{eventFilter:o,initialState:u="active",...c}=n,{eventFilter:v,pause:r,resume:a,isActive:d}=me(o,{initialState:u});return{stop:Se(e,t,{...c,eventFilter:v}),pause:r,resume:a,isActive:d}}const we=ge;function be(e,t=!0,n){he()?_(e,n):t?e():Y(e)}function Pe(e,t,n){return W(e,t,{...n,immediate:!0})}const C=ie?window:void 0;function j(e){var t;const n=E(e);return(t=n?.$el)!==null&&t!==void 0?t:n}function H(...e){const t=[],n=()=>{t.forEach(r=>r()),t.length=0},o=(r,a,d,p)=>(r.addEventListener(a,d,p),()=>r.removeEventListener(a,d,p)),u=O(()=>{const r=R(E(e[0])).filter(a=>a!=null);return r.every(a=>typeof a!="string")?r:void 0}),c=Pe(()=>{var r,a;return[(r=(a=u.value)===null||a===void 0?void 0:a.map(d=>j(d)))!==null&&r!==void 0?r:[C].filter(d=>d!=null),R(E(u.value?e[1]:e[0])),R(se(u.value?e[2]:e[1])),E(u.value?e[3]:e[2])]},([r,a,d,p])=>{if(n(),!r?.length||!a?.length||!d?.length)return;const l=fe(p)?{...p}:p;t.push(...r.flatMap(m=>a.flatMap(y=>d.map(h=>o(m,y,h,l)))))},{flush:"post"}),v=()=>{c(),n()};return X(n),v}function ke(){const e=B(!1),t=q();return t&&_(()=>{e.value=!0},t),e}function xe(e){const t=ke();return O(()=>(t.value,!!e()))}const N=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},M="__vueuse_ssr_handlers__",Te=Ae();function Ae(){return M in N||(N[M]=N[M]||{}),N[M]}function De(e,t){return Te[e]||t}function Ie(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const Ee={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},$="vueuse-storage";function G(e,t,n,o={}){var u;const{flush:c="pre",deep:v=!0,listenToStorageChanges:r=!0,writeDefaults:a=!0,mergeDefaults:d=!1,shallow:p,window:l=C,eventFilter:m,onError:y=i=>{console.error(i)},initOnMounted:h}=o,S=(p?B:T)(typeof t=="function"?t():t),g=O(()=>E(e));if(!n)try{n=De("getDefaultStorage",()=>C?.localStorage)()}catch(i){y(i)}if(!n)return S;const s=E(t),A=Ie(s),w=(u=o.serializer)!==null&&u!==void 0?u:Ee[A],{pause:P,resume:D}=we(S,i=>Q(i),{flush:c,deep:v,eventFilter:m});W(g,()=>L(),{flush:c});let k=!1;const f=i=>{h&&!k||L(i)},x=i=>{h&&!k||te(i)};l&&r&&(n instanceof Storage?H(l,"storage",f,{passive:!0}):H(l,$,x)),h?be(()=>{k=!0,L()}):L();function U(i,b){if(l){const I={key:g.value,oldValue:i,newValue:b,storageArea:n};l.dispatchEvent(n instanceof Storage?new StorageEvent("storage",I):new CustomEvent($,{detail:I}))}}function Q(i){try{const b=n.getItem(g.value);if(i==null)U(b,null),n.removeItem(g.value);else{const I=w.write(i);b!==I&&(n.setItem(g.value,I),U(b,I))}}catch(b){y(b)}}function ee(i){const b=i?i.newValue:n.getItem(g.value);if(b==null)return a&&s!=null&&n.setItem(g.value,w.write(s)),s;if(!i&&d){const I=w.read(b);return typeof d=="function"?d(I,s):A==="object"&&!Array.isArray(I)?{...s,...I}:I}else return typeof b!="string"?b:w.read(b)}function L(i){if(!(i&&i.storageArea!==n)){if(i&&i.key==null){S.value=s;return}if(!(i&&i.key!==g.value)){P();try{const b=w.write(S.value);(i===void 0||i?.newValue!==b)&&(S.value=ee(i))}catch(b){y(b)}finally{i?Y(D):D()}}}}function te(i){L(i.detail)}return S}function Re(e,t,n={}){const{root:o,rootMargin:u="0px",threshold:c=0,window:v=C,immediate:r=!0}=n,a=xe(()=>v&&"IntersectionObserver"in v),d=O(()=>R(E(e)).map(j).filter(ce));let p=V;const l=B(r),m=a.value?W(()=>[d.value,j(o),l.value],([h,S])=>{if(p(),!l.value||!h.length)return;const g=new IntersectionObserver(t,{root:j(S),rootMargin:u,threshold:c});h.forEach(s=>s&&g.observe(s)),p=()=>{g.disconnect(),p=V}},{immediate:r,flush:"post"}):V,y=()=>{p(),m(),l.value=!1};return X(y),{isSupported:a,isActive:l,pause(){p(),l.value=!1},resume(){l.value=!0},stop:y}}const Oe=z("playlistStore",()=>{const e=T(null),t=T(null),n=T(!1),o=T(""),u=O(()=>e.value!==null),c=O(()=>e.value?.videos||[]),v=l=>[...l].sort((m,y)=>m.createdAt&&!y.createdAt?-1:!m.createdAt&&y.createdAt?1:m.createdAt&&y.createdAt?y.createdAt-m.createdAt:0),r=l=>({...l,videos:v(l.videos)});return{currentPlaylist:e,loading:n,error:o,hasCurrentPlaylist:u,originalCurrentPlaylist:t,currentVideos:c,loadFirstPlaylist:async()=>{try{n.value=!0,o.value="";const l=await $fetch("/index.json");if(!l.success||!l.data.length){e.value=null,t.value=null;return}const m=l.data[0],y=await $fetch(`/playlist/${m?.fileName}`),h=r(y);e.value=h,t.value=JSON.parse(JSON.stringify(h))}catch(l){console.error("Error loading first playlist:",l),o.value=l.data?.message||l.message||"Failed to load playlist",e.value=null,t.value=null}finally{n.value=!1}},setCurrentPlaylistVideos:l=>{e.value&&(e.value={...e.value,videos:l})},findVideoIndex:l=>e.value?e.value.videos.findIndex(m=>m.id===l):-1,sortVideosByCreatedAt:v}}),Fe=z("Player",()=>{const e=T(!1),t=T(null),n=T(0),o=T(!1),u=T(!1),c=T(!1),v=T(null),{currentVideos:r}=ue(Oe()),a=O(()=>t.value?r.value.findIndex(x=>x.id===t.value?.id)>0:!1),d=O(()=>{if(!t.value)return!1;const f=r.value.findIndex(x=>x.id===t.value?.id);return f===-1?r.value.length>0:f<r.value.length-1}),p=f=>{t.value=f,u.value=!!f},l=f=>{e.value=f},m=f=>{o.value=f},y=f=>{v.value=f},h=()=>{!v.value||!o.value||(e.value?v.value.pauseVideo():v.value.playVideo())},S=f=>{f>=0&&f<r.value.length&&(n.value=f,t.value=r.value[f]||null)},g=()=>{if(!t.value)return;const f=r.value.findIndex(x=>x.id===t.value?.id);if(f>0){const x=f-1;n.value=x,t.value=r.value[x]||null}},s=()=>{if(!t.value)return;const f=r.value.findIndex(x=>x.id===t.value?.id);if(f!==-1&&f<r.value.length-1){const x=f+1;n.value=x,t.value=r.value[x]||null}else f===-1&&r.value.length>0&&(n.value=0,t.value=r.value[0]||null)},A=f=>{S(f)},w=()=>{u.value=!1,c.value=!1,t.value=null,e.value=!1,o.value=!1,v.value=null},P=(f=0)=>{S(f),u.value=!0,c.value=!0},D=()=>{c.value=!0},k=()=>{c.value=!1};return{isPlaying:F(e),currentVideo:t,currentIndex:F(n),isPlayerReady:F(o),showPlayerBar:F(u),isFloatingPlayerOpen:F(c),canPlayPrevious:a,canPlayNext:d,setCurrentVideo:p,setIsPlaying:l,setIsPlayerReady:m,setCurrentIndex:S,setYouTubePlayerInstance:y,togglePlayPause:h,previousVideo:g,nextVideo:s,playVideo:A,closePlayer:w,initializeGlobalPlayer:P,openFloatingPlayer:D,closeFloatingPlayer:k}}),Ve={simple:{playPause:" ",nextTrack:"ArrowRight",previousTrack:"ArrowLeft",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"l",seekBackward:"j",focusSearch:"ctrl+k"},winamp:{playPause:"c",nextTrack:"b",previousTrack:"z",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"v",seekBackward:"c",focusSearch:"ctrl+k"},youtube:{playPause:"k",nextTrack:"n",previousTrack:"p",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"l",seekBackward:"j",focusSearch:"ctrl+k"}},je=z("userSettingsStore",()=>{const e=T({keyboardShortcutScheme:"winamp",selectedPlatforms:J}),t=T(!0),n=G("video-view-mode","grid"),o=G("video-player-position",{x:100,y:100,width:320,height:240}),u=O(()=>e.value.customShortcuts?e.value.customShortcuts:Ve[e.value.keyboardShortcutScheme]),c=O(()=>[{value:"simple",label:"Simple (Space, Arrow Keys)"},{value:"winamp",label:"Winamp Style (X, Z, B, C, V)"},{value:"youtube",label:"YouTube Style (K, J, L, N, P)"}]),v=s=>{e.value.keyboardShortcutScheme=s,e.value.customShortcuts=void 0,l()},r=s=>{e.value.selectedPlatforms=s,l()},a=()=>{e.value={keyboardShortcutScheme:"simple",selectedPlatforms:J},l()},d=()=>{t.value=!0},p=()=>{t.value=!1},l=()=>{localStorage.setItem("userSettings",JSON.stringify(e.value))},m=()=>{try{const s=localStorage.getItem("userSettings");if(s){const A=JSON.parse(s);e.value={keyboardShortcutScheme:A.keyboardShortcutScheme||"simple",customShortcuts:A.customShortcuts,selectedPlatforms:A.selectedPlatforms||J}}}catch(s){console.warn("Failed to load user settings:",s),a()}},y=s=>{if(!t.value)return;const A=Fe();if(!h(s,A)&&s.ctrlKey&&s.key.toLowerCase()==="k"){s.preventDefault();const P=document.getElementById("search");P&&P.focus()}},h=(s,A)=>{const w=s.target;if(w instanceof HTMLInputElement||w instanceof HTMLTextAreaElement||w instanceof HTMLSelectElement||w?.contentEditable==="true"||w?.closest("input, textarea, select, [contenteditable]")||w?.closest("[class*='input'], [class*='select'], [class*='dropdown']")||w?.closest("[role='textbox'], [role='combobox'], [role='searchbox']")||w?.closest("[data-input], [data-multiselect]"))return!1;const P=u.value,D=s.key.toLowerCase();let k=!1;return D===P.playPause||e.value.keyboardShortcutScheme==="youtube"&&D===" "?(s.preventDefault(),A.togglePlayPause(),k=!0):D===P.nextTrack?(s.preventDefault(),A.nextVideo(),k=!0):D===P.previousTrack?(s.preventDefault(),A.previousVideo(),k=!0):(D===P.mute||D===P.volumeUp||D===P.volumeDown||D===P.seekForward||D===P.seekBackward)&&(s.preventDefault(),k=!0),k},S=()=>{document.addEventListener("keydown",y)},g=()=>{document.removeEventListener("keydown",y)};return m(),S(),{settings:F(e),shortcutsEnabled:F(t),viewMode:n,videoPlayerPosition:o,currentKeyboardShortcuts:u,availableShortcutSchemes:c,setKeyboardShortcutScheme:v,setSelectedPlatforms:r,resetToDefaults:a,loadSettings:m,saveSettings:l,handleKeyboardEvent:h,enableShortcuts:d,disableShortcuts:p,setupGlobalListeners:S,cleanupGlobalListeners:g}});export{Oe as a,Re as b,Ne as c,H as d,Me as e,Fe as f,je as u};
