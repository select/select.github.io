import{p as Y,y as K,E as V,x as M,G as X,H as Z,I as _,J as q,g as b,K as Q,L as ee,s as D,M as E,j as te,N as j,z as ne}from"./BffPBOTX.js";function re(e,t){return X()?(Z(e,t),!0):!1}const oe=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const ae=Object.prototype.toString,le=e=>ae.call(e)==="[object Object]",se=()=>{};function ue(...e){if(e.length!==1)return q(...e);const t=e[0];return typeof t=="function"?V(Q(()=>({get:t,set:se}))):b(t)}function ie(e,t){function n(...u){return new Promise((i,f)=>{Promise.resolve(e(()=>t.apply(this,u),{fn:t,thisArg:this,args:u})).then(i).catch(f)})}return n}const U=e=>e();function ce(e=U,t={}){const{initialState:n="active"}=t,u=ue(n==="active");function i(){u.value=!1}function f(){u.value=!0}const S=(...r)=>{u.value&&e(...r)};return{isActive:V(u),pause:i,resume:f,eventFilter:S}}function R(e){return Array.isArray(e)?e:[e]}function de(e){return _()}function fe(e,t,n={}){const{eventFilter:u=U,...i}=n;return M(e,ie(u,t),i)}function ve(e,t,n={}){const{eventFilter:u,initialState:i="active",...f}=n,{eventFilter:S,pause:r,resume:c,isActive:d}=ce(u,{initialState:i});return{stop:fe(e,t,{...f,eventFilter:S}),pause:r,resume:c,isActive:d}}const pe=ve;function ye(e,t=!0,n){de()?Y(e,n):t?e():K(e)}function me(e,t,n){return M(e,t,{...n,immediate:!0})}const C=oe?window:void 0;function he(e){var t;const n=E(e);return(t=n?.$el)!==null&&t!==void 0?t:n}function W(...e){const t=[],n=()=>{t.forEach(r=>r()),t.length=0},u=(r,c,d,g)=>(r.addEventListener(c,d,g),()=>r.removeEventListener(c,d,g)),i=D(()=>{const r=R(E(e[0])).filter(c=>c!=null);return r.every(c=>typeof c!="string")?r:void 0}),f=me(()=>{var r,c;return[(r=(c=i.value)===null||c===void 0?void 0:c.map(d=>he(d)))!==null&&r!==void 0?r:[C].filter(d=>d!=null),R(E(i.value?e[1]:e[0])),R(te(i.value?e[2]:e[1])),E(i.value?e[3]:e[2])]},([r,c,d,g])=>{if(n(),!r?.length||!c?.length||!d?.length)return;const s=le(g)?{...g}:g;t.push(...r.flatMap(y=>c.flatMap(m=>d.map(x=>u(y,m,x,s)))))},{flush:"post"}),S=()=>{f(),n()};return re(n),S}const N=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},L="__vueuse_ssr_handlers__",Se=ge();function ge(){return L in N||(N[L]=N[L]||{}),N[L]}function we(e,t){return Se[e]||t}function be(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const Pe={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},z="vueuse-storage";function B(e,t,n,u={}){var i;const{flush:f="pre",deep:S=!0,listenToStorageChanges:r=!0,writeDefaults:c=!0,mergeDefaults:d=!1,shallow:g,window:s=C,eventFilter:y,onError:m=l=>{console.error(l)},initOnMounted:x}=u,I=(g?ee:b)(typeof t=="function"?t():t),a=D(()=>E(e));if(!n)try{n=we("getDefaultStorage",()=>C?.localStorage)()}catch(l){m(l)}if(!n)return I;const v=E(t),P=be(v),p=(i=u.serializer)!==null&&i!==void 0?i:Pe[P],{pause:A,resume:k}=pe(I,l=>H(l),{flush:f,deep:S,eventFilter:y});M(a,()=>O(),{flush:f});let F=!1;const o=l=>{x&&!F||O(l)},w=l=>{x&&!F||G(l)};s&&r&&(n instanceof Storage?W(s,"storage",o,{passive:!0}):W(s,z,w)),x?ye(()=>{F=!0,O()}):O();function J(l,h){if(s){const T={key:a.value,oldValue:l,newValue:h,storageArea:n};s.dispatchEvent(n instanceof Storage?new StorageEvent("storage",T):new CustomEvent(z,{detail:T}))}}function H(l){try{const h=n.getItem(a.value);if(l==null)J(h,null),n.removeItem(a.value);else{const T=p.write(l);h!==T&&(n.setItem(a.value,T),J(h,T))}}catch(h){m(h)}}function $(l){const h=l?l.newValue:n.getItem(a.value);if(h==null)return c&&v!=null&&n.setItem(a.value,p.write(v)),v;if(!l&&d){const T=p.read(h);return typeof d=="function"?d(T,v):P==="object"&&!Array.isArray(T)?{...v,...T}:T}else return typeof h!="string"?h:p.read(h)}function O(l){if(!(l&&l.storageArea!==n)){if(l&&l.key==null){I.value=v;return}if(!(l&&l.key!==a.value)){A();try{const h=p.write(I.value);(l===void 0||l?.newValue!==h)&&(I.value=$(l))}catch(h){m(h)}finally{l?K(k):k()}}}}function G(l){O(l.detail)}return I}const ke=j("playlistStore",()=>{const e=b(null),t=b(null),n=b(!1),u=b(""),i=D(()=>e.value!==null),f=D(()=>e.value?.videos||[]),S=s=>[...s].sort((y,m)=>y.createdAt&&!m.createdAt?-1:!y.createdAt&&m.createdAt?1:y.createdAt&&m.createdAt?m.createdAt-y.createdAt:0),r=s=>({...s,videos:S(s.videos)});return{currentPlaylist:e,loading:n,error:u,hasCurrentPlaylist:i,originalCurrentPlaylist:t,currentVideos:f,loadFirstPlaylist:async()=>{try{n.value=!0,u.value="";const s=await $fetch("/index.json");if(!s.success||!s.data.length){e.value=null,t.value=null;return}const y=s.data[0],m=await $fetch(`/playlist/${y?.fileName}`),x=r(m);e.value=x,t.value=JSON.parse(JSON.stringify(x))}catch(s){console.error("Error loading first playlist:",s),u.value=s.data?.message||s.message||"Failed to load playlist",e.value=null,t.value=null}finally{n.value=!1}},setCurrentPlaylistVideos:s=>{e.value&&(e.value={...e.value,videos:s})},findVideoIndex:s=>e.value?e.value.videos.findIndex(y=>y.id===s):-1,sortVideosByCreatedAt:S}}),xe=j("Player",()=>{const e=b(!1),t=b(null),n=b(0),u=b(!1),i=b(!1),f=b(!1),S=b(null),{currentVideos:r}=ne(ke()),c=D(()=>t.value?r.value.findIndex(w=>w.id===t.value?.id)>0:!1),d=D(()=>{if(!t.value)return!1;const o=r.value.findIndex(w=>w.id===t.value?.id);return o===-1?r.value.length>0:o<r.value.length-1}),g=o=>{t.value=o,i.value=!!o},s=o=>{e.value=o},y=o=>{u.value=o},m=o=>{S.value=o},x=()=>{const o=S.value;!o||!u.value||(e.value?o.pauseVideo():o.playVideo())},I=o=>{o>=0&&o<r.value.length&&(n.value=o,t.value=r.value[o]||null)},a=()=>{if(!t.value)return;const o=r.value.findIndex(w=>w.id===t.value?.id);if(o>0){const w=o-1;n.value=w,t.value=r.value[w]||null}},v=()=>{if(!t.value)return;const o=r.value.findIndex(w=>w.id===t.value?.id);if(o!==-1&&o<r.value.length-1){const w=o+1;n.value=w,t.value=r.value[w]||null}else o===-1&&r.value.length>0&&(n.value=0,t.value=r.value[0]||null)},P=o=>{I(o)},p=()=>{i.value=!1,f.value=!1,t.value=null,e.value=!1,u.value=!1,S.value=null},A=(o=0)=>{I(o),i.value=!0,f.value=!0},k=()=>{f.value=!0},F=()=>{f.value=!1};return{isPlaying:V(e),currentVideo:t,currentIndex:V(n),isPlayerReady:V(u),showPlayerBar:V(i),isFloatingPlayerOpen:V(f),canPlayPrevious:c,canPlayNext:d,setCurrentVideo:g,setIsPlaying:s,setIsPlayerReady:y,setCurrentIndex:I,setYouTubePlayerInstance:m,togglePlayPause:x,previousVideo:a,nextVideo:v,playVideo:P,closePlayer:p,initializeGlobalPlayer:A,openFloatingPlayer:k,closeFloatingPlayer:F}}),Ae={simple:{playPause:" ",nextTrack:"ArrowRight",previousTrack:"ArrowLeft",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"l",seekBackward:"j",focusSearch:"ctrl+k"},winamp:{playPause:"x",nextTrack:"b",previousTrack:"z",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"v",seekBackward:"c",focusSearch:"ctrl+k"},youtube:{playPause:"k",nextTrack:"n",previousTrack:"p",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"l",seekBackward:"j",focusSearch:"ctrl+k"}},Te=j("userSettingsStore",()=>{const e=b({keyboardShortcutScheme:"winamp"}),t=b(!0),n=B("video-view-mode","grid"),u=B("video-player-position",{x:100,y:100,width:320,height:240}),i=D(()=>e.value.customShortcuts?e.value.customShortcuts:Ae[e.value.keyboardShortcutScheme]),f=D(()=>[{value:"simple",label:"Simple (Space, Arrow Keys)"},{value:"winamp",label:"Winamp Style (X, Z, B, C, V)"},{value:"youtube",label:"YouTube Style (K, J, L, N, P)"}]),S=a=>{e.value.keyboardShortcutScheme=a,e.value.customShortcuts=void 0,g()},r=()=>{e.value={keyboardShortcutScheme:"simple"},g()},c=()=>{t.value=!0},d=()=>{t.value=!1},g=()=>{localStorage.setItem("userSettings",JSON.stringify(e.value))},s=()=>{try{const a=localStorage.getItem("userSettings");if(a){const v=JSON.parse(a);e.value={keyboardShortcutScheme:v.keyboardShortcutScheme||"simple",customShortcuts:v.customShortcuts}}}catch(a){console.warn("Failed to load user settings:",a),r()}},y=a=>{if(!t.value)return;const v=xe();if(!m(a,v)&&a.ctrlKey&&a.key.toLowerCase()==="k"){a.preventDefault();const p=document.getElementById("search");p&&p.focus()}},m=(a,v)=>{const P=a.target;if(P instanceof HTMLInputElement||P instanceof HTMLTextAreaElement||P instanceof HTMLSelectElement||P?.contentEditable==="true"||P?.closest("input, textarea, select, [contenteditable]")||P?.closest("[class*='input'], [class*='select'], [class*='dropdown']")||P?.closest("[role='textbox'], [role='combobox'], [role='searchbox']")||P?.closest("[data-input], [data-multiselect]"))return!1;const p=i.value,A=a.key.toLowerCase();let k=!1;return A===p.playPause||e.value.keyboardShortcutScheme==="youtube"&&A===" "?(a.preventDefault(),v.setIsPlaying(!v.isPlaying),k=!0):A===p.nextTrack?(a.preventDefault(),v.nextVideo(),k=!0):A===p.previousTrack?(a.preventDefault(),v.previousVideo(),k=!0):(A===p.mute||A===p.volumeUp||A===p.volumeDown||A===p.seekForward||A===p.seekBackward)&&(a.preventDefault(),k=!0),k},x=()=>{document.addEventListener("keydown",y)},I=()=>{document.removeEventListener("keydown",y)};return s(),x(),{settings:V(e),shortcutsEnabled:V(t),viewMode:n,videoPlayerPosition:u,currentKeyboardShortcuts:i,availableShortcutSchemes:f,setKeyboardShortcutScheme:S,resetToDefaults:r,loadSettings:s,saveSettings:g,handleKeyboardEvent:m,enableShortcuts:c,disableShortcuts:d,setupGlobalListeners:x,cleanupGlobalListeners:I}});export{ke as a,xe as b,Te as u};
