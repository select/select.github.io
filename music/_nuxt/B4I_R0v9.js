import{p as _,y as U,E as D,x as J,G as X,H as Z,I as q,J as Q,h as P,K as ee,L as te,s as V,M as F,g as ne,N as j,z as re}from"./CarEuZ8t.js";import{D as R}from"./Cjlxa7Tx.js";function oe(e,t){return X()?(Z(e,t),!0):!1}const ae=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const le=Object.prototype.toString,se=e=>le.call(e)==="[object Object]",ue=()=>{};function ie(...e){if(e.length!==1)return Q(...e);const t=e[0];return typeof t=="function"?D(ee(()=>({get:t,set:ue}))):P(t)}function ce(e,t){function n(...u){return new Promise((i,f)=>{Promise.resolve(e(()=>t.apply(this,u),{fn:t,thisArg:this,args:u})).then(i).catch(f)})}return n}const H=e=>e();function de(e=H,t={}){const{initialState:n="active"}=t,u=ie(n==="active");function i(){u.value=!1}function f(){u.value=!0}const h=(...r)=>{u.value&&e(...r)};return{isActive:D(u),pause:i,resume:f,eventFilter:h}}function M(e){return Array.isArray(e)?e:[e]}function fe(e){return q()}function ve(e,t,n={}){const{eventFilter:u=H,...i}=n;return J(e,ce(u,t),i)}function pe(e,t,n={}){const{eventFilter:u,initialState:i="active",...f}=n,{eventFilter:h,pause:r,resume:c,isActive:d}=de(u,{initialState:i});return{stop:ve(e,t,{...f,eventFilter:h}),pause:r,resume:c,isActive:d}}const ye=pe;function me(e,t=!0,n){fe()?_(e,n):t?e():U(e)}function he(e,t,n){return J(e,t,{...n,immediate:!0})}const C=ae?window:void 0;function Se(e){var t;const n=F(e);return(t=n?.$el)!==null&&t!==void 0?t:n}function z(...e){const t=[],n=()=>{t.forEach(r=>r()),t.length=0},u=(r,c,d,x)=>(r.addEventListener(c,d,x),()=>r.removeEventListener(c,d,x)),i=V(()=>{const r=M(F(e[0])).filter(c=>c!=null);return r.every(c=>typeof c!="string")?r:void 0}),f=he(()=>{var r,c;return[(r=(c=i.value)===null||c===void 0?void 0:c.map(d=>Se(d)))!==null&&r!==void 0?r:[C].filter(d=>d!=null),M(F(i.value?e[1]:e[0])),M(ne(i.value?e[2]:e[1])),F(i.value?e[3]:e[2])]},([r,c,d,x])=>{if(n(),!r?.length||!c?.length||!d?.length)return;const s=se(x)?{...x}:x;t.push(...r.flatMap(v=>c.flatMap(p=>d.map(A=>u(v,p,A,s)))))},{flush:"post"}),h=()=>{f(),n()};return oe(n),h}const L=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},N="__vueuse_ssr_handlers__",ge=we();function we(){return N in L||(L[N]=L[N]||{}),L[N]}function be(e,t){return ge[e]||t}function Pe(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const ke={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},B="vueuse-storage";function K(e,t,n,u={}){var i;const{flush:f="pre",deep:h=!0,listenToStorageChanges:r=!0,writeDefaults:c=!0,mergeDefaults:d=!1,shallow:x,window:s=C,eventFilter:v,onError:p=l=>{console.error(l)},initOnMounted:A}=u,E=(x?te:P)(typeof t=="function"?t():t),I=V(()=>F(e));if(!n)try{n=be("getDefaultStorage",()=>C?.localStorage)()}catch(l){p(l)}if(!n)return E;const a=F(t),S=Pe(a),y=(i=u.serializer)!==null&&i!==void 0?i:ke[S],{pause:g,resume:k}=ye(E,l=>$(l),{flush:f,deep:h,eventFilter:v});J(I,()=>O(),{flush:f});let w=!1;const o=l=>{A&&!w||O(l)},b=l=>{A&&!w||Y(l)};s&&r&&(n instanceof Storage?z(s,"storage",o,{passive:!0}):z(s,B,b)),A?me(()=>{w=!0,O()}):O();function W(l,m){if(s){const T={key:I.value,oldValue:l,newValue:m,storageArea:n};s.dispatchEvent(n instanceof Storage?new StorageEvent("storage",T):new CustomEvent(B,{detail:T}))}}function $(l){try{const m=n.getItem(I.value);if(l==null)W(m,null),n.removeItem(I.value);else{const T=y.write(l);m!==T&&(n.setItem(I.value,T),W(m,T))}}catch(m){p(m)}}function G(l){const m=l?l.newValue:n.getItem(I.value);if(m==null)return c&&a!=null&&n.setItem(I.value,y.write(a)),a;if(!l&&d){const T=y.read(m);return typeof d=="function"?d(T,a):S==="object"&&!Array.isArray(T)?{...a,...T}:T}else return typeof m!="string"?m:y.read(m)}function O(l){if(!(l&&l.storageArea!==n)){if(l&&l.key==null){E.value=a;return}if(!(l&&l.key!==I.value)){g();try{const m=y.write(E.value);(l===void 0||l?.newValue!==m)&&(E.value=G(l))}catch(m){p(m)}finally{l?U(k):k()}}}}function Y(l){O(l.detail)}return E}const xe=j("playlistStore",()=>{const e=P(null),t=P(null),n=P(!1),u=P(""),i=V(()=>e.value!==null),f=V(()=>e.value?.videos||[]),h=s=>[...s].sort((v,p)=>v.createdAt&&!p.createdAt?-1:!v.createdAt&&p.createdAt?1:v.createdAt&&p.createdAt?p.createdAt-v.createdAt:0),r=s=>({...s,videos:h(s.videos)});return{currentPlaylist:e,loading:n,error:u,hasCurrentPlaylist:i,originalCurrentPlaylist:t,currentVideos:f,loadFirstPlaylist:async()=>{try{n.value=!0,u.value="";const s=await $fetch("/index.json");if(!s.success||!s.data.length){e.value=null,t.value=null;return}const v=s.data[0],p=await $fetch(`/playlist/${v?.fileName}`),A=r(p);e.value=A,t.value=JSON.parse(JSON.stringify(A))}catch(s){console.error("Error loading first playlist:",s),u.value=s.data?.message||s.message||"Failed to load playlist",e.value=null,t.value=null}finally{n.value=!1}},setCurrentPlaylistVideos:s=>{e.value&&(e.value={...e.value,videos:s})},findVideoIndex:s=>e.value?e.value.videos.findIndex(v=>v.id===s):-1,sortVideosByCreatedAt:h}}),Ae=j("Player",()=>{const e=P(!1),t=P(null),n=P(0),u=P(!1),i=P(!1),f=P(!1),h=P(null),{currentVideos:r}=re(xe()),c=V(()=>t.value?r.value.findIndex(b=>b.id===t.value?.id)>0:!1),d=V(()=>{if(!t.value)return!1;const o=r.value.findIndex(b=>b.id===t.value?.id);return o===-1?r.value.length>0:o<r.value.length-1}),x=o=>{t.value=o,i.value=!!o},s=o=>{e.value=o},v=o=>{u.value=o},p=o=>{h.value=o},A=()=>{const o=h.value;!o||!u.value||(e.value?o.pauseVideo():o.playVideo())},E=o=>{o>=0&&o<r.value.length&&(n.value=o,t.value=r.value[o]||null)},I=()=>{if(!t.value)return;const o=r.value.findIndex(b=>b.id===t.value?.id);if(o>0){const b=o-1;n.value=b,t.value=r.value[b]||null}},a=()=>{if(!t.value)return;const o=r.value.findIndex(b=>b.id===t.value?.id);if(o!==-1&&o<r.value.length-1){const b=o+1;n.value=b,t.value=r.value[b]||null}else o===-1&&r.value.length>0&&(n.value=0,t.value=r.value[0]||null)},S=o=>{E(o)},y=()=>{i.value=!1,f.value=!1,t.value=null,e.value=!1,u.value=!1,h.value=null},g=(o=0)=>{E(o),i.value=!0,f.value=!0},k=()=>{f.value=!0},w=()=>{f.value=!1};return{isPlaying:D(e),currentVideo:t,currentIndex:D(n),isPlayerReady:D(u),showPlayerBar:D(i),isFloatingPlayerOpen:D(f),canPlayPrevious:c,canPlayNext:d,setCurrentVideo:x,setIsPlaying:s,setIsPlayerReady:v,setCurrentIndex:E,setYouTubePlayerInstance:p,togglePlayPause:A,previousVideo:I,nextVideo:a,playVideo:S,closePlayer:y,initializeGlobalPlayer:g,openFloatingPlayer:k,closeFloatingPlayer:w}}),Ee={simple:{playPause:" ",nextTrack:"ArrowRight",previousTrack:"ArrowLeft",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"l",seekBackward:"j",focusSearch:"ctrl+k"},winamp:{playPause:"x",nextTrack:"b",previousTrack:"z",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"v",seekBackward:"c",focusSearch:"ctrl+k"},youtube:{playPause:"k",nextTrack:"n",previousTrack:"p",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"l",seekBackward:"j",focusSearch:"ctrl+k"}},De=j("userSettingsStore",()=>{const e=P({keyboardShortcutScheme:"winamp",selectedPlatforms:R}),t=P(!0),n=K("video-view-mode","grid"),u=K("video-player-position",{x:100,y:100,width:320,height:240}),i=V(()=>e.value.customShortcuts?e.value.customShortcuts:Ee[e.value.keyboardShortcutScheme]),f=V(()=>[{value:"simple",label:"Simple (Space, Arrow Keys)"},{value:"winamp",label:"Winamp Style (X, Z, B, C, V)"},{value:"youtube",label:"YouTube Style (K, J, L, N, P)"}]),h=a=>{e.value.keyboardShortcutScheme=a,e.value.customShortcuts=void 0,s()},r=a=>{e.value.selectedPlatforms=a,s()},c=()=>{e.value={keyboardShortcutScheme:"simple",selectedPlatforms:R},s()},d=()=>{t.value=!0},x=()=>{t.value=!1},s=()=>{localStorage.setItem("userSettings",JSON.stringify(e.value))},v=()=>{try{const a=localStorage.getItem("userSettings");if(a){const S=JSON.parse(a);e.value={keyboardShortcutScheme:S.keyboardShortcutScheme||"simple",customShortcuts:S.customShortcuts,selectedPlatforms:S.selectedPlatforms||R}}}catch(a){console.warn("Failed to load user settings:",a),c()}},p=a=>{if(!t.value)return;const S=Ae();if(!A(a,S)&&a.ctrlKey&&a.key.toLowerCase()==="k"){a.preventDefault();const g=document.getElementById("search");g&&g.focus()}},A=(a,S)=>{const y=a.target;if(y instanceof HTMLInputElement||y instanceof HTMLTextAreaElement||y instanceof HTMLSelectElement||y?.contentEditable==="true"||y?.closest("input, textarea, select, [contenteditable]")||y?.closest("[class*='input'], [class*='select'], [class*='dropdown']")||y?.closest("[role='textbox'], [role='combobox'], [role='searchbox']")||y?.closest("[data-input], [data-multiselect]"))return!1;const g=i.value,k=a.key.toLowerCase();let w=!1;return k===g.playPause||e.value.keyboardShortcutScheme==="youtube"&&k===" "?(a.preventDefault(),S.setIsPlaying(!S.isPlaying),w=!0):k===g.nextTrack?(a.preventDefault(),S.nextVideo(),w=!0):k===g.previousTrack?(a.preventDefault(),S.previousVideo(),w=!0):(k===g.mute||k===g.volumeUp||k===g.volumeDown||k===g.seekForward||k===g.seekBackward)&&(a.preventDefault(),w=!0),w},E=()=>{document.addEventListener("keydown",p)},I=()=>{document.removeEventListener("keydown",p)};return v(),E(),{settings:D(e),shortcutsEnabled:D(t),viewMode:n,videoPlayerPosition:u,currentKeyboardShortcuts:i,availableShortcutSchemes:f,setKeyboardShortcutScheme:h,setSelectedPlatforms:r,resetToDefaults:c,loadSettings:v,saveSettings:s,handleKeyboardEvent:A,enableShortcuts:d,disableShortcuts:x,setupGlobalListeners:E,cleanupGlobalListeners:I}});export{xe as a,Ae as b,De as u};
