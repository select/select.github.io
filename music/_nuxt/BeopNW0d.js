import{G as ne,H as re,x as W,I as E,p as _,y as Y,J as j,K as q,L as oe,h as k,M as le,q as ae,s as V,N as z,g as se,O as B,z as ue}from"./Cq9Pw63a.js";import{D as J}from"./X3sewxOY.js";function X(e,t){return ne()?(re(e,t),!0):!1}const ie=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const ce=e=>e!=null,de=Object.prototype.toString,fe=e=>de.call(e)==="[object Object]",F=()=>{};function ve(...e){if(e.length!==1)return oe(...e);const t=e[0];return typeof t=="function"?j(le(()=>({get:t,set:F}))):k(t)}function K(e,t){function n(...o){return new Promise((s,c)=>{Promise.resolve(e(()=>t.apply(this,o),{fn:t,thisArg:this,args:o})).then(s).catch(c)})}return n}const Z=e=>e();function pe(e,t={}){let n,o,s=F;const c=a=>{clearTimeout(a),s(),s=F};let v;return a=>{const d=E(e),p=E(t.maxWait);return n&&c(n),d<=0||p!==void 0&&p<=0?(o&&(c(o),o=void 0),Promise.resolve(a())):new Promise((l,m)=>{s=t.rejectOnCancel?m:l,v=a,p&&!o&&(o=setTimeout(()=>{n&&c(n),o=void 0,l(v())},p)),n=setTimeout(()=>{o&&c(o),o=void 0,l(a())},d)})}}function ye(...e){let t=0,n,o=!0,s=F,c,v,r,a,d;!ae(e[0])&&typeof e[0]=="object"?{delay:v,trailing:r=!0,leading:a=!0,rejectOnCancel:d=!1}=e[0]:[v,r=!0,a=!0,d=!1]=e;const p=()=>{n&&(clearTimeout(n),n=void 0,s(),s=F)};return m=>{const y=E(v),h=Date.now()-t,S=()=>c=m();return p(),y<=0?(t=Date.now(),S()):(h>y?(t=Date.now(),(a||!o)&&S()):r&&(c=new Promise((g,u)=>{s=d?u:g,n=setTimeout(()=>{t=Date.now(),o=!0,g(S()),p()},Math.max(0,y-h))})),!a&&!n&&(n=setTimeout(()=>o=!0,y)),o=!1,c)}}function me(e=Z,t={}){const{initialState:n="active"}=t,o=ve(n==="active");function s(){o.value=!1}function c(){o.value=!0}const v=(...r)=>{o.value&&e(...r)};return{isActive:j(o),pause:s,resume:c,eventFilter:v}}function M(e){return Array.isArray(e)?e:[e]}function he(e){return q()}function Ne(e,t=200,n={}){return K(pe(t,n),e)}function Me(e,t=200,n=!1,o=!0,s=!1){return K(ye(t,n,o,s),e)}function Se(e,t,n={}){const{eventFilter:o=Z,...s}=n;return W(e,K(o,t),s)}function ge(e,t,n={}){const{eventFilter:o,initialState:s="active",...c}=n,{eventFilter:v,pause:r,resume:a,isActive:d}=me(o,{initialState:s});return{stop:Se(e,t,{...c,eventFilter:v}),pause:r,resume:a,isActive:d}}const we=ge;function be(e,t=!0,n){he()?_(e,n):t?e():Y(e)}function Pe(e,t,n){return W(e,t,{...n,immediate:!0})}const O=ie?window:void 0;function R(e){var t;const n=E(e);return(t=n?.$el)!==null&&t!==void 0?t:n}function G(...e){const t=[],n=()=>{t.forEach(r=>r()),t.length=0},o=(r,a,d,p)=>(r.addEventListener(a,d,p),()=>r.removeEventListener(a,d,p)),s=V(()=>{const r=M(E(e[0])).filter(a=>a!=null);return r.every(a=>typeof a!="string")?r:void 0}),c=Pe(()=>{var r,a;return[(r=(a=s.value)===null||a===void 0?void 0:a.map(d=>R(d)))!==null&&r!==void 0?r:[O].filter(d=>d!=null),M(E(s.value?e[1]:e[0])),M(se(s.value?e[2]:e[1])),E(s.value?e[3]:e[2])]},([r,a,d,p])=>{if(n(),!r?.length||!a?.length||!d?.length)return;const l=fe(p)?{...p}:p;t.push(...r.flatMap(m=>a.flatMap(y=>d.map(h=>o(m,y,h,l)))))},{flush:"post"}),v=()=>{c(),n()};return X(n),v}function ke(){const e=z(!1),t=q();return t&&_(()=>{e.value=!0},t),e}function xe(e){const t=ke();return V(()=>(t.value,!!e()))}const L=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},N="__vueuse_ssr_handlers__",Te=Ae();function Ae(){return N in L||(L[N]=L[N]||{}),L[N]}function De(e,t){return Te[e]||t}function Ie(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const Ee={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},H="vueuse-storage";function $(e,t,n,o={}){var s;const{flush:c="pre",deep:v=!0,listenToStorageChanges:r=!0,writeDefaults:a=!0,mergeDefaults:d=!1,shallow:p,window:l=O,eventFilter:m,onError:y=i=>{console.error(i)},initOnMounted:h}=o,S=(p?z:k)(typeof t=="function"?t():t),g=V(()=>E(e));if(!n)try{n=De("getDefaultStorage",()=>O?.localStorage)()}catch(i){y(i)}if(!n)return S;const u=E(t),A=Ie(u),b=(s=o.serializer)!==null&&s!==void 0?s:Ee[A],{pause:x,resume:D}=we(S,i=>Q(i),{flush:c,deep:v,eventFilter:m});W(g,()=>C(),{flush:c});let T=!1;const f=i=>{h&&!T||C(i)},P=i=>{h&&!T||te(i)};l&&r&&(n instanceof Storage?G(l,"storage",f,{passive:!0}):G(l,H,P)),h?be(()=>{T=!0,C()}):C();function U(i,w){if(l){const I={key:g.value,oldValue:i,newValue:w,storageArea:n};l.dispatchEvent(n instanceof Storage?new StorageEvent("storage",I):new CustomEvent(H,{detail:I}))}}function Q(i){try{const w=n.getItem(g.value);if(i==null)U(w,null),n.removeItem(g.value);else{const I=b.write(i);w!==I&&(n.setItem(g.value,I),U(w,I))}}catch(w){y(w)}}function ee(i){const w=i?i.newValue:n.getItem(g.value);if(w==null)return a&&u!=null&&n.setItem(g.value,b.write(u)),u;if(!i&&d){const I=b.read(w);return typeof d=="function"?d(I,u):A==="object"&&!Array.isArray(I)?{...u,...I}:I}else return typeof w!="string"?w:b.read(w)}function C(i){if(!(i&&i.storageArea!==n)){if(i&&i.key==null){S.value=u;return}if(!(i&&i.key!==g.value)){x();try{const w=b.write(S.value);(i===void 0||i?.newValue!==w)&&(S.value=ee(i))}catch(w){y(w)}finally{i?Y(D):D()}}}}function te(i){C(i.detail)}return S}function Re(e,t,n={}){const{root:o,rootMargin:s="0px",threshold:c=0,window:v=O,immediate:r=!0}=n,a=xe(()=>v&&"IntersectionObserver"in v),d=V(()=>M(E(e)).map(R).filter(ce));let p=F;const l=z(r),m=a.value?W(()=>[d.value,R(o),l.value],([h,S])=>{if(p(),!l.value||!h.length)return;const g=new IntersectionObserver(t,{root:R(S),rootMargin:s,threshold:c});h.forEach(u=>u&&g.observe(u)),p=()=>{g.disconnect(),p=F}},{immediate:r,flush:"post"}):F,y=()=>{p(),m(),l.value=!1};return X(y),{isSupported:a,isActive:l,pause(){p(),l.value=!1},resume(){l.value=!0},stop:y}}const Ve=B("playlistStore",()=>{const e=k(null),t=k(null),n=k(!1),o=k(""),s=V(()=>e.value!==null),c=V(()=>e.value?.videos||[]),v=l=>[...l].sort((m,y)=>m.createdAt&&!y.createdAt?-1:!m.createdAt&&y.createdAt?1:m.createdAt&&y.createdAt?y.createdAt-m.createdAt:0),r=l=>({...l,videos:v(l.videos)});return{currentPlaylist:e,loading:n,error:o,hasCurrentPlaylist:s,originalCurrentPlaylist:t,currentVideos:c,loadFirstPlaylist:async()=>{try{n.value=!0,o.value="";const l=await $fetch("/index.json");if(!l.success||!l.data.length){e.value=null,t.value=null;return}const m=l.data[0],y=await $fetch(`/playlist/${m?.fileName}`),h=r(y);e.value=h,t.value=JSON.parse(JSON.stringify(h))}catch(l){console.error("Error loading first playlist:",l),o.value=l.data?.message||l.message||"Failed to load playlist",e.value=null,t.value=null}finally{n.value=!1}},setCurrentPlaylistVideos:l=>{e.value&&(e.value={...e.value,videos:l})},findVideoIndex:l=>e.value?e.value.videos.findIndex(m=>m.id===l):-1,sortVideosByCreatedAt:v}}),Fe=B("Player",()=>{const e=k(!1),t=k(null),n=k(0),o=k(!1),s=k(!1),c=k(!1),v=k(null),{currentVideos:r}=ue(Ve()),a=V(()=>t.value?r.value.findIndex(P=>P.id===t.value?.id)>0:!1),d=V(()=>{if(!t.value)return!1;const f=r.value.findIndex(P=>P.id===t.value?.id);return f===-1?r.value.length>0:f<r.value.length-1}),p=f=>{t.value=f,s.value=!!f},l=f=>{e.value=f},m=f=>{o.value=f},y=f=>{v.value=f},h=()=>{!v.value||!o.value||(e.value?v.value.pauseVideo():v.value.playVideo())},S=f=>{f>=0&&f<r.value.length&&(n.value=f,t.value=r.value[f]||null)};return{isPlaying:e,currentVideo:t,currentIndex:n,isPlayerReady:o,showPlayerBar:s,isFloatingPlayerOpen:c,canPlayPrevious:a,canPlayNext:d,setCurrentVideo:p,setIsPlaying:l,setIsPlayerReady:m,setCurrentIndex:S,setYouTubePlayerInstance:y,togglePlayPause:h,previousVideo:()=>{if(!t.value)return;const f=r.value.findIndex(P=>P.id===t.value?.id);if(f>0){const P=f-1;n.value=P,t.value=r.value[P]||null}},nextVideo:()=>{if(!t.value)return;const f=r.value.findIndex(P=>P.id===t.value?.id);if(f!==-1&&f<r.value.length-1){const P=f+1;n.value=P,t.value=r.value[P]||null}else f===-1&&r.value.length>0&&(n.value=0,t.value=r.value[0]||null)},playVideo:f=>{S(f)},closePlayer:()=>{s.value=!1,c.value=!1,t.value=null,e.value=!1,o.value=!1,v.value=null},initializeGlobalPlayer:(f=0)=>{S(f),s.value=!0,c.value=!0},openFloatingPlayer:()=>{c.value=!0},closeFloatingPlayer:()=>{c.value=!1}}}),Oe={simple:{playPause:" ",nextTrack:"ArrowRight",previousTrack:"ArrowLeft",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"l",seekBackward:"j",focusSearch:"ctrl+k"},winamp:{playPause:"c",nextTrack:"b",previousTrack:"z",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"v",seekBackward:"c",focusSearch:"ctrl+k"},youtube:{playPause:"k",nextTrack:"n",previousTrack:"p",volumeUp:"ArrowUp",volumeDown:"ArrowDown",mute:"m",seekForward:"l",seekBackward:"j",focusSearch:"ctrl+k"}},je=B("userSettingsStore",()=>{const e=k({keyboardShortcutScheme:"winamp",selectedPlatforms:J}),t=k(!0),n=$("video-view-mode","grid"),o=$("video-player-position",{x:100,y:100,width:320,height:240}),s=V(()=>e.value.customShortcuts?e.value.customShortcuts:Oe[e.value.keyboardShortcutScheme]),c=V(()=>[{value:"simple",label:"Simple (Space, Arrow Keys)"},{value:"winamp",label:"Winamp Style (X, Z, B, C, V)"},{value:"youtube",label:"YouTube Style (K, J, L, N, P)"}]),v=u=>{e.value.keyboardShortcutScheme=u,e.value.customShortcuts=void 0,l()},r=u=>{e.value.selectedPlatforms=u,l()},a=()=>{e.value={keyboardShortcutScheme:"simple",selectedPlatforms:J},l()},d=()=>{t.value=!0},p=()=>{t.value=!1},l=()=>{localStorage.setItem("userSettings",JSON.stringify(e.value))},m=()=>{try{const u=localStorage.getItem("userSettings");if(u){const A=JSON.parse(u);e.value={keyboardShortcutScheme:A.keyboardShortcutScheme||"simple",customShortcuts:A.customShortcuts,selectedPlatforms:A.selectedPlatforms||J}}}catch(u){console.warn("Failed to load user settings:",u),a()}},y=u=>{if(!t.value)return;const A=Fe();if(!h(u,A)&&u.ctrlKey&&u.key.toLowerCase()==="k"){u.preventDefault();const x=document.getElementById("search");x&&x.focus()}},h=(u,A)=>{const b=u.target;if(b instanceof HTMLInputElement||b instanceof HTMLTextAreaElement||b instanceof HTMLSelectElement||b?.contentEditable==="true"||b?.closest("input, textarea, select, [contenteditable]")||b?.closest("[class*='input'], [class*='select'], [class*='dropdown']")||b?.closest("[role='textbox'], [role='combobox'], [role='searchbox']")||b?.closest("[data-input], [data-multiselect]"))return!1;const x=s.value,D=u.key.toLowerCase();let T=!1;return D===x.playPause||e.value.keyboardShortcutScheme==="youtube"&&D===" "?(u.preventDefault(),A.togglePlayPause(),T=!0):D===x.nextTrack?(u.preventDefault(),A.nextVideo(),T=!0):D===x.previousTrack?(u.preventDefault(),A.previousVideo(),T=!0):(D===x.mute||D===x.volumeUp||D===x.volumeDown||D===x.seekForward||D===x.seekBackward)&&(u.preventDefault(),T=!0),T},S=()=>{document.addEventListener("keydown",y)},g=()=>{document.removeEventListener("keydown",y)};return m(),S(),{settings:j(e),shortcutsEnabled:j(t),viewMode:n,videoPlayerPosition:o,currentKeyboardShortcuts:s,availableShortcutSchemes:c,setKeyboardShortcutScheme:v,setSelectedPlatforms:r,resetToDefaults:a,loadSettings:m,saveSettings:l,handleKeyboardEvent:h,enableShortcuts:d,disableShortcuts:p,setupGlobalListeners:S,cleanupGlobalListeners:g}});export{Ve as a,Re as b,Ne as c,G as d,Me as e,Fe as f,je as u};
